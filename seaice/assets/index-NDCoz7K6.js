import{_ as q,b as z,r as C,w as O,e as J,f as Q,g as L,c as V,o as N,a as H,h as R,v as $,i as U,j as D,k as W,u as T,F as Y,l as G,m as K,n as X,t as ee,p as te,q as ae,s as ne,x as le}from"./index-cY6tS41h.js";import{g as re,a as oe}from"./index-LnwIdFUs.js";const se="/seaice/assets/basemap_8k-DIYoJH_7.webp",ie={class:"cesiumComponentContainer"},ce={class:"controllerContainer"},ue={class:"playAndPause"},de={style:{flex:"1",margin:"0 10px"}},me={__name:"index",props:{initialCoords:{type:Array,default:()=>[-180,-90,180,90]},autoStart:{type:Boolean,default:!0},isPlaying:{type:Boolean,default:!0},switchInterval:{type:Number,default:1500},fetchedUrls:{type:Array,default:()=>[]},dateType:{type:String,default:"daily"},defaultImageUrl:{type:String,default:se}},emits:["handlePlay","handlePause"],setup(b,{expose:A}){let r=window.Cesium;const _=z(),o=b,i=C(null),a={id:null};let l=null;const c=C(0),v=C(null),w=C(null),I=C(null),u=()=>{a.id||(a.id=setInterval(e,o.switchInterval))},h=()=>{a.id&&(clearInterval(a.id),a.id=null)},f=()=>{h(),c.value=0,e(0),u()},e=t=>{let n;t!==void 0?n=t:n=(c.value+1)%o.fetchedUrls.length;const s=S(n%o.fetchedUrls.length),p=s&&s.imageryProvider;try{s.alpha=0,s.show=!1}catch{}m(p,5e3).then(async d=>{try{c.value=n,s.show=!0,I.value.raiseToTop(s),await y(s,0,1,600);try{I.value.remove(w.value,!0)}catch{}w.value=s}catch{try{I.value.remove(w.value,!0)}catch{}w.value=s,c.value=n}}).catch(d=>{setTimeout(()=>{try{I.value.remove(w.value,!0)}catch{}w.value=s,c.value=n},100)})},g=()=>{c.value=0,w.value=S(c.value)},y=(t,n,s,p=600)=>new Promise(d=>{const k=performance.now(),P=B=>{const E=Math.min(1,(B-k)/p),Z=n+(s-n)*E;try{t.alpha=Z}catch{}E<1?requestAnimationFrame(P):d()};requestAnimationFrame(P)}),m=(t,n=5e3)=>{if(!t||!t.readyPromise)return Promise.resolve();let s=null;return Promise.race([t.readyPromise,new Promise((p,d)=>{s=setTimeout(()=>d(new Error("provider ready timeout")),n)})]).finally(()=>{s&&clearTimeout(s)})},F=async()=>{r.Ion.defaultAccessToken=void 0;const t=new r.SingleTileImageryProvider({url:o.defaultImageUrl,rectangle:r.Rectangle.fromDegrees(...o.initialCoords)});l||(l=document.createElement("div"),l.style.position="absolute",l.style.width="0px",l.style.height="0px",l.style.overflow="hidden",l.style.left="-9999px",l.style.top="-9999px",document.body.appendChild(l)),i.value=new r.Viewer("cesiumContainer",{timeline:!1,animation:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,fullscreenButton:!1,baseLayer:new r.ImageryLayer(t),creditContainer:l}),I.value=i.value.imageryLayers;const n=i.value.scene.globe.tileLoadProgressEvent.addEventListener(function(d){d===0&&(requestAnimationFrame(function(){_.isLoading=!1,u()}),n())}),s=i.value.entities.add({position:r.Cartesian3.fromDegrees(0,90,0),description:"North Pole Anchor"});i.value.trackedEntity=s;const p=i.value.scene.screenSpaceCameraController;p.enableTilt=!0,p.enableZoom=!0,p.enableRotate=!0,p.constrainedAxis=r.Cartesian3.UNIT_Z;try{v.value=i.value.imageryLayers.get(0)}catch{v.value=null}try{const P=r.Cartesian3.fromDegrees(0,89.5,3e7),B=r.Cartesian3.fromDegrees(0,90,15e6);i.value.camera.setView({destination:P}),await i.value.camera.flyTo({destination:B,orientation:{heading:0,pitch:-Math.PI/2,roll:0},duration:2,easingFunction:r.EasingFunction.QUADRATIC_IN_OUT})}catch{}try{const d=v.value&&v.value.imageryProvider;m(d,5e3).then(()=>{g()})}catch{g()}},S=t=>{if(t<0||t>=o.fetchedUrls.length)return;const n=o.fetchedUrls[t],s=n.path||n.url||n;let p;try{p=I.value.addImageryProvider(new r.SingleTileImageryProvider({url:s,rectangle:r.Rectangle.fromDegrees(-180,-90,180,90)}))}catch{}return p},x=t=>{if(!(typeof t!="number"||t<0||t>o.fetchedUrls.length)){if(!o.isPlaying){e(t);return}h(),e(t),u()}};O(()=>o.isPlaying,t=>{t?u():h()});const j=J(()=>{if(o.fetchedUrls&&o.fetchedUrls.length>0){const t=o.fetchedUrls[0];if(t&&typeof t=="object"&&t.date)return o.fetchedUrls.map(n=>n.date)}});return Q(()=>{if(i.value&&!i.value.isDestroyed())try{i.value.destroy()}catch{}a.id&&(clearInterval(a.id),a.id=null);try{l&&l.parentNode&&l.parentNode.removeChild(l)}catch{}l=null}),A({initCesium:F,restart:f}),(t,n)=>{const s=L("vue-fontawesome"),p=L("b-slider-tick"),d=L("b-slider"),k=L("b-field");return N(),V("div",ie,[n[3]||(n[3]=H("div",{id:"cesiumContainer"},null,-1)),H("div",ce,[H("div",ue,[R(U(s,{onClick:n[0]||(n[0]=P=>t.$emit("handlePlay")),icon:"circle-play",class:"has-text-white",size:"lg"},null,512),[[$,!b.isPlaying]]),R(U(s,{onClick:n[1]||(n[1]=P=>t.$emit("handlePause")),icon:"circle-pause",class:"has-text-white",size:"lg"},null,512),[[$,b.isPlaying]])]),H("section",de,[U(k,null,{default:D(()=>[U(d,{onChange:x,modelValue:T(c),"onUpdate:modelValue":n[2]||(n[2]=P=>W(c)?c.value=P:null),min:0,max:o.fetchedUrls.length||14,ticks:""},{default:D(()=>[(N(!0),V(Y,null,G(o.fetchedUrls.length,(P,B)=>(N(),K(p,{key:P,value:P,class:"desktop-only"},{default:D(()=>[X(ee(T(j)[B]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","max"])]),_:1})])])])}}},fe=q(me,[["__scopeId","data-v-658c4958"]]);function M(b=[],A={}){const{concurrency:r=2,initialBatch:_=3,onProgress:o=null,name:i=""}=A,a=new Array(b.length).fill("pending");let l=!1;const c=(...e)=>{if(typeof o=="function")try{o(...e)}catch{}},v=new Set;function w(e,{timeoutMs:g=15e3}={}){return e<0||e>=b.length||a[e]==="loaded"||a[e]==="loading"?Promise.resolve():(a[e]="loading",c(e,a[e],i),new Promise(y=>{const m=new Image;v.add(m);let F=null;const S=x=>{F&&(clearTimeout(F),F=null),m.onload=null,m.onerror=null,v.delete(m),y(x)};m.onload=()=>{a[e]="loaded",c(e,a[e],i),S({index:e,status:"loaded"})},m.onerror=()=>{a[e]="error",c(e,a[e],i),S({index:e,status:"error"})},g>0&&(F=setTimeout(()=>{a[e]="error",c(e,a[e],i),m.onload=null,m.onerror=null;try{m.src=""}catch{}v.delete(m),y({index:e,status:"error",reason:"timeout"})},g)),m.src=b[e]}))}async function I(){if(l)return;const e=Math.min(_,b.length),g=[];for(let y=0;y<e;y++)g.push(w(y));await Promise.all(g),l=!0}async function u(){let e=0;const g=new Array(Math.max(1,r)).fill(0).map(async()=>{for(;;){const y=e++;if(y>=b.length)return;a[y]==="loaded"||a[y]==="error"||await w(y)}});await Promise.all(g)}function h(){for(const e of v)try{e.onload=null,e.onerror=null,e.src=""}catch{}v.clear();for(let e=0;e<a.length;e++)(a[e]==="loading"||a[e]==="pending")&&(a[e]="error",c(e,a[e],i))}function f(){h()}return{urls:b,status:a,get initialLoaded(){return l},loadInitial:I,loadAll:u,cancelAll:h,dispose:f}}const ye={class:"realTimeForecastContainer"},he={__name:"index",setup(b){const{t:A}=te(),r=z(),_=C(null),o=C([]),i=C([]),a=C([]);let l=null,c=null;function v(u,h,f){}const w=async()=>{try{const u=await re();i.value=u||[];const h=(u||[]).map(f=>f.path||f.url||f);l=M(h,{concurrency:3,initialBatch:3,onProgress:v,name:"daily"}),await l.loadInitial(),r.dateType==="daily"&&(o.value=i.value)}catch{}},I=async()=>{try{const u=await oe();a.value=u||[];const h=(u||[]).map(f=>f.path||f.url||f);c=M(h,{concurrency:2,initialBatch:0,onProgress:v,name:"monthly"}),c.loadAll().then(()=>{})}catch{}};return O(()=>r.dateType,async u=>{u==="daily"?o.value=i.value:o.value=a.value,le().then(()=>{_.value&&_.value.restart()})}),ae(async()=>{if(r.isLoading=!0,await Promise.allSettled([w(),I()]),l&&l.loadAll().then(()=>{}),_.value&&typeof _.value.initCesium=="function")try{_.value.initCesium()}catch{}}),ne(()=>{_.value&&(_.value=null),l&&(l.cancelAll(),l=null)}),(u,h)=>{const f=L("b-tab-item"),e=L("b-tabs"),g=L("b-section"),y=fe;return N(),V("div",ye,[U(g,{class:"switcherSection"},{default:D(()=>[U(e,{type:"is-toggle",size:"is-small",modelValue:T(r).dateType,"onUpdate:modelValue":h[0]||(h[0]=m=>T(r).dateType=m)},{default:D(()=>[U(f,{label:T(A)("realTimeForecast.future14Days"),value:"daily"},null,8,["label"]),U(f,{label:T(A)("realTimeForecast.future12Months"),value:"monthly"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),U(y,{"date-type":T(r).dateType,"fetched-urls":o.value,onHandlePlay:T(r).play,onHandlePause:T(r).pause,"is-playing":T(r).isPlaying,ref_key:"sphereRef",ref:_},null,8,["date-type","fetched-urls","onHandlePlay","onHandlePause","is-playing"])])}}},_e=q(he,[["__scopeId","data-v-e1a78b8d"]]);export{_e as default};
