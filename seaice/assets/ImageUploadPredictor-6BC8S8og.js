import{N,k as Y,l as ee,m as x,b as L,n as et,P as re,p as B,q as M,s as tt,o as oe,t as st,v as ye,x as de,y as Se,z as se,A as De,B as ce,C as V,c as R,d as E,a as g,D as S,E as D,f as s,F as H,w as P,e as z,H as at,I as ot,J as Q,K as le,M as lt,O as nt,Q as it,R as ne,S as Te,T as he,U as J,V as rt,W as ut,X as dt,Y as ct,Z as ft,$ as vt,a0 as be,r as I,a1 as pt,a2 as mt,a3 as Ce,a4 as gt,a5 as yt,a6 as ht,a7 as bt,a8 as Fe,a9 as Ct,aa as fe,ab as ve,ac as kt,ad as wt,ae as Ie,af as Me,ag as Re,ah as Ue,ai as pe,aj as Et,ak as _t,al as Be,am as Z,an as $t,ao as Lt,ap as Oe,aq as Pt,ar as Ae,as as Ne,at as St,au as me,av as ke,aw as Dt,ax as Tt,ay as Ft,az as It,aA as Mt,aB as Rt,_ as Ut,aC as Bt,aD as Ot,aE as At,aF as Nt,L as qt,aG as W}from"./index-BCSuCmXA.js";import{g as jt,E as qe}from"./el-progress-BdvFKHC5.js";import{b as zt,U as je,u as Yt,a as ie,c as Ht}from"./el-button-D0LLwSBC.js";import{g as ue,E as Vt}from"./util-BhyXcBt8.js";var Kt=1,Xt=4;function we(e){return zt(e,Kt|Xt)}const ze=e=>{if(!e)return{onClick:N,onMousedown:N,onMouseup:N};let o=!1,t=!1;return{onClick:i=>{o&&t&&e(i),o=t=!1},onMousedown:i=>{o=i.target===i.currentTarget},onMouseup:i=>{t=i.target===i.currentTarget}}},Gt=ee({mask:{type:Boolean,default:!0},customMaskEvent:Boolean,overlayClass:{type:M([String,Array,Object])},zIndex:{type:M([String,Number])}}),Wt={click:e=>e instanceof MouseEvent},Jt="overlay";var Zt=Y({name:"ElOverlay",props:Gt,emits:Wt,setup(e,{slots:o,emit:t}){const c=x(Jt),n=p=>{t("click",p)},{onClick:d,onMousedown:i,onMouseup:_}=ze(e.customMaskEvent?void 0:n);return()=>e.mask?L("div",{class:[c.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:d,onMousedown:i,onMouseup:_},[B(o,"default")],re.STYLE|re.CLASS|re.PROPS,["onClick","onMouseup","onMousedown"]):et("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[B(o,"default")])}});const Qt=Zt,Ye=Symbol("dialogInjectionKey"),He=ee({center:Boolean,alignCenter:Boolean,closeIcon:{type:tt},draggable:Boolean,overflow:Boolean,fullscreen:Boolean,headerClass:String,bodyClass:String,footerClass:String,showClose:{type:Boolean,default:!0},title:{type:String,default:""},ariaLevel:{type:String,default:"2"}}),xt={close:()=>!0},es=(e,o,t,c)=>{let n={offsetX:0,offsetY:0};const d=y=>{const w=y.clientX,h=y.clientY,{offsetX:T,offsetY:l}=n,r=e.value.getBoundingClientRect(),a=r.left,f=r.top,v=r.width,k=r.height,b=document.documentElement.clientWidth,U=document.documentElement.clientHeight,A=-a+T,O=-f+l,q=b-a-v+T,K=U-f-k+l,X=C=>{let j=T+C.clientX-w,u=l+C.clientY-h;c!=null&&c.value||(j=Math.min(Math.max(j,A),q),u=Math.min(Math.max(u,O),K)),n={offsetX:j,offsetY:u},e.value&&(e.value.style.transform=`translate(${de(j)}, ${de(u)})`)},G=()=>{document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",G)};document.addEventListener("mousemove",X),document.addEventListener("mouseup",G)},i=()=>{o.value&&e.value&&o.value.addEventListener("mousedown",d)},_=()=>{o.value&&e.value&&o.value.removeEventListener("mousedown",d)},p=()=>{n={offsetX:0,offsetY:0},e.value&&(e.value.style.transform="none")};return oe(()=>{st(()=>{t.value?i():_()})}),ye(()=>{_()}),{resetPosition:p}},ts=(...e)=>o=>{e.forEach(t=>{Se(t)?t(o):t.value=o})},ss=Y({name:"ElDialogContent"}),as=Y({...ss,props:He,emits:xt,setup(e,{expose:o}){const t=e,{t:c}=De(),{Close:n}=ot,{dialogRef:d,headerRef:i,bodyId:_,ns:p,style:y}=ce(Ye),{focusTrapRef:w}=ce(lt),h=V(()=>[p.b(),p.is("fullscreen",t.fullscreen),p.is("draggable",t.draggable),p.is("align-center",t.alignCenter),{[p.m("center")]:t.center}]),T=ts(w,d),l=V(()=>t.draggable),r=V(()=>t.overflow),{resetPosition:a}=es(d,i,l,r);return o({resetPosition:a}),(f,v)=>(E(),R("div",{ref:s(T),class:D(s(h)),style:le(s(y)),tabindex:"-1"},[g("header",{ref_key:"headerRef",ref:i,class:D([s(p).e("header"),f.headerClass,{"show-close":f.showClose}])},[B(f.$slots,"header",{},()=>[g("span",{role:"heading","aria-level":f.ariaLevel,class:D(s(p).e("title"))},H(f.title),11,["aria-level"])]),f.showClose?(E(),R("button",{key:0,"aria-label":s(c)("el.dialog.close"),class:D(s(p).e("headerbtn")),type:"button",onClick:k=>f.$emit("close")},[L(s(Q),{class:D(s(p).e("close"))},{default:P(()=>[(E(),z(at(f.closeIcon||s(n))))]),_:1},8,["class"])],10,["aria-label","onClick"])):S("v-if",!0)],2),g("div",{id:s(_),class:D([s(p).e("body"),f.bodyClass])},[B(f.$slots,"default")],10,["id"]),f.$slots.footer?(E(),R("footer",{key:0,class:D([s(p).e("footer"),f.footerClass])},[B(f.$slots,"footer")],2)):S("v-if",!0)],6))}});var os=se(as,[["__file","dialog-content.vue"]]);const ls=ee({...He,appendToBody:Boolean,appendTo:{type:M([String,Object]),default:"body"},beforeClose:{type:M(Function)},destroyOnClose:Boolean,closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:Boolean,modalClass:String,headerClass:String,bodyClass:String,footerClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:Boolean,headerAriaLevel:{type:String,default:"2"}}),ns={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[je]:e=>nt(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},is=(e,o={})=>{it(e)||ne("[useLockscreen]","You need to pass a ref param to this function");const t=o.ns||x("popup"),c=V(()=>t.bm("parent","hidden"));if(!Te||he(document.body,c.value))return;let n=0,d=!1,i="0";const _=()=>{setTimeout(()=>{typeof document>"u"||d&&document&&(document.body.style.width=i,ct(document.body,c.value))},200)};J(e,p=>{if(!p){_();return}d=!he(document.body,c.value),d&&(i=document.body.style.width,rt(document.body,c.value)),n=jt(t.namespace.value);const y=document.documentElement.clientHeight<document.body.scrollHeight,w=ut(document.body,"overflowY");n>0&&(y||w==="scroll")&&d&&(document.body.style.width=`calc(100% - ${n}px)`)}),dt(()=>_())},rs=(e,o)=>{var t;const n=ft().emit,{nextZIndex:d}=vt();let i="";const _=be(),p=be(),y=I(!1),w=I(!1),h=I(!1),T=I((t=e.zIndex)!=null?t:d());let l,r;const a=pt("namespace",mt),f=V(()=>{const $={},F=`--${a.value}-dialog`;return e.fullscreen||(e.top&&($[`${F}-margin-top`]=e.top),e.width&&($[`${F}-width`]=de(e.width))),$}),v=V(()=>e.alignCenter?{display:"flex"}:{});function k(){n("opened")}function b(){n("closed"),n(je,!1),e.destroyOnClose&&(h.value=!1)}function U(){n("close")}function A(){r==null||r(),l==null||l(),e.openDelay&&e.openDelay>0?{stop:l}=Ce(()=>X(),e.openDelay):X()}function O(){l==null||l(),r==null||r(),e.closeDelay&&e.closeDelay>0?{stop:r}=Ce(()=>G(),e.closeDelay):G()}function q(){function $(F){F||(w.value=!0,y.value=!1)}e.beforeClose?e.beforeClose($):O()}function K(){e.closeOnClickModal&&q()}function X(){Te&&(y.value=!0)}function G(){y.value=!1}function C(){n("openAutoFocus")}function j(){n("closeAutoFocus")}function u($){var F;((F=$.detail)==null?void 0:F.focusReason)==="pointer"&&$.preventDefault()}e.lockScroll&&is(y);function m(){e.closeOnPressEscape&&q()}return J(()=>e.modelValue,$=>{$?(w.value=!1,A(),h.value=!0,T.value=gt(e.zIndex)?d():T.value++,yt(()=>{n("open"),o.value&&(o.value.parentElement.scrollTop=0,o.value.parentElement.scrollLeft=0,o.value.scrollTop=0)})):y.value&&O()}),J(()=>e.fullscreen,$=>{o.value&&($?(i=o.value.style.transform,o.value.style.transform=""):o.value.style.transform=i)}),oe(()=>{e.modelValue&&(y.value=!0,h.value=!0,A())}),{afterEnter:k,afterLeave:b,beforeLeave:U,handleClose:q,onModalClick:K,close:O,doClose:G,onOpenAutoFocus:C,onCloseAutoFocus:j,onCloseRequested:m,onFocusoutPrevented:u,titleId:_,bodyId:p,closed:w,style:f,overlayDialogStyle:v,rendered:h,visible:y,zIndex:T}},us=Y({name:"ElDialog",inheritAttrs:!1}),ds=Y({...us,props:ls,emits:ns,setup(e,{expose:o}){const t=e,c=ht();Yt({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},V(()=>!!c.title));const n=x("dialog"),d=I(),i=I(),_=I(),{visible:p,titleId:y,bodyId:w,style:h,overlayDialogStyle:T,rendered:l,zIndex:r,afterEnter:a,afterLeave:f,beforeLeave:v,handleClose:k,onModalClick:b,onOpenAutoFocus:U,onCloseAutoFocus:A,onCloseRequested:O,onFocusoutPrevented:q}=rs(t,d);Ie(Ye,{dialogRef:d,headerRef:i,bodyId:w,ns:n,rendered:l,style:h});const K=ze(b),X=V(()=>t.draggable&&!t.fullscreen);return o({visible:p,dialogContentRef:_,resetPosition:()=>{var C;(C=_.value)==null||C.resetPosition()}}),(C,j)=>(E(),z(s(wt),{to:C.appendTo,disabled:C.appendTo!=="body"?!1:!C.appendToBody},{default:P(()=>[L(bt,{name:"dialog-fade",onAfterEnter:s(a),onAfterLeave:s(f),onBeforeLeave:s(v),persisted:""},{default:P(()=>[Fe(L(s(Qt),{"custom-mask-event":"",mask:C.modal,"overlay-class":C.modalClass,"z-index":s(r)},{default:P(()=>[g("div",{role:"dialog","aria-modal":"true","aria-label":C.title||void 0,"aria-labelledby":C.title?void 0:s(y),"aria-describedby":s(w),class:D(`${s(n).namespace.value}-overlay-dialog`),style:le(s(T)),onClick:s(K).onClick,onMousedown:s(K).onMousedown,onMouseup:s(K).onMouseup},[L(s(Ct),{loop:"",trapped:s(p),"focus-start-el":"container",onFocusAfterTrapped:s(U),onFocusAfterReleased:s(A),onFocusoutPrevented:s(q),onReleaseRequested:s(O)},{default:P(()=>[s(l)?(E(),z(os,fe({key:0,ref_key:"dialogContentRef",ref:_},C.$attrs,{center:C.center,"align-center":C.alignCenter,"close-icon":C.closeIcon,draggable:s(X),overflow:C.overflow,fullscreen:C.fullscreen,"header-class":C.headerClass,"body-class":C.bodyClass,"footer-class":C.footerClass,"show-close":C.showClose,title:C.title,"aria-level":C.headerAriaLevel,onClose:s(k)}),ve({header:P(()=>[C.$slots.title?B(C.$slots,"title",{key:1}):B(C.$slots,"header",{key:0,close:s(k),titleId:s(y),titleClass:s(n).e("title")})]),default:P(()=>[B(C.$slots,"default")]),_:2},[C.$slots.footer?{name:"footer",fn:P(()=>[B(C.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","header-class","body-class","footer-class","show-close","title","aria-level","onClose"])):S("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,["aria-label","aria-labelledby","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["mask","overlay-class","z-index"]),[[kt,s(p)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var cs=se(ds,[["__file","dialog.vue"]]);const fs=Me(cs),Ve=Symbol("uploadContextKey"),vs="ElUpload";class ps extends Error{constructor(o,t,c,n){super(o),this.name="UploadAjaxError",this.status=t,this.method=c,this.url=n}}function Ee(e,o,t){let c;return t.response?c=`${t.response.error||t.response}`:t.responseText?c=`${t.responseText}`:c=`fail to ${o.method} ${e} ${t.status}`,new ps(c,t.status,o.method,e)}function ms(e){const o=e.responseText||e.response;if(!o)return o;try{return JSON.parse(o)}catch{return o}}const gs=e=>{typeof XMLHttpRequest>"u"&&ne(vs,"XMLHttpRequest is undefined");const o=new XMLHttpRequest,t=e.action;o.upload&&o.upload.addEventListener("progress",d=>{const i=d;i.percent=d.total>0?d.loaded/d.total*100:0,e.onProgress(i)});const c=new FormData;if(e.data)for(const[d,i]of Object.entries(e.data))Re(i)&&i.length?c.append(d,...i):c.append(d,i);c.append(e.filename,e.file,e.file.name),o.addEventListener("error",()=>{e.onError(Ee(t,e,o))}),o.addEventListener("load",()=>{if(o.status<200||o.status>=300)return e.onError(Ee(t,e,o));e.onSuccess(ms(o))}),o.open(e.method,t,!0),e.withCredentials&&"withCredentials"in o&&(o.withCredentials=!0);const n=e.headers||{};if(n instanceof Headers)n.forEach((d,i)=>o.setRequestHeader(i,d));else for(const[d,i]of Object.entries(n))Ue(i)||o.setRequestHeader(d,String(i));return o.send(c),o},Ke=["text","picture","picture-card"];let ys=1;const ge=()=>Date.now()+ys++,Xe=ee({action:{type:String,default:"#"},headers:{type:M(Object)},method:{type:String,default:"post"},data:{type:M([Object,Function,Promise]),default:()=>pe({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:M(Array),default:()=>pe([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:Ke,default:"text"},httpRequest:{type:M(Function),default:gs},disabled:Boolean,limit:Number}),hs=ee({...Xe,beforeUpload:{type:M(Function),default:N},beforeRemove:{type:M(Function)},onRemove:{type:M(Function),default:N},onChange:{type:M(Function),default:N},onPreview:{type:M(Function),default:N},onSuccess:{type:M(Function),default:N},onProgress:{type:M(Function),default:N},onError:{type:M(Function),default:N},onExceed:{type:M(Function),default:N},crossorigin:{type:M(String)}}),bs=ee({files:{type:M(Array),default:()=>pe([])},disabled:{type:Boolean,default:!1},handlePreview:{type:M(Function),default:N},listType:{type:String,values:Ke,default:"text"},crossorigin:{type:M(String)}}),Cs={remove:e=>!!e},ks=Y({name:"ElUploadList"}),ws=Y({...ks,props:bs,emits:Cs,setup(e,{emit:o}){const t=e,{t:c}=De(),n=x("upload"),d=x("icon"),i=x("list"),_=ie(),p=I(!1),y=V(()=>[n.b("list"),n.bm("list",t.listType),n.is("disabled",t.disabled)]),w=h=>{o("remove",h)};return(h,T)=>(E(),z(St,{tag:"ul",class:D(s(y)),name:s(i).b()},{default:P(()=>[(E(!0),R(Et,null,_t(h.files,(l,r)=>(E(),R("li",{key:l.uid||l.name,class:D([s(n).be("list","item"),s(n).is(l.status),{focusing:p.value}]),tabindex:"0",onKeydown:Be(a=>!s(_)&&w(l),["delete"]),onFocus:a=>p.value=!0,onBlur:a=>p.value=!1,onClick:a=>p.value=!1},[B(h.$slots,"default",{file:l,index:r},()=>[h.listType==="picture"||l.status!=="uploading"&&h.listType==="picture-card"?(E(),R("img",{key:0,class:D(s(n).be("list","item-thumbnail")),src:l.url,crossorigin:h.crossorigin,alt:""},null,10,["src","crossorigin"])):S("v-if",!0),l.status==="uploading"||h.listType!=="picture-card"?(E(),R("div",{key:1,class:D(s(n).be("list","item-info"))},[g("a",{class:D(s(n).be("list","item-name")),onClick:Z(a=>h.handlePreview(l),["prevent"])},[L(s(Q),{class:D(s(d).m("document"))},{default:P(()=>[L(s($t))]),_:1},8,["class"]),g("span",{class:D(s(n).be("list","item-file-name")),title:l.name},H(l.name),11,["title"])],10,["onClick"]),l.status==="uploading"?(E(),z(s(qe),{key:0,type:h.listType==="picture-card"?"circle":"line","stroke-width":h.listType==="picture-card"?6:2,percentage:Number(l.percentage),style:le(h.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):S("v-if",!0)],2)):S("v-if",!0),g("label",{class:D(s(n).be("list","item-status-label"))},[h.listType==="text"?(E(),z(s(Q),{key:0,class:D([s(d).m("upload-success"),s(d).m("circle-check")])},{default:P(()=>[L(s(Lt))]),_:1},8,["class"])):["picture-card","picture"].includes(h.listType)?(E(),z(s(Q),{key:1,class:D([s(d).m("upload-success"),s(d).m("check")])},{default:P(()=>[L(s(Oe))]),_:1},8,["class"])):S("v-if",!0)],2),s(_)?S("v-if",!0):(E(),z(s(Q),{key:2,class:D(s(d).m("close")),onClick:a=>w(l)},{default:P(()=>[L(s(Pt))]),_:2},1032,["class","onClick"])),S(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),S(" This is a bug which needs to be fixed "),S(" TODO: Fix the incorrect navigation interaction "),s(_)?S("v-if",!0):(E(),R("i",{key:3,class:D(s(d).m("close-tip"))},H(s(c)("el.upload.deleteTip")),3)),h.listType==="picture-card"?(E(),R("span",{key:4,class:D(s(n).be("list","item-actions"))},[g("span",{class:D(s(n).be("list","item-preview")),onClick:a=>h.handlePreview(l)},[L(s(Q),{class:D(s(d).m("zoom-in"))},{default:P(()=>[L(s(Ae))]),_:1},8,["class"])],10,["onClick"]),s(_)?S("v-if",!0):(E(),R("span",{key:0,class:D(s(n).be("list","item-delete")),onClick:a=>w(l)},[L(s(Q),{class:D(s(d).m("delete"))},{default:P(()=>[L(s(Ne))]),_:1},8,["class"])],10,["onClick"]))],2)):S("v-if",!0)])],42,["onKeydown","onFocus","onBlur","onClick"]))),128)),B(h.$slots,"append")]),_:3},8,["class","name"]))}});var _e=se(ws,[["__file","upload-list.vue"]]);const Es=ee({disabled:{type:Boolean,default:!1}}),_s={file:e=>Re(e)},Ge="ElUploadDrag",$s=Y({name:Ge}),Ls=Y({...$s,props:Es,emits:_s,setup(e,{emit:o}){ce(Ve)||ne(Ge,"usage: <el-upload><el-upload-dragger /></el-upload>");const c=x("upload"),n=I(!1),d=ie(),i=p=>{if(d.value)return;n.value=!1,p.stopPropagation();const y=Array.from(p.dataTransfer.files),w=p.dataTransfer.items||[];y.forEach((h,T)=>{var l;const r=w[T],a=(l=r==null?void 0:r.webkitGetAsEntry)==null?void 0:l.call(r);a&&(h.isDirectory=a.isDirectory)}),o("file",y)},_=()=>{d.value||(n.value=!0)};return(p,y)=>(E(),R("div",{class:D([s(c).b("dragger"),s(c).is("dragover",n.value)]),onDrop:Z(i,["prevent"]),onDragover:Z(_,["prevent"]),onDragleave:Z(w=>n.value=!1,["prevent"])},[B(p.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}});var Ps=se(Ls,[["__file","upload-dragger.vue"]]);const Ss=ee({...Xe,beforeUpload:{type:M(Function),default:N},onRemove:{type:M(Function),default:N},onStart:{type:M(Function),default:N},onSuccess:{type:M(Function),default:N},onProgress:{type:M(Function),default:N},onError:{type:M(Function),default:N},onExceed:{type:M(Function),default:N}}),Ds=Y({name:"ElUploadContent",inheritAttrs:!1}),Ts=Y({...Ds,props:Ss,setup(e,{expose:o}){const t=e,c=x("upload"),n=ie(),d=me({}),i=me(),_=a=>{if(a.length===0)return;const{autoUpload:f,limit:v,fileList:k,multiple:b,onStart:U,onExceed:A}=t;if(v&&k.length+a.length>v){A(a,k);return}b||(a=a.slice(0,1));for(const O of a){const q=O;q.uid=ge(),U(q),f&&p(q)}},p=async a=>{if(i.value.value="",!t.beforeUpload)return w(a);let f,v={};try{const b=t.data,U=t.beforeUpload(a);v=ke(t.data)?we(t.data):t.data,f=await U,ke(t.data)&&Dt(b,v)&&(v=we(t.data))}catch{f=!1}if(f===!1){t.onRemove(a);return}let k=a;f instanceof Blob&&(f instanceof File?k=f:k=new File([f],a.name,{type:a.type})),w(Object.assign(k,{uid:a.uid}),v)},y=async(a,f)=>Se(a)?a(f):a,w=async(a,f)=>{const{headers:v,data:k,method:b,withCredentials:U,name:A,action:O,onProgress:q,onSuccess:K,onError:X,httpRequest:G}=t;try{f=await y(f??k,a)}catch{t.onRemove(a);return}const{uid:C}=a,j={headers:v||{},withCredentials:U,file:a,data:f,method:b,filename:A,action:O,onProgress:m=>{q(m,a)},onSuccess:m=>{K(m,a),delete d.value[C]},onError:m=>{X(m,a),delete d.value[C]}},u=G(j);d.value[C]=u,u instanceof Promise&&u.then(j.onSuccess,j.onError)},h=a=>{const f=a.target.files;f&&_(Array.from(f))},T=()=>{n.value||(i.value.value="",i.value.click())},l=()=>{T()};return o({abort:a=>{Tt(d.value).filter(a?([v])=>String(a.uid)===v:()=>!0).forEach(([v,k])=>{k instanceof XMLHttpRequest&&k.abort(),delete d.value[v]})},upload:p}),(a,f)=>(E(),R("div",{class:D([s(c).b(),s(c).m(a.listType),s(c).is("drag",a.drag),s(c).is("disabled",s(n))]),tabindex:s(n)?"-1":"0",onClick:T,onKeydown:Be(Z(l,["self"]),["enter","space"])},[a.drag?(E(),z(Ps,{key:0,disabled:s(n),onFile:_},{default:P(()=>[B(a.$slots,"default")]),_:3},8,["disabled"])):B(a.$slots,"default",{key:1}),g("input",{ref_key:"inputRef",ref:i,class:D(s(c).e("input")),name:a.name,disabled:s(n),multiple:a.multiple,accept:a.accept,type:"file",onChange:h,onClick:Z(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}});var $e=se(Ts,[["__file","upload-content.vue"]]);const Le="ElUpload",Pe=e=>{var o;(o=e.url)!=null&&o.startsWith("blob:")&&URL.revokeObjectURL(e.url)},Fs=(e,o)=>{const t=Ft(e,"fileList",void 0,{passive:!0}),c=l=>t.value.find(r=>r.uid===l.uid);function n(l){var r;(r=o.value)==null||r.abort(l)}function d(l=["ready","uploading","success","fail"]){t.value=t.value.filter(r=>!l.includes(r.status))}function i(l){t.value=t.value.filter(r=>r.uid!==l.uid)}const _=(l,r)=>{const a=c(r);a&&(console.error(l),a.status="fail",i(a),e.onError(l,a,t.value),e.onChange(a,t.value))},p=(l,r)=>{const a=c(r);a&&(e.onProgress(l,a,t.value),a.status="uploading",a.percentage=Math.round(l.percent))},y=(l,r)=>{const a=c(r);a&&(a.status="success",a.response=l,e.onSuccess(l,a,t.value),e.onChange(a,t.value))},w=l=>{Ue(l.uid)&&(l.uid=ge());const r={name:l.name,percentage:0,status:"ready",size:l.size,raw:l,uid:l.uid};if(e.listType==="picture-card"||e.listType==="picture")try{r.url=URL.createObjectURL(l)}catch(a){It(Le,a.message),e.onError(a,r,t.value)}t.value=[...t.value,r],e.onChange(r,t.value)},h=async l=>{const r=l instanceof File?c(l):l;r||ne(Le,"file to be removed not found");const a=f=>{n(f),i(f),e.onRemove(f,t.value),Pe(f)};e.beforeRemove?await e.beforeRemove(r,t.value)!==!1&&a(r):a(r)};function T(){t.value.filter(({status:l})=>l==="ready").forEach(({raw:l})=>{var r;return l&&((r=o.value)==null?void 0:r.upload(l))})}return J(()=>e.listType,l=>{l!=="picture-card"&&l!=="picture"||(t.value=t.value.map(r=>{const{raw:a,url:f}=r;if(!f&&a)try{r.url=URL.createObjectURL(a)}catch(v){e.onError(v,r,t.value)}return r}))}),J(t,l=>{for(const r of l)r.uid||(r.uid=ge()),r.status||(r.status="success")},{immediate:!0,deep:!0}),{uploadFiles:t,abort:n,clearFiles:d,handleError:_,handleProgress:p,handleStart:w,handleSuccess:y,handleRemove:h,submit:T,revokeFileObjectURL:Pe}},Is=Y({name:"ElUpload"}),Ms=Y({...Is,props:hs,setup(e,{expose:o}){const t=e,c=ie(),n=me(),{abort:d,submit:i,clearFiles:_,uploadFiles:p,handleStart:y,handleError:w,handleRemove:h,handleSuccess:T,handleProgress:l,revokeFileObjectURL:r}=Fs(t,n),a=V(()=>t.listType==="picture-card"),f=V(()=>({...t,fileList:p.value,onStart:y,onProgress:l,onSuccess:T,onError:w,onRemove:h}));return ye(()=>{p.value.forEach(r)}),Ie(Ve,{accept:Mt(t,"accept")}),o({abort:d,submit:i,clearFiles:_,handleStart:y,handleRemove:h}),(v,k)=>(E(),R("div",null,[s(a)&&v.showFileList?(E(),z(_e,{key:0,disabled:s(c),"list-type":v.listType,files:s(p),crossorigin:v.crossorigin,"handle-preview":v.onPreview,onRemove:s(h)},ve({append:P(()=>[L($e,fe({ref_key:"uploadRef",ref:n},s(f)),{default:P(()=>[v.$slots.trigger?B(v.$slots,"trigger",{key:0}):S("v-if",!0),!v.$slots.trigger&&v.$slots.default?B(v.$slots,"default",{key:1}):S("v-if",!0)]),_:3},16)]),_:2},[v.$slots.file?{name:"default",fn:P(({file:b,index:U})=>[B(v.$slots,"file",{file:b,index:U})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):S("v-if",!0),!s(a)||s(a)&&!v.showFileList?(E(),z($e,fe({key:1,ref_key:"uploadRef",ref:n},s(f)),{default:P(()=>[v.$slots.trigger?B(v.$slots,"trigger",{key:0}):S("v-if",!0),!v.$slots.trigger&&v.$slots.default?B(v.$slots,"default",{key:1}):S("v-if",!0)]),_:3},16)):S("v-if",!0),v.$slots.trigger?B(v.$slots,"default",{key:2}):S("v-if",!0),B(v.$slots,"tip"),!s(a)&&v.showFileList?(E(),z(_e,{key:3,disabled:s(c),"list-type":v.listType,files:s(p),crossorigin:v.crossorigin,"handle-preview":v.onPreview,onRemove:s(h)},ve({_:2},[v.$slots.file?{name:"default",fn:P(({file:b,index:U})=>[B(v.$slots,"file",{file:b,index:U})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):S("v-if",!0)]))}});var Rs=se(Ms,[["__file","upload.vue"]]);const Us=Me(Rs),Bs={class:"container-flex"},Os={key:0,class:"title"},As={key:1,class:"image-container"},Ns={key:0,class:"loading-overlay"},qs=["src"],js={key:1,class:"tooltip"},zs={class:"button-grid"},Ys=["disabled"],Hs=["disabled"],Vs={class:"slider-container"},Ks={for:"intervalRange",class:"slider-label"},Xs=["src"],Gs={class:"image-date"},Ws={__name:"ArcticSeaIceViewer",props:{images:{type:Array,required:!0}},setup(e){const o=e,t=I(null),c=I(0),n=I(null),d=I(1),i=I(2),_=I(!1),p=I(!1),y=I(!1),w=k=>new Promise((b,U)=>{const A=new Image;A.onload=()=>b(),A.onerror=U,A.src=ue(k)}),h=k=>{k&&(t.value=k,d.value=1)},T=k=>{const b=Math.sign(k.deltaY),U=Math.max(1,Math.min(3,d.value-b*.2));d.value=U,k.preventDefault()},l=async()=>{if(o.images&&o.images.length>0){y.value=!0;const k=(c.value+1)%o.images.length;try{await w(o.images[k].path),c.value=k,n.value=o.images[c.value]}catch(b){console.error("Failed to load next image:",b)}finally{y.value=!1}}},r=async()=>{if(o.images&&o.images.length>0){y.value=!0;const k=(c.value-1+o.images.length)%o.images.length;try{await w(o.images[k].path),c.value=k,n.value=o.images[c.value]}catch(b){console.error("Failed to load previous image:",b)}finally{y.value=!1}}};let a;const f=()=>{clearInterval(a),_.value||(a=setInterval(async()=>{y.value||await l()},i.value*1e3))},v=()=>{_.value=!_.value,f()};return oe(()=>{f()}),ye(()=>{a&&(clearInterval(a),a=null)}),J(()=>o.images,k=>{(k==null?void 0:k.length)>0?(c.value=0,n.value=k[0]):n.value=null},{immediate:!0}),J(i,()=>{f()}),(k,b)=>{var U,A;return E(),R("div",Bs,[n.value?(E(),R("h2",Os,H(n.value.date),1)):S("",!0),n.value?(E(),R("div",As,[y.value?(E(),R("div",Ns,b[6]||(b[6]=[g("div",{class:"loading-spinner"},null,-1)]))):S("",!0),g("img",{src:s(ue)(n.value.path),alt:"Arctic Sea Ice Prediction",class:"image",onClick:b[0]||(b[0]=O=>h(n.value)),onMouseover:b[1]||(b[1]=O=>p.value=!0),onMouseleave:b[2]||(b[2]=O=>p.value=!1)},null,40,qs),p.value?(E(),R("div",js,"点击图片可以放大查看")):S("",!0)])):S("",!0),g("div",zs,[g("button",{onClick:r,class:D(["button",{"button-disabled":c.value===0}]),disabled:c.value===0}," 上一张 ",10,Ys),g("button",{onClick:v,class:"button"},H(_.value?"点击继续":"点击暂停"),1),g("button",{onClick:l,class:D(["button",{"button-disabled":!((U=e.images)!=null&&U.length)||c.value===e.images.length-1}]),disabled:!((A=e.images)!=null&&A.length)||c.value===e.images.length-1}," 下一张 ",10,Hs)]),g("div",Vs,[Fe(g("input",{id:"intervalRange",type:"range",min:"1",max:"3",step:"0.1","onUpdate:modelValue":b[3]||(b[3]=O=>i.value=O),class:"slider"},null,512),[[Rt,i.value]]),g("label",Ks,"图片播放速度: "+H(i.value)+"s",1)]),t.value?(E(),R("div",{key:2,class:"modal-overlay",onWheel:T,onClick:b[5]||(b[5]=Z(O=>t.value=null,["self"]))},[g("div",{class:"modal-content",style:le({transform:`scale(${d.value})`})},[g("img",{src:s(ue)(t.value.path),alt:"Large view",class:"modal-image"},null,8,Xs),g("p",Gs,H(t.value.date),1)],4),g("button",{onClick:b[4]||(b[4]=O=>t.value=null),class:"close-button"},b[7]||(b[7]=[g("svg",{class:"close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))],32)):S("",!0)])}}},Js={class:"upload-container"},Zs={key:1,class:"form-content"},Qs={class:"upload-header"},xs={class:"upload-progress"},ea={class:"progress-text"},ta={class:"hint-text"},sa={class:"date-picker-section"},aa={class:"upload-area"},oa={key:0,class:"upload-trigger"},la={key:1,class:"upload-complete"},na={class:"custom-upload-item"},ia=["src"],ra={class:"upload-item-overlay"},ua={class:"upload-item-actions"},da={class:"image-date-label"},ca={class:"submit-section"},fa={key:2,class:"loading-container"},va={key:3,class:"results-container"},pa={key:0},ma={key:1,class:"empty-results"},ga={class:"preview-container"},ya=["src"],ha={__name:"ImageUploadPredictor",props:{timeMode:{type:String,required:!0},imageLimit:{type:Number,required:!0},selectedDate:{type:[Date,String],required:!0},getPredictionResult:{type:Function,required:!0},submitPredictionRequest:{type:Function,required:!0}},emits:["update:selectedDate"],setup(e,{emit:o}){const t=e,c=o,n=I([]),d=I(!1),i=I([]),_=I(""),p=I(!1),y=I([]),w=I(!1),h=I(null),T=I(null),l=I(null),r=I([]);J(()=>t.selectedDate,u=>{l.value=u,a()}),J(i,()=>{a()});const a=()=>{if(!l.value)return;const u=[],m=new Date(l.value);for(let $=0;$<t.imageLimit;$++){const F=new Date(m);t.timeMode==="daily"?F.setDate(F.getDate()+$):t.timeMode==="monthly"?F.setMonth(F.getMonth()+$):console.log("Unhandled timeMode:",t.timeMode),u.push(f(F))}r.value=u},f=u=>{const m=u.getFullYear(),$=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0");return`${m}-${$}-${F}`},v=u=>!r.value.length||u>=r.value.length?"未设置日期":r.value[u];J(i,u=>{u.length===t.imageLimit&&W.success(`已成功选择${t.imageLimit}张图片`)});const k=u=>new Promise((m,$)=>{const F=new FileReader;F.readAsDataURL(u),F.onload=()=>m(F.result),F.onerror=ae=>$(ae)}),b=u=>u.type==="image/png"?i.value.length>=t.imageLimit?(W.error(`已达到${t.imageLimit}张图片上限`),!1):!0:(W.error("仅支持PNG文件"),!1),U=(u,m)=>{const $=u.image_url;if($){const F=i.value.findIndex(ae=>ae.uid===m.uid);if(F!==-1){for(;y.value.length<t.imageLimit;)y.value.push(null);y.value[F]=$}}W.success(`${m.name} 上传成功`)},A=(u,m)=>{W.error(`${m.name} 上传失败`),console.error("Upload error:",u)},O=async u=>{!u.url&&!u.preview&&(u.preview=await k(u.raw)),_.value=u.url||u.preview,p.value=!0},q=u=>{const m=i.value.findIndex($=>$.uid===u.uid);if(m!==-1)for(i.value=i.value.filter(($,F)=>F!==m),y.value.splice(m,1);y.value.length<t.imageLimit;)y.value.push(null);W.warning(`还需上传${t.imageLimit-i.value.length}张图片`)},K=async()=>{if(h.value)try{const u=await t.getPredictionResult(h.value);u.success&&u.data&&u.data.images?(n.value=u.data.images,d.value=!0,clearInterval(T.value),w.value=!1,W.success(u.message||"获取预测结果成功")):u.success===!1&&console.log("Task not completed yet:",u.message)}catch(u){if(u.response&&u.response.status===400){console.log("Task not completed yet, continuing polling...");return}clearInterval(T.value),w.value=!1,W.error("获取预测结果失败"),console.error("Error:",u)}},X=async()=>{try{w.value=!0;const u=await t.submitPredictionRequest(t.selectedDate,y.value);if(u.success&&u.data&&u.data.task_id){h.value=u.data.task_id;let m=0;const $=30;T.value=setInterval(()=>{if(m++,m>$){clearInterval(T.value),w.value=!1,W.warning("请求超时，请稍后查看结果");return}K()},2e3)}else w.value=!1,W.error(u.message||"提交预测请求失败")}catch(u){w.value=!1,W.error("提交预测请求失败"),console.error("Error:",u)}},G=()=>{d.value=!1,n.value=[],j(),h.value=null,T.value&&clearInterval(T.value),c("update:selectedDate",null)},C=V(()=>y.value.filter(u=>u!=null).length),j=()=>{y.value=new Array(t.imageLimit).fill(null),i.value=[]};return oe(()=>{j()}),(u,m)=>{const $=Q,F=Ht,ae=qe,We=Us,Je=Vt,Ze=fs;return E(),R("div",Js,[d.value?(E(),z(F,{key:0,class:"back-button",onClick:G},{default:P(()=>[L($,null,{default:P(()=>[L(s(Ot))]),_:1}),m[2]||(m[2]=Bt(" 返回 "))]),_:1})):S("",!0),d.value?S("",!0):(E(),R("div",Zs,[g("div",Qs,[m[4]||(m[4]=g("h3",null,"图片上传",-1)),g("div",xs,[g("div",ea,[m[3]||(m[3]=g("span",null,"已上传: ",-1)),g("span",{class:D({complete:C.value===t.imageLimit})},H(C.value)+"/"+H(t.imageLimit),3)]),L(ae,{percentage:C.value/t.imageLimit*100,"stroke-width":8,"show-text":!1,status:C.value===t.imageLimit?"success":""},null,8,["percentage","status"])]),g("p",ta,"请上传"+H(t.imageLimit)+"张PNG格式图片",1)]),g("div",sa,[B(u.$slots,"date-picker",{},void 0,!0),m[5]||(m[5]=g("p",{class:"date-hint"},"选择的日期将作为第一张图片的日期",-1))]),g("div",aa,[L(We,{"file-list":i.value,"onUpdate:fileList":m[0]||(m[0]=te=>i.value=te),class:"image-uploader",action:"https://seaice.52lxy.one:20443/seaice/png-upload",accept:".png","list-type":"picture-card",multiple:!0,limit:e.imageLimit,"before-upload":b,"on-preview":O,"on-success":U,"on-error":A,"on-remove":q,"auto-upload":!0},{default:P(()=>[i.value.length<t.imageLimit?(E(),R("div",oa,[L($,{class:"upload-icon"},{default:P(()=>[L(s(At))]),_:1}),m[6]||(m[6]=g("div",{class:"upload-text"},"点击上传",-1)),m[7]||(m[7]=g("div",{class:"upload-hint"},"仅支持PNG格式",-1))])):(E(),R("div",la,[L($,{class:"complete-icon"},{default:P(()=>[L(s(Oe))]),_:1}),m[8]||(m[8]=g("div",{class:"complete-text"},"上传完成",-1))]))]),file:P(({file:te,index:Qe})=>[g("div",na,[g("img",{class:"upload-thumbnail",src:te.url,alt:""},null,8,ia),g("div",ra,[g("div",ua,[L(F,{circle:"",type:"primary",onClick:Z(xe=>O(te),["stop"])},{default:P(()=>[L($,null,{default:P(()=>[L(s(Ae))]),_:1})]),_:2},1032,["onClick"]),L(F,{circle:"",type:"danger",onClick:Z(xe=>q(te),["stop"])},{default:P(()=>[L($,null,{default:P(()=>[L(s(Ne))]),_:1})]),_:2},1032,["onClick"])])]),g("div",da,[g("span",null,H(v(Qe)),1)])])]),_:1},8,["file-list","limit"])]),g("div",ca,[L(F,{type:"primary",size:"large",onClick:X,loading:w.value,disabled:C.value!==t.imageLimit||!e.selectedDate,class:"submit-button"},{default:P(()=>[w.value?S("",!0):(E(),z($,{key:0},{default:P(()=>[L(s(Nt))]),_:1})),g("span",null,H(w.value?"分析中...":"提交分析"),1)]),_:1},8,["loading","disabled"])])])),w.value?(E(),R("div",fa,[L(qt),m[9]||(m[9]=g("p",{class:"loading-text"},"正在分析您的图片，请稍候...",-1))])):S("",!0),!w.value&&d.value?(E(),R("div",va,[n.value.length?(E(),R("div",pa,[L(Ws,{images:n.value},null,8,["images"])])):(E(),R("div",ma,[L(Je,{description:"暂无预测结果"}),m[10]||(m[10]=g("p",null,"请上传图片并选择日期以查看预测结果",-1))]))])):S("",!0),L(Ze,{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=te=>p.value=te),title:"图片预览",width:"50%",center:"","destroy-on-close":""},{default:P(()=>[g("div",ga,[g("img",{class:"preview-image",src:_.value,alt:"Preview Image"},null,8,ya)])]),_:1},8,["modelValue"])])}}},Ea=Ut(ha,[["__scopeId","data-v-25e442c6"]]);export{Ea as I};
