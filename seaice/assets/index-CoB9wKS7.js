import{_ as I,a as V}from"./index-Dc4zcomO.js";import{e as C,f as N}from"./index-BbFGagmH.js";import{d as O,r as f,_ as j,A as F,e as U,g as p,c as B,o as G,a as D,i as s,j as r,u as h,n as k,z as L}from"./index-CwjyL_I4.js";import"./result_mask-DVoKs7o9.js";const $=O("dynamicAnalysis",()=>{const d=f([]),i=f([]);function n(e){for(;e.value.length>3;)e.value.splice(3)}function _(e){d.value.unshift(e),c({status:"处理中",task_id:e.task_id,timeId:null}),u(i.value[0]),n(d)}function c(e){i.value.unshift(e),n(i)}function u(e,v=2e3){e.timerId==null&&(e.timerId=setInterval(async()=>{try{const m=await C(e.task_id);(m.status==="COMPLETED"||m.status==="FAILED")&&(e.status=m.status==="COMPLETED"?"完成":"失败",e.images=m.data?.images,clearInterval(e.timerId),e.timerId=null)}catch{}},v))}function y(){for(const e of i.value)e.status!=="完成"&&e.status!=="失败"&&u(e)}function b(){for(const e of i.value)e.timerId&&(clearInterval(e.timerId),e.timerId=null)}return{taskList:d,addTask:_,resultList:i,addResult:c,pollTaskStatus:u,clearAllTimers:b,pollAllTaskStatus:y}},{persist:{enabled:!0,strategies:[{key:"dynamicAnalysis",storage:localStorage,paths:["taskList","resultList"]}]}}),H={class:"DynamicAnalysisContainer"},X={class:"formContainer"},Y={class:"resultWrapper"},P={__name:"index",setup(S){const d=$(),i=new URL("/seaice/assets/land_image-CiFG6DTh.webp",import.meta.url).href,n=F({startDate:null,endDate:null,grad_type:"sum",grad_month:"",selection:null}),_=f(1),c=f([null,null]),u=f(""),y=a=>{if(!a)return"";const t=new Date(a),l=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0");return`${l}${o}`},b=a=>{const t=a?new Date(a):null;if(u.value="",!t){c.value[0]=null;return}c.value[0]=t},e=a=>{const t=c.value[0],l=a?new Date(a):null;!t||!l||(c.value=[t,l],n.startDate=t,n.endDate=l,u.value="")},v=U(()=>{if(!n.endDate)return"";const a=new Date(n.endDate);return a.setMonth(a.getMonth()+_.value),(l=>`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`)(a)}),m=a=>{n.selection=a},w=()=>{if(!n.startDate||!n.endDate){L("请选择数据范围");return}if(!n.grad_type){L("请选择分析目标");return}const a=Object.assign({},n);a.startDate=y(n.startDate),a.endDate=y(n.endDate),a.grad_month=v.value.split("-")[1],N(a).then(t=>{const{task_id:l}=t.data,o={task_id:l,created_time:new Date().toLocaleString()};d.addTask(o),L(t.message)})};return(a,t)=>{const l=p("b-datepicker"),o=p("b-field"),x=p("b-numberinput"),M=p("b-input"),z=I,T=p("b-radio"),A=p("b-button"),E=V;return G(),B("div",H,[D("div",X,[D("section",null,[s(o,{label:"数据范围",horizontal:"",class:"datepickerBox",type:u.value?"is-danger":"",message:u.value},{default:r(()=>[s(l,{placeholder:"点击选择...",range:"",style:{width:"230px"},size:"is-small",onRangeEnd:e,onRangeStart:b,type:"month"})]),_:1},8,["type","message"]),s(o,{label:"预报提前期",horizontal:"",class:"advanceDate"},{default:r(()=>[s(x,{size:"is-small",type:"is-dark",modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=g=>_.value=g),modelModifiers:{number:!0},min:"1",style:{width:"230px",height:"30px"}},null,8,["modelValue"])]),_:1}),s(o,{label:"目标月份",horizontal:""},{default:r(()=>[s(M,{size:"is-small",disabled:"",style:{width:"250px"},value:v.value,readonly:"",placeholder:"目标月份由数据范围和预报提前期决定"},null,8,["value"])]),_:1}),s(o,{label:"分析范围",horizontal:""},{default:r(()=>[s(z,{"image-url":h(i),onSelectionString:m,width:432,height:432},null,8,["image-url"])]),_:1}),s(o,{label:"分析目标",horizontal:"",class:"gradType"},{default:r(()=>[s(T,{modelValue:n.grad_type,"onUpdate:modelValue":t[1]||(t[1]=g=>n.grad_type=g),name:"analysisObjective","native-value":"sum",type:"is-black",size:"is-small"},{default:r(()=>[...t[3]||(t[3]=[k(" 海冰面积 ",-1)])]),_:1},8,["modelValue"]),s(T,{modelValue:n.grad_type,"onUpdate:modelValue":t[2]||(t[2]=g=>n.grad_type=g),name:"analysisObjective","native-value":"variation",type:"is-black",size:"is-small"},{default:r(()=>[...t[4]||(t[4]=[k(" 海冰变化 ",-1)])]),_:1},8,["modelValue"])]),_:1}),s(o,{horizontal:""},{default:r(()=>[s(A,{type:"is-dark",size:"is-small",style:{margin:"10px 0"},onClick:w},{default:r(()=>[...t[5]||(t[5]=[k("提交分析",-1)])]),_:1})]),_:1})])]),D("div",Y,[s(E,{tooltip:"缓存最近三条动态分析记录",emptyMessage:"提交分析之后才会显示结果热图!",taskList:h(d).taskList,resultList:h(d).resultList,modalTitle:"逐日动态分析结果热图"},null,8,["taskList","resultList"])])])}}},Q=j(P,[["__scopeId","data-v-52df66f7"]]);export{Q as default};
