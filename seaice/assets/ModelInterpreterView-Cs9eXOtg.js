import{r as w,aR as Q,aS as ee,k as te,aT as ae,aU as le,n as Y,w as c,a9 as z,a as d,ad as re,a8 as oe,Y as B,j as ne,a5 as j,an as W,X as M,W as U,aV as G,R as se,aW as de,_ as H,aH as K,c as C,b as k,D as E,E as x,H as h,as as ue,at as ie,e as S,av as X,M as ce,aN as D,aO as me,aI as V,aK as ve,L as pe,aX as fe,aY as ge}from"./index-BD6wn_9V.js";import{E as be,a as _e,b as ye,c as Ie,d as $e,e as he,I as we}from"./ImageSelector-CeNkVivO.js";import{g as N,a as Ce,E as ke}from"./util-CTd5-h1J.js";function Re(l){let t;const e=w(!1),r=Q({...l,originalPosition:"",originalOverflow:"",visible:!1});function u(o){r.text=o}function n(){const o=r.parent,p=m.ns;if(!o.vLoadingAddClassList){let g=o.getAttribute("loading-number");g=Number.parseInt(g)-1,g?o.setAttribute("loading-number",g.toString()):(B(o,p.bm("parent","relative")),o.removeAttribute("loading-number")),B(o,p.bm("parent","hidden"))}b(),i.unmount()}function b(){var o,p;(p=(o=m.$el)==null?void 0:o.parentNode)==null||p.removeChild(m.$el)}function _(){var o;l.beforeClose&&!l.beforeClose()||(e.value=!0,clearTimeout(t),t=setTimeout(v,400),r.visible=!1,(o=l.closed)==null||o.call(l))}function v(){if(!e.value)return;const o=r.parent;e.value=!1,o.vLoadingAddClassList=void 0,n()}const f=te({name:"ElLoading",setup(o,{expose:p}){const{ns:g,zIndex:a}=le("loading");return p({ns:g,zIndex:a}),()=>{const s=r.spinner||r.svg,y=Y("svg",{class:"circular",viewBox:r.svgViewBox?r.svgViewBox:"0 0 50 50",...s?{innerHTML:s}:{}},[Y("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),I=r.text?Y("p",{class:g.b("text")},[r.text]):void 0;return Y(oe,{name:g.b("fade"),onAfterLeave:v},{default:c(()=>[z(d("div",{style:{backgroundColor:r.background||""},class:[g.b("mask"),r.customClass,r.fullscreen?"is-fullscreen":""]},[Y("div",{class:g.b("spinner")},[y,I])]),[[re,r.visible]])])})}}}),i=ee(f),m=i.mount(document.createElement("div"));return{...ae(r),setText:u,removeElLoadingChild:b,close:_,handleAfterLeave:v,vm:m,get $el(){return m.$el}}}let A;const Ve=function(l={}){if(!ne)return;const t=Ee(l);if(t.fullscreen&&A)return A;const e=Re({...t,closed:()=>{var u;(u=t.closed)==null||u.call(t),t.fullscreen&&(A=void 0)}});De(t,t.parent,e),O(t,t.parent,e),t.parent.vLoadingAddClassList=()=>O(t,t.parent,e);let r=t.parent.getAttribute("loading-number");return r?r=`${Number.parseInt(r)+1}`:r="1",t.parent.setAttribute("loading-number",r),t.parent.appendChild(e.$el),j(()=>e.visible.value=t.visible),t.fullscreen&&(A=e),e},Ee=l=>{var t,e,r,u;let n;return W(l.target)?n=(t=document.querySelector(l.target))!=null?t:document.body:n=l.target||document.body,{parent:n===document.body||l.body?document.body:n,background:l.background||"",svg:l.svg||"",svgViewBox:l.svgViewBox||"",spinner:l.spinner||!1,text:l.text||"",fullscreen:n===document.body&&((e=l.fullscreen)!=null?e:!0),lock:(r=l.lock)!=null?r:!1,customClass:l.customClass||"",visible:(u=l.visible)!=null?u:!0,beforeClose:l.beforeClose,closed:l.closed,target:n}},De=async(l,t,e)=>{const{nextZIndex:r}=e.vm.zIndex||e.vm._.exposed.zIndex,u={};if(l.fullscreen)e.originalPosition.value=M(document.body,"position"),e.originalOverflow.value=M(document.body,"overflow"),u.zIndex=r();else if(l.parent===document.body){e.originalPosition.value=M(document.body,"position"),await j();for(const n of["top","left"]){const b=n==="top"?"scrollTop":"scrollLeft";u[n]=`${l.target.getBoundingClientRect()[n]+document.body[b]+document.documentElement[b]-Number.parseInt(M(document.body,`margin-${n}`),10)}px`}for(const n of["height","width"])u[n]=`${l.target.getBoundingClientRect()[n]}px`}else e.originalPosition.value=M(t,"position");for(const[n,b]of Object.entries(u))e.$el.style[n]=b},O=(l,t,e)=>{const r=e.vm.ns||e.vm._.exposed.ns;["absolute","fixed","sticky"].includes(e.originalPosition.value)?B(t,r.bm("parent","relative")):U(t,r.bm("parent","relative")),l.fullscreen&&l.lock?U(t,r.bm("parent","hidden")):B(t,r.bm("parent","hidden"))},T=Symbol("ElLoading"),q=(l,t)=>{var e,r,u,n;const b=t.instance,_=o=>G(t.value)?t.value[o]:void 0,v=o=>{const p=W(o)&&(b==null?void 0:b[o])||o;return p&&w(p)},f=o=>v(_(o)||l.getAttribute(`element-loading-${de(o)}`)),i=(e=_("fullscreen"))!=null?e:t.modifiers.fullscreen,m={text:f("text"),svg:f("svg"),svgViewBox:f("svgViewBox"),spinner:f("spinner"),background:f("background"),customClass:f("customClass"),fullscreen:i,target:(r=_("target"))!=null?r:i?void 0:l,body:(u=_("body"))!=null?u:t.modifiers.body,lock:(n=_("lock"))!=null?n:t.modifiers.lock};l[T]={options:m,instance:Ve(m)}},Le=(l,t)=>{for(const e of Object.keys(t))se(t[e])&&(t[e].value=l[e])},xe={mounted(l,t){t.value&&q(l,t)},updated(l,t){const e=l[T];t.oldValue!==t.value&&(t.value&&!t.oldValue?q(l,t):t.value&&t.oldValue?G(t.value)&&Le(t.value,e.options):e==null||e.instance.close())},unmounted(l){var t;(t=l[T])==null||t.instance.close(),l[T]=null}},Ye={class:"dynamics-viewer"},Me={class:"viewer-header"},Se={class:"section-title"},Ae={key:0,class:"viewer-controls"},Te={key:0,class:"images-grid"},Be=["src","alt","onClick"],Ne={key:1,class:"empty-state"},Fe=["src","alt"],Pe={__name:"ModelInterpreterViewer",props:{images:{type:Array,required:!0}},setup(l){const{t}=K(),e=l,r=w(null),u=w(1),n=w(!0),b=i=>{i&&(r.value=i,u.value=1)},_=i=>{const m=Math.sign(i.deltaY),o=Math.max(.5,Math.min(5,u.value-m*.2));u.value=o,i.preventDefault()},v=()=>{n.value=!1},f=()=>{n.value=!1,D.error(t("modelInterpreterViewer.imageLoadError"))};return(i,m)=>{const o=xe;return k(),C("div",Ye,[E("div",Me,[E("h2",Se,h(i.$t("modelInterpreterViewer.title")),1),e.images&&e.images.length>0?(k(),C("div",Ae)):x("",!0)]),e.images&&e.images.length>0?(k(),C("div",Te,[(k(!0),C(ue,null,ie(e.images,(p,g)=>z((k(),C("div",{key:g,class:"image-container"},[E("img",{src:S(N)(p),alt:i.$t("modelInterpreterViewer.imageAlt",{index:g+1}),class:"analysis-image",style:{transform:"scale(1)"},onClick:a=>b(S(N)(p)),onLoad:v,onError:f},null,40,Be)])),[[o,n.value]])),128))])):(k(),C("div",Ne,[d(S(Ce),{description:i.$t("modelInterpreterViewer.noResults")},null,8,["description"])])),r.value?(k(),C("div",{key:2,class:"modal-overlay",onWheel:_,onClick:m[1]||(m[1]=X(p=>r.value=null,["self"]))},[E("div",{class:"modal-content",style:ce({transform:`scale(${u.value})`})},[E("img",{src:S(N)(r.value),alt:i.$t("modelInterpreterViewer.modalImageAlt"),class:"modal-image"},null,8,Fe)],4),E("button",{onClick:m[0]||(m[0]=p=>r.value=null),class:"close-button"},m[2]||(m[2]=[E("svg",{class:"close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[E("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))],32)):x("",!0)])}}},Ue=H(Pe,[["__scopeId","data-v-c9245d14"]]),Oe={class:"container-layout"},qe={style:{margin:"0 8px"}},ze={key:0,class:"date-error-tip"},je={style:{color:"#f56c6c","font-size":"12px"}},We={key:0,style:{"margin-top":"8px"}},Ge={key:0,class:"loading-container"},He={key:1,class:"result-section"},Ke={__name:"ModelInterpreterView",setup(l){const{t}=K(),e=w({dataRange:[],pred_gap:1,grad_type:"sum",position:"",variable:""}),r=w({x:null,y:null}),u=w({x:null,y:null}),n=()=>{if(r.value.x!==null&&u.value.x!==null){const s=448-r.value.y,y=448-u.value.y;e.value.position=`${s},${r.value.x};${y},${r.value.x};${s},${u.value.x};${y},${u.value.x}`}else e.value.position=""},b=w([]),_=w(!1),v=w(!1),f=w(null),i=w(""),m=a=>{const I=a.getFullYear();if(I<1979||I>2023)return!0;if(!e.value.dataRange[0])return!1;const L=new Date(e.value.dataRange[0].replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")),R=new Date(L);return R.setDate(L.getDate()+12),a.getTime()<R.getTime()},o=()=>{const{dataRange:a}=e.value;if(i.value="",a[0]){const y=new Date(a[0].replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")).getFullYear();if(y<1979||y>2023)return i.value=t("modelInterpreter.startDateRange"),e.value.dataRange[0]="",!1}if(a[0]&&a[1]){const s=new Date(a[0].replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")),y=new Date(a[1].replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")),I=y.getFullYear(),L=Math.floor((y-s)/(24*60*60*1e3));if(I<1979||I>2023)return i.value=t("modelInterpreter.endDateRange"),e.value.dataRange[1]="",!1;if(L<13)return i.value=t("modelInterpreter.minimumDays"),e.value.dataRange[1]="",!1}return!0},p=async()=>{if(f.value)try{const a=await ge(f.value);if(a.success&&a.status==="COMPLETED")if(a.data&&a.data.images)b.value=a.data.images,_.value=!0,D.success(a.message||t("modelInterpreter.analysisComplete")),v.value=!1,f.value=null;else throw new Error(t("modelInterpreter.dataFormatError"));else if(a.status==="IN_PROGRESS")console.log("任务处理中，继续轮询...");else if(a.status==="FAILED")throw new Error(a.message||t("modelInterpreter.taskFailed"))}catch(a){console.error("轮询分析结果出错:",a),v.value=!1,_.value=!1,D.error(a.message||t("modelInterpreter.getResultsFailed"))}},g=async()=>{if(!e.value.dataRange||!e.value.dataRange[0]||!e.value.dataRange[1]||!e.value.pred_gap||!e.value.grad_type){D.error(t("modelInterpreter.fillRequiredParams"));return}if(!o()){D.error(i.value||t("modelInterpreter.dateRangeError"));return}try{v.value=!0,_.value=!1;const a=await fe(e.value.dataRange[0],e.value.dataRange[1],e.value.pred_gap,e.value.grad_type,e.value.position,e.value.variable);if(a.success)f.value=a.data.task_id;else{v.value=!1,D.error(a.message||t("modelInterpreter.submitRequestFailed"));return}const s=setInterval(async()=>{await p(),v.value||clearInterval(s)},2e3)}catch(a){_.value=!1,v.value=!1,D.error(t("modelInterpreter.submitRequestFailedRetry")),console.error("Analysis error:",a)}};return me(()=>{f.value&&(f.value=null)}),(a,s)=>{const y=ke,I=ye,L=Ie,R=he,F=$e,P=ve,Z=_e,J=be;return k(),C("div",Oe,[d(J,{class:"box-card"},{default:c(()=>[d(Z,{model:e.value,onSubmit:X(g,["prevent"]),class:"analysis-form"},{default:c(()=>[d(I,{label:a.$t("modelInterpreter.dataRange"),required:""},{default:c(()=>[d(y,{modelValue:e.value.dataRange[0],"onUpdate:modelValue":s[0]||(s[0]=$=>e.value.dataRange[0]=$),type:"date",placeholder:a.$t("modelInterpreter.selectStartDate"),format:"YYYY-MM-DD","value-format":"YYYYMMDD",onChange:o},null,8,["modelValue","placeholder"]),E("span",qe,h(a.$t("modelInterpreter.to")),1),d(y,{modelValue:e.value.dataRange[1],"onUpdate:modelValue":s[1]||(s[1]=$=>e.value.dataRange[1]=$),type:"date",placeholder:a.$t("modelInterpreter.selectEndDate"),format:"YYYY-MM-DD","value-format":"YYYYMMDD","disabled-date":m,onChange:o},null,8,["modelValue","placeholder"]),i.value?(k(),C("div",ze,[E("span",je,h(i.value),1)])):x("",!0)]),_:1},8,["label"]),d(I,{label:a.$t("modelInterpreter.predictionInterval"),required:""},{default:c(()=>[d(L,{modelValue:e.value.pred_gap,"onUpdate:modelValue":s[2]||(s[2]=$=>e.value.pred_gap=$),min:1,max:7,placeholder:a.$t("modelInterpreter.predictionIntervalPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(I,{label:a.$t("modelInterpreter.analysisTarget"),required:""},{default:c(()=>[d(F,{modelValue:e.value.grad_type,"onUpdate:modelValue":s[3]||(s[3]=$=>e.value.grad_type=$)},{default:c(()=>[d(R,{value:"sum"},{default:c(()=>[V(h(a.$t("modelInterpreter.mean")),1)]),_:1}),d(R,{value:"l2"},{default:c(()=>[V(h(a.$t("modelInterpreter.distribution")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),d(I,{label:a.$t("modelInterpreter.selectedPosition")},{default:c(()=>[d(we,{topLeft:r.value,"onUpdate:topLeft":[s[4]||(s[4]=$=>r.value=$),n],bottomRight:u.value,"onUpdate:bottomRight":[s[5]||(s[5]=$=>u.value=$),n],width:304,height:448,imageSrc:"/seaice/picture/arctic_mask.webp"},null,8,["topLeft","bottomRight"])]),_:1},8,["label"]),d(I,{label:a.$t("modelInterpreter.selectedVariable")},{default:c(()=>[d(F,{modelValue:e.value.variable,"onUpdate:modelValue":s[6]||(s[6]=$=>e.value.variable=$)},{default:c(()=>[d(R,{value:"1"},{default:c(()=>[V(h(a.$t("modelInterpreter.seaIceConcentration")),1)]),_:1}),d(R,{value:"2"},{default:c(()=>[V(h(a.$t("modelInterpreter.seaIceUComponent")),1)]),_:1}),d(R,{value:"3"},{default:c(()=>[V(h(a.$t("modelInterpreter.seaIceVComponent")),1)]),_:1}),d(R,{value:"4"},{default:c(()=>[V(h(a.$t("modelInterpreter.temperature2m")),1)]),_:1}),d(R,{value:"5"},{default:c(()=>[V(h(a.$t("modelInterpreter.wind10mU")),1)]),_:1}),d(R,{value:"6"},{default:c(()=>[V(h(a.$t("modelInterpreter.wind10mV")),1)]),_:1})]),_:1},8,["modelValue"]),e.value.variable?(k(),C("div",We,[d(P,{onClick:s[7]||(s[7]=$=>e.value.variable=""),size:"small"},{default:c(()=>[V(h(a.$t("modelInterpreter.cancelSelection")),1)]),_:1})])):x("",!0)]),_:1},8,["label"]),d(I,null,{default:c(()=>[d(P,{type:"primary",loading:v.value,onClick:g},{default:c(()=>[V(h(v.value?a.$t("modelInterpreter.analyzing"):a.$t("modelInterpreter.submitAnalysis")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),v.value?(k(),C("div",Ge,[d(pe)])):x("",!0),!v.value&&_.value?(k(),C("div",He,[d(Ue,{images:b.value,class:"full-width"},null,8,["images"])])):x("",!0)]),_:1})])}}},Qe=H(Ke,[["__scopeId","data-v-22cb0242"]]);export{Qe as default};
