import{_ as N,a as O,b as U}from"./index-DtygwSZS.js";import{e as j,f as B}from"./index-LnwIdFUs.js";import{d as G,r as v,_ as $,p as H,B as P,e as X,g,c as Y,o as R,a as h,i as o,j as r,u as l,n as k,t as T,C as W,F as q,A as L}from"./index-cY6tS41h.js";import"./result_mask-DVoKs7o9.js";const J=G("dynamicAnalysis",()=>{const n=v([]),c=v([]);function m(e){for(;e.value.length>3;)e.value.splice(3)}function D(e){n.value.unshift(e),s({status:"处理中",task_id:e.task_id,timeId:null}),d(c.value[0]),m(n)}function s(e){c.value.unshift(e),m(c)}function d(e,A=2e3){e.timerId==null&&(e.timerId=setInterval(async()=>{try{const u=await j(e.task_id);(u.status==="COMPLETED"||u.status==="FAILED")&&(e.status=u.status==="COMPLETED"?"完成":"失败",e.images=u.data?.images,clearInterval(e.timerId),e.timerId=null)}catch{}},A))}function p(){for(const e of c.value)e.status!=="完成"&&e.status!=="失败"&&d(e)}function _(){for(const e of c.value)e.timerId&&(clearInterval(e.timerId),e.timerId=null)}return{taskList:n,addTask:D,resultList:c,addResult:s,pollTaskStatus:d,clearAllTimers:_,pollAllTaskStatus:p}},{persist:{enabled:!0,strategies:[{key:"dynamicAnalysis",storage:localStorage,paths:["taskList","resultList"]}]}}),K={class:"noticeContainer"},Q={class:"formContainer"},Z={class:"formFieldSection"},ee={class:"resultWrapper"},te={__name:"index",setup(I){const{t:n,locale:c}=H(),m=J(),D=new URL("/seaice/assets/land_image-CiFG6DTh.webp",import.meta.url).href,s=P({startDate:null,endDate:null,grad_type:"sum",grad_month:"",selection:null}),d=v(1),p=v([null,null]),_=v(""),e=t=>{if(!t)return"";const a=new Date(t),i=a.getFullYear(),f=String(a.getMonth()+1).padStart(2,"0");return`${i}${f}`},A=t=>{const a=t?new Date(t):null;if(_.value="",!a){p.value[0]=null;return}p.value[0]=a},u=t=>{const a=p.value[0],i=t?new Date(t):null;!a||!i||(p.value=[a,i],s.startDate=a,s.endDate=i,_.value="")},S=X(()=>{if(!s.endDate)return"";const t=new Date(s.endDate);return t.setMonth(t.getMonth()+d.value),(i=>`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`)(t)}),w=t=>{s.selection=t},x=()=>{if(!s.startDate||!s.endDate){L("common.message.selectDataRange");return}if(!s.grad_type){L("common.message.selectAnalysisTarget");return}const t=Object.assign({},s);t.startDate=e(s.startDate),t.endDate=e(s.endDate),t.grad_month=S.value.split("-")[1],B(t).then(a=>{const{task_id:i}=a.data,f={task_id:i,created_time:new Date().toLocaleString()};m.addTask(f),L(a.message)})};return(t,a)=>{const i=N,f=g("b-datepicker"),y=g("b-field"),V=g("b-numberinput"),z=g("b-input"),E=O,M=g("b-radio"),C=g("b-button"),F=U;return R(),Y(q,null,[h("div",K,[o(i)]),h("div",{class:W(["DynamicAnalysisContainer",{"is-en":l(c)==="en-US"}])},[h("div",Q,[h("section",Z,[o(y,{label:l(n)("dynamicAnalysis.dataRange"),horizontal:"",class:"datepickerBox",type:_.value?"is-danger":"",message:_.value},{default:r(()=>[o(f,{placeholder:l(n)("common.placeholder.select"),range:"",style:{width:"230px"},size:"is-small",onRangeEnd:u,onRangeStart:A,type:"month"},null,8,["placeholder"])]),_:1},8,["label","type","message"]),o(y,{label:l(n)("dynamicAnalysis.forecastLeadTime"),horizontal:"",class:"advanceDate"},{default:r(()=>[o(V,{size:"is-small",type:"is-dark",modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=b=>d.value=b),modelModifiers:{number:!0},min:"1",style:{width:"200px",height:"30px"}},null,8,["modelValue"])]),_:1},8,["label"]),o(y,{label:l(n)("dynamicAnalysis.targetMonth"),horizontal:""},{default:r(()=>[o(z,{size:"is-small",disabled:"",style:{width:"250px"},value:S.value,readonly:"",placeholder:l(n)("dynamicAnalysis.targetMonthPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(y,{label:l(n)("dynamicAnalysis.analysisRange"),horizontal:""},{default:r(()=>[o(E,{"image-url":l(D),onSelectionString:w,width:432,height:432},null,8,["image-url"])]),_:1},8,["label"]),o(y,{label:l(n)("dynamicAnalysis.analysisTarget"),horizontal:"",class:"gradType"},{default:r(()=>[o(M,{modelValue:s.grad_type,"onUpdate:modelValue":a[1]||(a[1]=b=>s.grad_type=b),name:"analysisObjective","native-value":"sum",type:"is-black",size:"is-small"},{default:r(()=>[k(T(l(n)("dynamicAnalysis.seaIceArea")),1)]),_:1},8,["modelValue"]),o(M,{modelValue:s.grad_type,"onUpdate:modelValue":a[2]||(a[2]=b=>s.grad_type=b),name:"analysisObjective","native-value":"variation",type:"is-black",size:"is-small"},{default:r(()=>[k(T(l(n)("dynamicAnalysis.seaIceVariation")),1)]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(y,{horizontal:""},{default:r(()=>[o(C,{type:"is-dark",size:"is-small",style:{margin:"10px 0"},onClick:x},{default:r(()=>[k(T(l(n)("common.button.submitAnalysis")),1)]),_:1})]),_:1})])]),h("div",ee,[o(F,{tooltip:l(n)("dynamicAnalysis.tooltip"),emptyMessage:l(n)("common.message.submitToView"),taskList:l(m).taskList,resultList:l(m).resultList,modalTitle:l(n)("dynamicAnalysis.modalTitle")},null,8,["tooltip","emptyMessage","taskList","resultList","modalTitle"])])],2)],64)}}},oe=$(te,[["__scopeId","data-v-06e82afe"]]);export{oe as default};
