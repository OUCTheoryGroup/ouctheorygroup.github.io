import{_ as F,a as N}from"./index-CHRSSaap.js";import{e as O,f as U}from"./index-D_eHaR1i.js";import{d as j,r as b,_ as B,p as G,B as $,e as H,g,c as P,o as X,a as D,i as o,j as c,u as l,n as A,t as k,C as Y,A as T}from"./index-D1ToNYlt.js";import"./result_mask-DVoKs7o9.js";const R=j("dynamicAnalysis",()=>{const n=b([]),d=b([]);function p(e){for(;e.value.length>3;)e.value.splice(3)}function h(e){n.value.unshift(e),s({status:"处理中",task_id:e.task_id,timeId:null}),u(d.value[0]),p(n)}function s(e){d.value.unshift(e),p(d)}function u(e,v=2e3){e.timerId==null&&(e.timerId=setInterval(async()=>{try{const m=await O(e.task_id);(m.status==="COMPLETED"||m.status==="FAILED")&&(e.status=m.status==="COMPLETED"?"完成":"失败",e.images=m.data?.images,clearInterval(e.timerId),e.timerId=null)}catch{}},v))}function _(){for(const e of d.value)e.status!=="完成"&&e.status!=="失败"&&u(e)}function y(){for(const e of d.value)e.timerId&&(clearInterval(e.timerId),e.timerId=null)}return{taskList:n,addTask:h,resultList:d,addResult:s,pollTaskStatus:u,clearAllTimers:y,pollAllTaskStatus:_}},{persist:{enabled:!0,strategies:[{key:"dynamicAnalysis",storage:localStorage,paths:["taskList","resultList"]}]}}),W={class:"formContainer"},q={class:"formFieldSection"},J={class:"resultWrapper"},K={__name:"index",setup(M){const{t:n,locale:d}=G(),p=R(),h=new URL("/seaice/assets/land_image-CiFG6DTh.webp",import.meta.url).href,s=$({startDate:null,endDate:null,grad_type:"sum",grad_month:"",selection:null}),u=b(1),_=b([null,null]),y=b(""),e=t=>{if(!t)return"";const a=new Date(t),i=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0");return`${i}${r}`},v=t=>{const a=t?new Date(t):null;if(y.value="",!a){_.value[0]=null;return}_.value[0]=a},m=t=>{const a=_.value[0],i=t?new Date(t):null;!a||!i||(_.value=[a,i],s.startDate=a,s.endDate=i,y.value="")},L=H(()=>{if(!s.endDate)return"";const t=new Date(s.endDate);return t.setMonth(t.getMonth()+u.value),(i=>`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`)(t)}),I=t=>{s.selection=t},w=()=>{if(!s.startDate||!s.endDate){T("common.message.selectDataRange");return}if(!s.grad_type){T("common.message.selectAnalysisTarget");return}const t=Object.assign({},s);t.startDate=e(s.startDate),t.endDate=e(s.endDate),t.grad_month=L.value.split("-")[1],U(t).then(a=>{const{task_id:i}=a.data,r={task_id:i,created_time:new Date().toLocaleString()};p.addTask(r),T(a.message)})};return(t,a)=>{const i=g("b-datepicker"),r=g("b-field"),x=g("b-numberinput"),V=g("b-input"),z=F,S=g("b-radio"),E=g("b-button"),C=N;return X(),P("div",{class:Y(["DynamicAnalysisContainer",{"is-en":l(d)==="en-US"}])},[D("div",W,[D("section",q,[o(r,{label:l(n)("dynamicAnalysis.dataRange"),horizontal:"",class:"datepickerBox",type:y.value?"is-danger":"",message:y.value},{default:c(()=>[o(i,{placeholder:l(n)("common.placeholder.select"),range:"",style:{width:"230px"},size:"is-small",onRangeEnd:m,onRangeStart:v,type:"month"},null,8,["placeholder"])]),_:1},8,["label","type","message"]),o(r,{label:l(n)("dynamicAnalysis.forecastLeadTime"),horizontal:"",class:"advanceDate"},{default:c(()=>[o(x,{size:"is-small",type:"is-dark",modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=f=>u.value=f),modelModifiers:{number:!0},min:"1",style:{width:"200px",height:"30px"}},null,8,["modelValue"])]),_:1},8,["label"]),o(r,{label:l(n)("dynamicAnalysis.targetMonth"),horizontal:""},{default:c(()=>[o(V,{size:"is-small",disabled:"",style:{width:"250px"},value:L.value,readonly:"",placeholder:l(n)("dynamicAnalysis.targetMonthPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(r,{label:l(n)("dynamicAnalysis.analysisRange"),horizontal:""},{default:c(()=>[o(z,{"image-url":l(h),onSelectionString:I,width:432,height:432},null,8,["image-url"])]),_:1},8,["label"]),o(r,{label:l(n)("dynamicAnalysis.analysisTarget"),horizontal:"",class:"gradType"},{default:c(()=>[o(S,{modelValue:s.grad_type,"onUpdate:modelValue":a[1]||(a[1]=f=>s.grad_type=f),name:"analysisObjective","native-value":"sum",type:"is-black",size:"is-small"},{default:c(()=>[A(k(l(n)("dynamicAnalysis.seaIceArea")),1)]),_:1},8,["modelValue"]),o(S,{modelValue:s.grad_type,"onUpdate:modelValue":a[2]||(a[2]=f=>s.grad_type=f),name:"analysisObjective","native-value":"variation",type:"is-black",size:"is-small"},{default:c(()=>[A(k(l(n)("dynamicAnalysis.seaIceVariation")),1)]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(r,{horizontal:""},{default:c(()=>[o(E,{type:"is-dark",size:"is-small",style:{margin:"10px 0"},onClick:w},{default:c(()=>[A(k(l(n)("common.button.submitAnalysis")),1)]),_:1})]),_:1})])]),D("div",J,[o(C,{tooltip:l(n)("dynamicAnalysis.tooltip"),emptyMessage:l(n)("common.message.submitToView"),taskList:l(p).taskList,resultList:l(p).resultList,modalTitle:l(n)("dynamicAnalysis.modalTitle")},null,8,["tooltip","emptyMessage","taskList","resultList","modalTitle"])])],2)}}},ae=B(K,[["__scopeId","data-v-fe2afbc6"]]);export{ae as default};
