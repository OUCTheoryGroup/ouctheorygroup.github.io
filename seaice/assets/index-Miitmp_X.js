import{_ as Q,b as R,r as T,w as O,e as Y,f as q,g as k,c as V,o as B,a as S,h as E,v as z,i as b,j as F,k as W,u as U,F as j,l as G,m as X,n as K,t as ee,p as te,q as ae,s as ne}from"./index-BOr2xhkb.js";import{g as re,a as oe}from"./index-CsRofkao.js";const le="/seaice/assets/default-earth-image-CM3n2ZyH.png",se=()=>{const y=[],u=new Date;let a=u.getFullYear(),c=u.getMonth()+1;c++,c>12&&(c=1,a++);for(let o=0;o<12;o++){const n=c<10?`0${c}`:`${c}`;y.push(`${a}-${n}`),c++,c>12&&(c=1,a++)}return y},ie=()=>{const y=[],u=new Date;for(let a=0;a<14;a++){const c=new Date(u);c.setDate(u.getDate()+a),c.getFullYear();const o=c.getMonth()+1,n=c.getDate(),t=o<10?`0${o}`:`${o}`,l=n<10?`0${n}`:`${n}`;y.push(`${t}-${l}`)}return y},ce={class:"cesiumComponentContainer"},ue={class:"controllerContainer"},de={class:"playAndPause"},me={style:{flex:"1",margin:"0 10px"}},ye={__name:"index",props:{initialCoords:{type:Array,default:()=>[-180,-90,180,90]},autoStart:{type:Boolean,default:!0},isPlaying:{type:Boolean,default:!0},switchInterval:{type:Number,default:1500},fetchedUrls:{type:Array,default:()=>[]},dateType:{type:String,default:"daily"}},emits:["handlePlay","handlePause"],setup(y,{expose:u}){let a=window.Cesium;const c=R(),o=y,n=T(null),t={id:null};let l=null;const d=T(0),w=T(null),P=T(null),f=T(null),h=()=>{t.id||(t.id=setInterval(e,o.switchInterval))},m=()=>{t.id&&(clearInterval(t.id),t.id=null)},M=()=>{m(),d.value=0,e(0),h()},e=r=>{let s;r!==void 0?s=r:s=(d.value+1)%o.fetchedUrls.length;const i=A(s%o.fetchedUrls.length),I=i&&i.imageryProvider;try{i.alpha=0,i.show=!1}catch{}_(I,5e3).then(async g=>{try{d.value=s,i.show=!0,f.value.raiseToTop(i),await p(i,0,1,600);try{f.value.remove(P.value,!0)}catch{}P.value=i}catch{try{f.value.remove(P.value,!0)}catch{}P.value=i,d.value=s}}).catch(g=>{setTimeout(()=>{try{f.value.remove(P.value,!0)}catch{}P.value=i,d.value=s},100)})},v=()=>{d.value=0,P.value=A(d.value)},p=(r,s,i,I=600)=>new Promise(g=>{const D=performance.now(),C=$=>{const x=Math.min(1,($-D)/I),J=s+(i-s)*x;try{r.alpha=J}catch{}x<1?requestAnimationFrame(C):g()};requestAnimationFrame(C)}),_=(r,s=5e3)=>{if(!r||!r.readyPromise)return Promise.resolve();let i=null;return Promise.race([r.readyPromise,new Promise((I,g)=>{i=setTimeout(()=>g(new Error("provider ready timeout")),s)})]).finally(()=>{i&&clearTimeout(i)})},L=async()=>{a.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1MzQ1NjM4YS03ZGM4LTQ1MDQtOWUwNy01NzVmYmZlMWVkYTEiLCJpZCI6MzQzMzg4LCJpYXQiOjE3NTg1MDU2NTd9.aVcWv4XlIsZ9rCjBah89dQ-g6nf54DSQBzQEzKEQ6uU";const r=new a.SingleTileImageryProvider({url:le,rectangle:a.Rectangle.fromDegrees(...o.initialCoords)});l||(l=document.createElement("div"),l.style.position="absolute",l.style.width="0px",l.style.height="0px",l.style.overflow="hidden",l.style.left="-9999px",l.style.top="-9999px",document.body.appendChild(l)),n.value=new a.Viewer("cesiumContainer",{terrainProvider:a.createWorldTerrain(),timeline:!1,animation:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,fullscreenButton:!1,imageryProvider:r,creditContainer:l}),f.value=n.value.imageryLayers;const s=n.value.scene.globe.tileLoadProgressEvent.addEventListener(function(g){g===0&&(requestAnimationFrame(function(){c.isLoading=!1,h()}),s())}),i=n.value.entities.add({position:a.Cartesian3.fromDegrees(0,90,0),description:"North Pole Anchor"});n.value.trackedEntity=i;const I=n.value.scene.screenSpaceCameraController;I.enableTilt=!0,I.enableZoom=!0,I.enableRotate=!0,I.constrainedAxis=a.Cartesian3.UNIT_Z;try{w.value=n.value.imageryLayers.get(0)}catch{w.value=null}try{const C=a.Cartesian3.fromDegrees(0,89.5,3e7),$=a.Cartesian3.fromDegrees(0,90,15e6);n.value.camera.setView({destination:C}),await n.value.camera.flyTo({destination:$,orientation:{heading:0,pitch:-Math.PI/2,roll:0},duration:2,easingFunction:a.EasingFunction.QUADRATIC_IN_OUT})}catch{}try{const g=w.value&&w.value.imageryProvider;_(g,5e3).then(()=>{v()})}catch{v()}},A=r=>{if(r<0||r>=o.fetchedUrls.length)return;const s=o.fetchedUrls[r];let i;try{i=f.value.addImageryProvider(new a.SingleTileImageryProvider({url:s,rectangle:a.Rectangle.fromDegrees(-180,-90,180,90)}))}catch{}return i},N=r=>{if(!(typeof r!="number"||r<0||r>o.fetchedUrls.length)){if(!o.isPlaying){e(r);return}m(),e(r),h()}};O(()=>o.isPlaying,r=>{r?h():m()});const Z=Y(()=>o.dateType==="daily"?ie():se());return q(()=>{if(n.value&&!n.value.isDestroyed())try{n.value.destroy()}catch{}t.id&&(clearInterval(t.id),t.id=null);try{l&&l.parentNode&&l.parentNode.removeChild(l)}catch{}l=null}),u({initCesium:L,restart:M}),(r,s)=>{const i=k("vue-fontawesome"),I=k("b-slider-tick"),g=k("b-slider"),D=k("b-field");return B(),V("div",ce,[s[3]||(s[3]=S("div",{id:"cesiumContainer"},null,-1)),S("div",ue,[S("div",de,[E(b(i,{onClick:s[0]||(s[0]=C=>r.$emit("handlePlay")),icon:"circle-play",class:"has-text-white",size:"lg"},null,512),[[z,!y.isPlaying]]),E(b(i,{onClick:s[1]||(s[1]=C=>r.$emit("handlePause")),icon:"circle-pause",class:"has-text-white",size:"lg"},null,512),[[z,y.isPlaying]])]),S("section",me,[b(D,null,{default:F(()=>[b(g,{onChange:N,modelValue:U(d),"onUpdate:modelValue":s[2]||(s[2]=C=>W(d)?d.value=C:null),min:0,max:o.fetchedUrls.length||14,ticks:""},{default:F(()=>[(B(!0),V(j,null,G(o.fetchedUrls.length,(C,$)=>(B(),X(I,{key:C,value:C},{default:F(()=>[K(ee(U(Z)[$]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","max"])]),_:1})])])])}}},fe=Q(ye,[["__scopeId","data-v-68afe8ce"]]);function H(y=[],u={}){const{concurrency:a=2,initialBatch:c=3,onProgress:o=null,name:n=""}=u,t=new Array(y.length).fill("pending");let l=!1;const d=(...e)=>{if(typeof o=="function")try{o(...e)}catch{}},w=new Set;function P(e,{timeoutMs:v=15e3}={}){return e<0||e>=y.length||t[e]==="loaded"||t[e]==="loading"?Promise.resolve():(t[e]="loading",d(e,t[e],n),new Promise(p=>{const _=new Image;w.add(_);let L=null;const A=N=>{L&&(clearTimeout(L),L=null),_.onload=null,_.onerror=null,w.delete(_),p(N)};_.onload=()=>{t[e]="loaded",d(e,t[e],n),A({index:e,status:"loaded"})},_.onerror=()=>{t[e]="error",d(e,t[e],n),A({index:e,status:"error"})},v>0&&(L=setTimeout(()=>{t[e]="error",d(e,t[e],n),_.onload=null,_.onerror=null;try{_.src=""}catch{}w.delete(_),p({index:e,status:"error",reason:"timeout"})},v)),_.src=y[e]}))}async function f(){if(l)return;const e=Math.min(c,y.length),v=[];for(let p=0;p<e;p++)v.push(P(p));await Promise.all(v),l=!0}async function h(){let e=0;const v=new Array(Math.max(1,a)).fill(0).map(async()=>{for(;;){const p=e++;if(p>=y.length)return;t[p]==="loaded"||t[p]==="error"||await P(p)}});await Promise.all(v)}function m(){for(const e of w)try{e.onload=null,e.onerror=null,e.src=""}catch{}w.clear();for(let e=0;e<t.length;e++)(t[e]==="loading"||t[e]==="pending")&&(t[e]="error",d(e,t[e],n))}function M(){m()}return{urls:y,status:t,get initialLoaded(){return l},loadInitial:f,loadAll:h,cancelAll:m,dispose:M}}const he={class:"realTimeForecastContainer"},ge={__name:"index",setup(y){const u=R(),a=T(null),c=T([]),o=T([]),n=T([]);let t=null,l=null;function d(f,h,m){}const w=async()=>{try{const h=(await re()||[]).map(m=>m.path||m.url||m);o.value=h,t=H(h,{concurrency:3,initialBatch:3,onProgress:d,name:"daily"}),await t.loadInitial(),u.dateType==="daily"&&(c.value=o.value)}catch{}},P=async()=>{try{const h=(await oe()||[]).map(m=>m.path||m.url||m);n.value=h,l=H(h,{concurrency:2,initialBatch:0,onProgress:d,name:"monthly"}),l.loadAll().then(()=>{})}catch{}};return O(()=>u.dateType,async f=>{f==="daily"?c.value=o.value:c.value=n.value,te().then(()=>{a.value&&a.value.restart()})}),ae(async()=>{if(u.isLoading=!0,await Promise.allSettled([w(),P()]),t&&t.loadAll().then(()=>{}),a.value&&typeof a.value.initCesium=="function")try{a.value.initCesium()}catch{}}),ne(()=>{a.value&&(a.value=null),t&&(t.cancelAll(),t=null)}),(f,h)=>{const m=k("b-tab-item"),M=k("b-tabs"),e=k("b-section"),v=fe;return B(),V("div",he,[b(e,{class:"switcherSection"},{default:F(()=>[b(M,{type:"is-toggle",size:"is-small",modelValue:U(u).dateType,"onUpdate:modelValue":h[0]||(h[0]=p=>U(u).dateType=p)},{default:F(()=>[b(m,{label:"未来14日",value:"daily"}),b(m,{label:"未来12月",value:"monthly"})]),_:1},8,["modelValue"])]),_:1}),b(v,{"date-type":U(u).dateType,"fetched-urls":c.value,onHandlePlay:U(u).play,onHandlePause:U(u).pause,"is-playing":U(u).isPlaying,ref_key:"sphereRef",ref:a},null,8,["date-type","fetched-urls","onHandlePlay","onHandlePause","is-playing"])])}}},we=Q(ge,[["__scopeId","data-v-082a62b8"]]);export{we as default};
