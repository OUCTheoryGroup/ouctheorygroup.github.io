import{_ as q,b as z,r as T,w as O,e as j,f as Q,g as k,c as H,o as M,a as B,h as V,v as E,i as I,j as S,k as W,u as D,F as G,l as J,m as K,n as X,t as ee,p as te,q as ae,s as ne}from"./index-CwjyL_I4.js";import{g as re,a as oe}from"./index-BbFGagmH.js";const le="/seaice/assets/default-earth-image-CM3n2ZyH.png",se=()=>{const f=[],u=new Date;let a=u.getFullYear(),c=u.getMonth()+1;c++,c>12&&(c=1,a++);for(let o=0;o<12;o++){const n=c<10?`0${c}`:`${c}`;f.push(`${a}-${n}`),c++,c>12&&(c=1,a++)}return f},ie=()=>{const f=[],u=new Date;for(let a=0;a<14;a++){const c=new Date(u);c.setDate(u.getDate()+a),c.getFullYear();const o=c.getMonth()+1,n=c.getDate(),t=o<10?`0${o}`:`${o}`,l=n<10?`0${n}`:`${n}`;f.push(`${t}-${l}`)}return f},ce={class:"cesiumComponentContainer"},ue={class:"controllerContainer"},de={class:"playAndPause"},me={style:{flex:"1",margin:"0 10px"}},fe={__name:"index",props:{initialCoords:{type:Array,default:()=>[-180,-90,180,90]},autoStart:{type:Boolean,default:!0},isPlaying:{type:Boolean,default:!0},switchInterval:{type:Number,default:1500},fetchedUrls:{type:Array,default:()=>[]},dateType:{type:String,default:"daily"}},emits:["handlePlay","handlePause"],setup(f,{expose:u}){let a=window.Cesium;const c=z(),o=f,n=T(null),t={id:null};let l=null;const d=T(0),w=T(null),P=T(null),y=T(null),h=()=>{t.id||(t.id=setInterval(e,o.switchInterval))},m=()=>{t.id&&(clearInterval(t.id),t.id=null)},$=()=>{m(),d.value=0,e(0),h()},e=r=>{let s;r!==void 0?s=r:s=(d.value+1)%o.fetchedUrls.length;const i=L(s%o.fetchedUrls.length),b=i&&i.imageryProvider;try{i.alpha=0,i.show=!1}catch{}_(b,5e3).then(async g=>{try{d.value=s,i.show=!0,y.value.raiseToTop(i),await p(i,0,1,600);try{y.value.remove(P.value,!0)}catch{}P.value=i}catch{try{y.value.remove(P.value,!0)}catch{}P.value=i,d.value=s}}).catch(g=>{setTimeout(()=>{try{y.value.remove(P.value,!0)}catch{}P.value=i,d.value=s},100)})},v=()=>{d.value=0,P.value=L(d.value)},p=(r,s,i,b=600)=>new Promise(g=>{const U=performance.now(),C=F=>{const N=Math.min(1,(F-U)/b),Y=s+(i-s)*N;try{r.alpha=Y}catch{}N<1?requestAnimationFrame(C):g()};requestAnimationFrame(C)}),_=(r,s=5e3)=>{if(!r||!r.readyPromise)return Promise.resolve();let i=null;return Promise.race([r.readyPromise,new Promise((b,g)=>{i=setTimeout(()=>g(new Error("provider ready timeout")),s)})]).finally(()=>{i&&clearTimeout(i)})},A=async()=>{a.Ion.defaultAccessToken=void 0;const r=new a.SingleTileImageryProvider({url:le,rectangle:a.Rectangle.fromDegrees(...o.initialCoords)});l||(l=document.createElement("div"),l.style.position="absolute",l.style.width="0px",l.style.height="0px",l.style.overflow="hidden",l.style.left="-9999px",l.style.top="-9999px",document.body.appendChild(l)),n.value=new a.Viewer("cesiumContainer",{terrainProvider:new a.EllipsoidTerrainProvider,timeline:!1,animation:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,fullscreenButton:!1,imageryProvider:r,creditContainer:l}),y.value=n.value.imageryLayers;const s=n.value.scene.globe.tileLoadProgressEvent.addEventListener(function(g){g===0&&(requestAnimationFrame(function(){c.isLoading=!1,h()}),s())}),i=n.value.entities.add({position:a.Cartesian3.fromDegrees(0,90,0),description:"North Pole Anchor"});n.value.trackedEntity=i;const b=n.value.scene.screenSpaceCameraController;b.enableTilt=!0,b.enableZoom=!0,b.enableRotate=!0,b.constrainedAxis=a.Cartesian3.UNIT_Z;try{w.value=n.value.imageryLayers.get(0)}catch{w.value=null}try{const C=a.Cartesian3.fromDegrees(0,89.5,3e7),F=a.Cartesian3.fromDegrees(0,90,15e6);n.value.camera.setView({destination:C}),await n.value.camera.flyTo({destination:F,orientation:{heading:0,pitch:-Math.PI/2,roll:0},duration:2,easingFunction:a.EasingFunction.QUADRATIC_IN_OUT})}catch{}try{const g=w.value&&w.value.imageryProvider;_(g,5e3).then(()=>{v()})}catch{v()}},L=r=>{if(r<0||r>=o.fetchedUrls.length)return;const s=o.fetchedUrls[r];let i;try{i=y.value.addImageryProvider(new a.SingleTileImageryProvider({url:s,rectangle:a.Rectangle.fromDegrees(-180,-90,180,90)}))}catch{}return i},x=r=>{if(!(typeof r!="number"||r<0||r>o.fetchedUrls.length)){if(!o.isPlaying){e(r);return}m(),e(r),h()}};O(()=>o.isPlaying,r=>{r?h():m()});const Z=j(()=>o.dateType==="daily"?ie():se());return Q(()=>{if(n.value&&!n.value.isDestroyed())try{n.value.destroy()}catch{}t.id&&(clearInterval(t.id),t.id=null);try{l&&l.parentNode&&l.parentNode.removeChild(l)}catch{}l=null}),u({initCesium:A,restart:$}),(r,s)=>{const i=k("vue-fontawesome"),b=k("b-slider-tick"),g=k("b-slider"),U=k("b-field");return M(),H("div",ce,[s[3]||(s[3]=B("div",{id:"cesiumContainer"},null,-1)),B("div",ue,[B("div",de,[V(I(i,{onClick:s[0]||(s[0]=C=>r.$emit("handlePlay")),icon:"circle-play",class:"has-text-white",size:"lg"},null,512),[[E,!f.isPlaying]]),V(I(i,{onClick:s[1]||(s[1]=C=>r.$emit("handlePause")),icon:"circle-pause",class:"has-text-white",size:"lg"},null,512),[[E,f.isPlaying]])]),B("section",me,[I(U,null,{default:S(()=>[I(g,{onChange:x,modelValue:D(d),"onUpdate:modelValue":s[2]||(s[2]=C=>W(d)?d.value=C:null),min:0,max:o.fetchedUrls.length||14,ticks:""},{default:S(()=>[(M(!0),H(G,null,J(o.fetchedUrls.length,(C,F)=>(M(),K(b,{key:C,value:C},{default:S(()=>[X(ee(D(Z)[F]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","max"])]),_:1})])])])}}},ye=q(fe,[["__scopeId","data-v-606541db"]]);function R(f=[],u={}){const{concurrency:a=2,initialBatch:c=3,onProgress:o=null,name:n=""}=u,t=new Array(f.length).fill("pending");let l=!1;const d=(...e)=>{if(typeof o=="function")try{o(...e)}catch{}},w=new Set;function P(e,{timeoutMs:v=15e3}={}){return e<0||e>=f.length||t[e]==="loaded"||t[e]==="loading"?Promise.resolve():(t[e]="loading",d(e,t[e],n),new Promise(p=>{const _=new Image;w.add(_);let A=null;const L=x=>{A&&(clearTimeout(A),A=null),_.onload=null,_.onerror=null,w.delete(_),p(x)};_.onload=()=>{t[e]="loaded",d(e,t[e],n),L({index:e,status:"loaded"})},_.onerror=()=>{t[e]="error",d(e,t[e],n),L({index:e,status:"error"})},v>0&&(A=setTimeout(()=>{t[e]="error",d(e,t[e],n),_.onload=null,_.onerror=null;try{_.src=""}catch{}w.delete(_),p({index:e,status:"error",reason:"timeout"})},v)),_.src=f[e]}))}async function y(){if(l)return;const e=Math.min(c,f.length),v=[];for(let p=0;p<e;p++)v.push(P(p));await Promise.all(v),l=!0}async function h(){let e=0;const v=new Array(Math.max(1,a)).fill(0).map(async()=>{for(;;){const p=e++;if(p>=f.length)return;t[p]==="loaded"||t[p]==="error"||await P(p)}});await Promise.all(v)}function m(){for(const e of w)try{e.onload=null,e.onerror=null,e.src=""}catch{}w.clear();for(let e=0;e<t.length;e++)(t[e]==="loading"||t[e]==="pending")&&(t[e]="error",d(e,t[e],n))}function $(){m()}return{urls:f,status:t,get initialLoaded(){return l},loadInitial:y,loadAll:h,cancelAll:m,dispose:$}}const he={class:"realTimeForecastContainer"},ge={__name:"index",setup(f){const u=z(),a=T(null),c=T([]),o=T([]),n=T([]);let t=null,l=null;function d(y,h,m){}const w=async()=>{try{const h=(await re()||[]).map(m=>m.path||m.url||m);o.value=h,t=R(h,{concurrency:3,initialBatch:3,onProgress:d,name:"daily"}),await t.loadInitial(),u.dateType==="daily"&&(c.value=o.value)}catch{}},P=async()=>{try{const h=(await oe()||[]).map(m=>m.path||m.url||m);n.value=h,l=R(h,{concurrency:2,initialBatch:0,onProgress:d,name:"monthly"}),l.loadAll().then(()=>{})}catch{}};return O(()=>u.dateType,async y=>{y==="daily"?c.value=o.value:c.value=n.value,te().then(()=>{a.value&&a.value.restart()})}),ae(async()=>{if(u.isLoading=!0,await Promise.allSettled([w(),P()]),t&&t.loadAll().then(()=>{}),a.value&&typeof a.value.initCesium=="function")try{a.value.initCesium()}catch{}}),ne(()=>{a.value&&(a.value=null),t&&(t.cancelAll(),t=null)}),(y,h)=>{const m=k("b-tab-item"),$=k("b-tabs"),e=k("b-section"),v=ye;return M(),H("div",he,[I(e,{class:"switcherSection"},{default:S(()=>[I($,{type:"is-toggle",size:"is-small",modelValue:D(u).dateType,"onUpdate:modelValue":h[0]||(h[0]=p=>D(u).dateType=p)},{default:S(()=>[I(m,{label:"未来14日",value:"daily"}),I(m,{label:"未来12月",value:"monthly"})]),_:1},8,["modelValue"])]),_:1}),I(v,{"date-type":D(u).dateType,"fetched-urls":c.value,onHandlePlay:D(u).play,onHandlePause:D(u).pause,"is-playing":D(u).isPlaying,ref_key:"sphereRef",ref:a},null,8,["date-type","fetched-urls","onHandlePlay","onHandlePause","is-playing"])])}}},we=q(ge,[["__scopeId","data-v-d1798896"]]);export{we as default};
