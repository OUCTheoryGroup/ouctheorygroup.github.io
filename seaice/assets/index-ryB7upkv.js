import{_ as et}from"./result_mask-DVoKs7o9.js";import{b as st,p as ot,u as at}from"./index-D_eHaR1i.js";import{d as lt,r as b,_ as nt,p as it,w as ct,e as P,q as rt,s as ut,g as d,c as k,o as f,a as s,i as n,t as m,u as t,j as p,k as A,F as E,l as S,n as I,m as B,y as dt,z as V,A as mt}from"./index-D1ToNYlt.js";const pt=lt("predictionTest",()=>{const o=b([]),h=b([]);function r(e){for(;e.value.length>3;)y(e.value[2].timerId),e.value.splice(3)}function u(e,L){o.value.unshift({task_id:e,type:L,created_time:new Date().toLocaleString()}),v({status:"处理中",task_id:e,timeId:null,type:L}),c(h.value[0]),r(o)}function v(e){h.value.unshift(e),r(h)}function c(e,L=2e3){y(e.timerId),e.timerId=setInterval(async()=>{try{const T=await st(e.task_id,e.type);(T.status==="COMPLETED"||T.status==="FAILED")&&(e.status=T.status==="COMPLETED"?"完成":"失败",e.images=T.data.images,clearInterval(e.timerId),e.timerId=null)}catch{}},L)}function $(){for(const e of h.value)e.status!="完成"&&e.status!="失败"&&c(e)}function w(){for(const e of h.value)e.timerId&&(clearInterval(e.timerId),e.timerId=null)}function y(e){e&&(clearInterval(e),e=null)}return{taskList:o,addTask:u,resultList:h,addResult:v,pollTaskStatus:c,clearAllTimers:w,pollAllTaskStatus:$}},{persist:{enabled:!0,strategies:[{key:"predictionTest",storage:localStorage,paths:["taskList","resultList"]}]}}),_t={class:"forecastTestContainer"},ft={class:"formContainer"},gt={class:"title"},ht={style:{margin:"10px 0"}},vt={class:"upload-dropzone"},yt={class:"uploadIconBox"},bt={class:"uploadHint"},Tt={class:"tags"},kt=["onClick"],Lt={class:"resultContainer"},It={class:"title"},wt={class:"resultList"},xt={class:"taskId"},Dt={class:"idBox"},Ft={class:"tag"},Ct=["onClick"],Mt={key:0,class:"iconBox"},Vt={key:1,class:"iconBox"},$t={class:"createdTime"},At={class:"modalBox"},Et={class:"title"},St={class:"content"},Bt={class:"carouselBox",style:{display:"flex","justify-content":"center","flex-direction":"column","align-items":"center"}},Nt=["src"],Ut={__name:"index",setup(H){const{t:o}=it(),h="https://assets-seaice-eo.52lxy.top",r=pt(),u=b([]),v=b(null),c=b("daily"),$=i=>{const a=new Date(i).getFullYear(),g=new Date(i).getMonth()+1,x=new Date(i).getDate(),C=g<10?"0"+g:g,D=x<10?"0"+x:x;v.value=c.value==="monthly"?`${a}/${C}`:`${a}/${C}/${D}`};ct(c,i=>{u.value=[],v.value=null});const w=b([]),y=P(()=>c.value==="daily"?14:12),e=i=>{u.value.splice(i,1)},L=i=>{const a=i.filter(g=>g.type==="image/png"||/\.png$/i.test(g.name));u.value=a.slice(0,y.value)},T=P(()=>`${o("forecastTest.uploadedFiles")}: ${u.value.length} / ${y.value}`),z=async()=>{if(u.value.length===0){V("common.message.uploadImageFirst");return}if(!v.value){V("common.message.selectDateFirst");return}try{await G(u.value);const i=await ot(c.value,v.value,w.value);if(i.success){mt("common.message.uploadSuccess");const a=i.data;r.addTask(a.task_id,c.value)}}catch{V("common.message.uploadFail")}finally{X()}},G=async i=>{await at(i).then(a=>{w.value=a}).catch(a=>{V("common.message.imageUploadFail")})},X=()=>{u.value=[],v.value=null,w.value=[]},F=b(!1),N=b(null),O=i=>{r.resultList[i].status==="完成"&&(F.value=!0,N.value=i)};return rt(()=>{r.pollAllTaskStatus()}),ut(()=>{r.clearAllTimers()}),(i,a)=>{const g=d("b-tab-item"),x=d("b-tabs"),C=d("b-progress"),D=d("b-field"),j=d("b-datepicker"),M=d("vue-fontawesome"),q=d("b-upload"),W=d("b-button"),Y=d("b-tooltip"),J=d("b-message"),U=d("b-tag"),K=d("b-notification"),Q=d("b-carousel-item"),Z=d("b-carousel"),R=d("b-modal");return f(),k("div",_t,[s("div",ft,[s("h3",gt,m(t(o)("forecastTest.title")),1),n(x,{type:"is-toggle",size:"is-small",class:"typeTabs",modelValue:t(c),"onUpdate:modelValue":a[2]||(a[2]=l=>A(c)?c.value=l:null)},{default:p(()=>[n(g,{label:t(o)("forecastTest.daily"),value:"daily",onClick:a[0]||(a[0]=l=>c.value="daily")},null,8,["label"]),n(g,{label:t(o)("forecastTest.monthly"),value:"monthly",onClick:a[1]||(a[1]=l=>c.value="monthly")},null,8,["label"])]),_:1},8,["modelValue"]),s("section",null,[n(D,{label:t(T),require:""},{default:p(()=>[n(C,{style:{margin:"10px auto"},value:t(u).length,max:t(y)},null,8,["value","max"])]),_:1},8,["label"])]),s("section",ht,[n(D,{label:t(c)==="monthly"?t(o)("forecastTest.selectMonthStart"):t(o)("forecastTest.selectDateStart")},{default:p(()=>[n(j,{type:t(c)==="monthly"?"month":void 0,"onUpdate:modelValue":$,size:"is-small",style:{width:"330px"},placeholder:t(c)==="monthly"?t(o)("common.placeholder.selectMonth"):t(o)("common.placeholder.selectDate"),"trap-focus":""},null,8,["type","placeholder"])]),_:1},8,["label"])]),s("section",null,[n(D,null,{default:p(()=>[n(q,{modelValue:t(u),"onUpdate:modelValue":[a[3]||(a[3]=l=>A(u)?u.value=l:null),L],multiple:"","drag-drop":"",accept:"image/png",disabled:t(u).length>=t(y)},{default:p(()=>[s("section",vt,[s("p",yt,[n(M,{icon:"upload"})]),s("p",bt,m(t(o)("forecastTest.uploadHint",{num:t(y)})),1)])]),_:1},8,["modelValue","disabled"])]),_:1}),s("div",Tt,[(f(!0),k(E,null,S(t(u),(l,_)=>(f(),k("span",{key:_,class:"tag is-light is-dark"},[I(m(l.name)+" ",1),s("button",{class:"delete is-small",type:"button",onClick:tt=>e(_)},null,8,kt)]))),128))])]),n(W,{class:"submitBtn",type:"is-dark",size:"is-small",onClick:z},{default:p(()=>[I(m(t(o)("common.button.submitAnalysis")),1)]),_:1})]),s("div",Lt,[s("h3",It,[I(m(t(o)("forecastTest.resultTitle"))+" ",1),n(Y,{label:t(o)("forecastTest.resultTooltip"),position:"is-right",type:"is-dark"},{default:p(()=>[n(M,{icon:"circle-exclamation"})]),_:1},8,["label"])]),s("section",null,[t(r).taskList.length==0?(f(),B(J,{key:0},{default:p(()=>[I(m(t(o)("common.message.submitToViewPrediction")),1)]),_:1})):dt("",!0)]),s("section",wt,[(f(!0),k(E,null,S(t(r).taskList,(l,_)=>(f(),B(K,{closable:!1,key:l.task_id},{default:p(()=>[s("div",xt,[s("span",Dt,m(t(o)("components.resultDisplay.taskId"))+": "+m(l.task_id),1),s("span",Ft,[n(U,{type:"is-info is-light"},{default:p(()=>[I(m(l.type==="daily"?t(o)("forecastTest.dailyForecast"):t(o)("forecastTest.monthlyForecast")),1)]),_:2},1024),n(U,{type:t(r).resultList[_].status==="完成"?"is-success is-light":"is-warning is-light"},{default:p(()=>[I(m(t(r).resultList[_].status==="完成"?t(o)("common.status.completed"):t(r).resultList[_].status==="进行中"?t(o)("common.status.processing"):t(r).resultList[_].status),1)]),_:2},1032,["type"])])]),s("div",{class:"resultMask",onClick:tt=>O(_)},[a[5]||(a[5]=s("img",{src:et,alt:""},null,-1)),t(r).resultList[_].status==="完成"?(f(),k("span",Mt,[n(M,{class:"eyeIcon",icon:"eye"})])):(f(),k("span",Vt,[n(M,{class:"eyeIcon",icon:"eye-slash"})]))],8,Ct),s("div",$t,m(t(o)("components.resultDisplay.submitTime"))+": "+m(l.created_time),1)]),_:2},1024))),128))])]),n(R,{modelValue:t(F),"onUpdate:modelValue":a[4]||(a[4]=l=>A(F)?F.value=l:null)},{default:p(()=>[s("div",At,[s("h3",Et,m(t(o)("forecastTest.modalTitle")),1),s("div",St,[n(Z,{"progress-type":"is-dark","pause-text":""},{default:p(()=>[(f(!0),k(E,null,S(t(r).resultList[t(N)].images,(l,_)=>(f(),B(Q,{key:_},{default:p(()=>[s("section",null,[s("div",Bt,[s("img",{src:l.path.startsWith("http")?l.path:t(h)+l.path,alt:""},null,8,Nt),s("p",null,m(l.date),1)])])]),_:2},1024))),128))]),_:1})])])]),_:1},8,["modelValue"])])}}},Gt=nt(Ut,[["__scopeId","data-v-e2be3246"]]);export{Gt as default};
