import{a4 as H,a9 as d,ao as X,ap as q,aq as v,ar as Y,as as $,at as b,au as W,av as J,aw as P,ax as Q,ay as Z,az as R,a5 as j,a8 as T,aA as x,aB as V,M as k,aC as tt,ad as M,aD as et,aE as it,aF as rt}from"./index-yh27qCC3.js";import{i as nt}from"./extension-BIqXtCLz.js";function D(r){return r==null?0:r.length||1}function B(r){return r}var st=function(){function r(t,e,i,n,s,o){this._old=t,this._new=e,this._oldKeyGetter=i||B,this._newKeyGetter=n||B,this.context=s,this._diffModeMultiple=o==="multiple"}return r.prototype.add=function(t){return this._add=t,this},r.prototype.update=function(t){return this._update=t,this},r.prototype.updateManyToOne=function(t){return this._updateManyToOne=t,this},r.prototype.updateOneToMany=function(t){return this._updateOneToMany=t,this},r.prototype.updateManyToMany=function(t){return this._updateManyToMany=t,this},r.prototype.remove=function(t){return this._remove=t,this},r.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},r.prototype._executeOneToOne=function(){var t=this._old,e=this._new,i={},n=new Array(t.length),s=new Array(e.length);this._initIndexMap(t,null,n,"_oldKeyGetter"),this._initIndexMap(e,i,s,"_newKeyGetter");for(var o=0;o<t.length;o++){var a=n[o],u=i[a],p=D(u);if(p>1){var h=u.shift();u.length===1&&(i[a]=u[0]),this._update&&this._update(h,o)}else p===1?(i[a]=null,this._update&&this._update(u,o)):this._remove&&this._remove(o)}this._performRestAdd(s,i)},r.prototype._executeMultiple=function(){var t=this._old,e=this._new,i={},n={},s=[],o=[];this._initIndexMap(t,i,s,"_oldKeyGetter"),this._initIndexMap(e,n,o,"_newKeyGetter");for(var a=0;a<s.length;a++){var u=s[a],p=i[u],h=n[u],l=D(p),f=D(h);if(l>1&&f===1)this._updateManyToOne&&this._updateManyToOne(h,p),n[u]=null;else if(l===1&&f>1)this._updateOneToMany&&this._updateOneToMany(h,p),n[u]=null;else if(l===1&&f===1)this._update&&this._update(h,p),n[u]=null;else if(l>1&&f>1)this._updateManyToMany&&this._updateManyToMany(h,p),n[u]=null;else if(l>1)for(var _=0;_<l;_++)this._remove&&this._remove(p[_]);else this._remove&&this._remove(p)}this._performRestAdd(o,n)},r.prototype._performRestAdd=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=e[n],o=D(s);if(o>1)for(var a=0;a<o;a++)this._add&&this._add(s[a]);else o===1&&this._add&&this._add(s);e[n]=null}},r.prototype._initIndexMap=function(t,e,i,n){for(var s=this._diffModeMultiple,o=0;o<t.length;o++){var a="_ec_"+this[n](t[o],o);if(s||(i[o]=a),!!e){var u=e[a],p=D(u);p===0?(e[a]=o,s&&i.push(a)):p===1?e[a]=[u,o]:u.push(o)}}},r}(),ot=function(){function r(t,e){this._encode=t,this._schema=e}return r.prototype.get=function(){return{fullDimensions:this._getFullDimensionNames(),encode:this._encode}},r.prototype._getFullDimensionNames=function(){return this._cachedDimNames||(this._cachedDimNames=this._schema?this._schema.makeOutputDimensionNames():[]),this._cachedDimNames},r}();function at(r,t){var e={},i=e.encode={},n=H(),s=[],o=[],a={};d(r.dimensions,function(f){var _=r.getDimensionInfo(f),m=_.coordDim;if(m){var O=_.coordDimIndex;C(i,m)[O]=f,_.isExtraCoord||(n.set(m,1),ut(_.type)&&(s[0]=f),C(a,m)[O]=r.getDimensionIndex(_.name)),_.defaultTooltip&&o.push(f)}X.each(function(E,G){var K=C(i,G),A=_.otherDims[G];A!=null&&A!==!1&&(K[A]=_.name)})});var u=[],p={};n.each(function(f,_){var m=i[_];p[_]=m[0],u=u.concat(m)}),e.dataDimsOnCoord=u,e.dataDimIndicesOnCoord=q(u,function(f){return r.getDimensionInfo(f).storeDimIndex}),e.encodeFirstDimNotExtra=p;var h=i.label;h&&h.length&&(s=h.slice());var l=i.tooltip;return l&&l.length?o=l.slice():o.length||(o=s.slice()),i.defaultedLabel=s,i.defaultedTooltip=o,e.userOutput=new ot(a,t),e}function C(r,t){return r.hasOwnProperty(t)||(r[t]=[]),r[t]}function ct(r){return r==="category"?"ordinal":r==="time"?"time":"float"}function ut(r){return!(r==="ordinal"||r==="time")}var L=function(){function r(t){this.otherDims={},t!=null&&v(this,t)}return r}(),y=j,c=q,ht=typeof Int32Array>"u"?Array:Int32Array,ft="e\0\0",U=-1,pt=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],_t=["_approximateExtent"],z,w,g,I,N,S,F,vt=function(){function r(t,e){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","minmaxDownSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","minmaxDownSample","lttbDownSample"];var i,n=!1;nt(t)?(i=t.dimensions,this._dimOmitted=t.isDimensionOmitted(),this._schema=t):(n=!0,i=t),i=i||["x","y"];for(var s={},o=[],a={},u=!1,p={},h=0;h<i.length;h++){var l=i[h],f=Y(l)?new L({name:l}):l instanceof L?l:new L(l),_=f.name;f.type=f.type||"float",f.coordDim||(f.coordDim=_,f.coordDimIndex=0);var m=f.otherDims=f.otherDims||{};o.push(_),s[_]=f,p[_]!=null&&(u=!0),f.createInvertedIndices&&(a[_]=[]),m.itemName===0&&(this._nameDimIdx=h),m.itemId===0&&(this._idDimIdx=h),n&&(f.storeDimIndex=h)}if(this.dimensions=o,this._dimInfos=s,this._initGetDimensionInfo(u),this.hostModel=e,this._invertedIndicesMap=a,this._dimOmitted){var O=this._dimIdxToName=H();d(o,function(E){O.set(s[E].storeDimIndex,E)})}}return r.prototype.getDimension=function(t){var e=this._recognizeDimIndex(t);if(e==null)return t;if(e=t,!this._dimOmitted)return this.dimensions[e];var i=this._dimIdxToName.get(e);if(i!=null)return i;var n=this._schema.getSourceDimension(e);if(n)return n.name},r.prototype.getDimensionIndex=function(t){var e=this._recognizeDimIndex(t);if(e!=null)return e;if(t==null)return-1;var i=this._getDimInfo(t);return i?i.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(t):-1},r.prototype._recognizeDimIndex=function(t){if($(t)||t!=null&&!isNaN(t)&&!this._getDimInfo(t)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(t)<0))return+t},r.prototype._getStoreDimIndex=function(t){var e=this.getDimensionIndex(t);return e},r.prototype.getDimensionInfo=function(t){return this._getDimInfo(this.getDimension(t))},r.prototype._initGetDimensionInfo=function(t){var e=this._dimInfos;this._getDimInfo=t?function(i){return e.hasOwnProperty(i)?e[i]:void 0}:function(i){return e[i]}},r.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},r.prototype.mapDimension=function(t,e){var i=this._dimSummary;if(e==null)return i.encodeFirstDimNotExtra[t];var n=i.encode[t];return n?n[e]:null},r.prototype.mapDimensionsAll=function(t){var e=this._dimSummary,i=e.encode[t];return(i||[]).slice()},r.prototype.getStore=function(){return this._store},r.prototype.initData=function(t,e,i){var n=this,s;if(t instanceof P&&(s=t),!s){var o=this.dimensions,a=b(t)||W(t)?new J(t,o.length):t;s=new P;var u=c(o,function(p){return{type:n._dimInfos[p].type,property:p}});s.initData(a,u,i)}this._store=s,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,s.count()),this._dimSummary=at(this,this._schema),this.userOutput=this._dimSummary.userOutput},r.prototype.appendData=function(t){var e=this._store.appendData(t);this._doInit(e[0],e[1])},r.prototype.appendValues=function(t,e){var i=this._store.appendValues(t,e&&e.length),n=i.start,s=i.end,o=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),e)for(var a=n;a<s;a++){var u=a-n;this._nameList[a]=e[u],o&&F(this,a)}},r.prototype._updateOrdinalMeta=function(){for(var t=this._store,e=this.dimensions,i=0;i<e.length;i++){var n=this._dimInfos[e[i]];n.ordinalMeta&&t.collectOrdinalMeta(n.storeDimIndex,n.ordinalMeta)}},r.prototype._shouldMakeIdFromName=function(){var t=this._store.getProvider();return this._idDimIdx==null&&t.getSource().sourceFormat!==Q&&!t.fillStorage},r.prototype._doInit=function(t,e){if(!(t>=e)){var i=this._store,n=i.getProvider();this._updateOrdinalMeta();var s=this._nameList,o=this._idList,a=n.getSource().sourceFormat,u=a===rt;if(u&&!n.pure)for(var p=[],h=t;h<e;h++){var l=n.getItem(h,p);if(!this.hasItemOption&&Z(l)&&(this.hasItemOption=!0),l){var f=l.name;s[h]==null&&f!=null&&(s[h]=R(f,null));var _=l.id;o[h]==null&&_!=null&&(o[h]=R(_,null))}}if(this._shouldMakeIdFromName())for(var h=t;h<e;h++)F(this,h);z(this)}},r.prototype.getApproximateExtent=function(t){return this._approximateExtent[t]||this._store.getDataExtent(this._getStoreDimIndex(t))},r.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},r.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},r.prototype.setCalculationInfo=function(t,e){y(t)?v(this._calculationInfo,t):this._calculationInfo[t]=e},r.prototype.getName=function(t){var e=this.getRawIndex(t),i=this._nameList[e];return i==null&&this._nameDimIdx!=null&&(i=g(this,this._nameDimIdx,e)),i==null&&(i=""),i},r.prototype._getCategory=function(t,e){var i=this._store.get(t,e),n=this._store.getOrdinalMeta(t);return n?n.categories[i]:i},r.prototype.getId=function(t){return w(this,this.getRawIndex(t))},r.prototype.count=function(){return this._store.count()},r.prototype.get=function(t,e){var i=this._store,n=this._dimInfos[t];if(n)return i.get(n.storeDimIndex,e)},r.prototype.getByRawIndex=function(t,e){var i=this._store,n=this._dimInfos[t];if(n)return i.getByRawIndex(n.storeDimIndex,e)},r.prototype.getIndices=function(){return this._store.getIndices()},r.prototype.getDataExtent=function(t){return this._store.getDataExtent(this._getStoreDimIndex(t))},r.prototype.getSum=function(t){return this._store.getSum(this._getStoreDimIndex(t))},r.prototype.getMedian=function(t){return this._store.getMedian(this._getStoreDimIndex(t))},r.prototype.getValues=function(t,e){var i=this,n=this._store;return T(t)?n.getValues(c(t,function(s){return i._getStoreDimIndex(s)}),e):n.getValues(t)},r.prototype.hasValue=function(t){for(var e=this._dimSummary.dataDimIndicesOnCoord,i=0,n=e.length;i<n;i++)if(isNaN(this._store.get(e[i],t)))return!1;return!0},r.prototype.indexOfName=function(t){for(var e=0,i=this._store.count();e<i;e++)if(this.getName(e)===t)return e;return-1},r.prototype.getRawIndex=function(t){return this._store.getRawIndex(t)},r.prototype.indexOfRawIndex=function(t){return this._store.indexOfRawIndex(t)},r.prototype.rawIndexOf=function(t,e){var i=t&&this._invertedIndicesMap[t],n=i&&i[e];return n==null||isNaN(n)?U:n},r.prototype.indicesOfNearest=function(t,e,i){return this._store.indicesOfNearest(this._getStoreDimIndex(t),e,i)},r.prototype.each=function(t,e,i){M(t)&&(i=e,e=t,t=[]);var n=i||this,s=c(I(t),this._getStoreDimIndex,this);this._store.each(s,n?x(e,n):e)},r.prototype.filterSelf=function(t,e,i){M(t)&&(i=e,e=t,t=[]);var n=i||this,s=c(I(t),this._getStoreDimIndex,this);return this._store=this._store.filter(s,n?x(e,n):e),this},r.prototype.selectRange=function(t){var e=this,i={},n=V(t);return d(n,function(s){var o=e._getStoreDimIndex(s);i[o]=t[s]}),this._store=this._store.selectRange(i),this},r.prototype.mapArray=function(t,e,i){M(t)&&(i=e,e=t,t=[]),i=i||this;var n=[];return this.each(t,function(){n.push(e&&e.apply(this,arguments))},i),n},r.prototype.map=function(t,e,i,n){var s=i||n||this,o=c(I(t),this._getStoreDimIndex,this),a=S(this);return a._store=this._store.map(o,s?x(e,s):e),a},r.prototype.modify=function(t,e,i,n){var s=i||n||this,o=c(I(t),this._getStoreDimIndex,this);this._store.modify(o,s?x(e,s):e)},r.prototype.downSample=function(t,e,i,n){var s=S(this);return s._store=this._store.downSample(this._getStoreDimIndex(t),e,i,n),s},r.prototype.minmaxDownSample=function(t,e){var i=S(this);return i._store=this._store.minmaxDownSample(this._getStoreDimIndex(t),e),i},r.prototype.lttbDownSample=function(t,e){var i=S(this);return i._store=this._store.lttbDownSample(this._getStoreDimIndex(t),e),i},r.prototype.getRawDataItem=function(t){return this._store.getRawDataItem(t)},r.prototype.getItemModel=function(t){var e=this.hostModel,i=this.getRawDataItem(t);return new k(i,e,e&&e.ecModel)},r.prototype.diff=function(t){var e=this;return new st(t?t.getStore().getIndices():[],this.getStore().getIndices(),function(i){return w(t,i)},function(i){return w(e,i)})},r.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},r.prototype.setVisual=function(t,e){this._visual=this._visual||{},y(t)?v(this._visual,t):this._visual[t]=e},r.prototype.getItemVisual=function(t,e){var i=this._itemVisuals[t],n=i&&i[e];return n??this.getVisual(e)},r.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},r.prototype.ensureUniqueItemVisual=function(t,e){var i=this._itemVisuals,n=i[t];n||(n=i[t]={});var s=n[e];return s==null&&(s=this.getVisual(e),T(s)?s=s.slice():y(s)&&(s=v({},s)),n[e]=s),s},r.prototype.setItemVisual=function(t,e,i){var n=this._itemVisuals[t]||{};this._itemVisuals[t]=n,y(e)?v(n,e):n[e]=i},r.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},r.prototype.setLayout=function(t,e){y(t)?v(this._layout,t):this._layout[t]=e},r.prototype.getLayout=function(t){return this._layout[t]},r.prototype.getItemLayout=function(t){return this._itemLayouts[t]},r.prototype.setItemLayout=function(t,e,i){this._itemLayouts[t]=i?v(this._itemLayouts[t]||{},e):e},r.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},r.prototype.setItemGraphicEl=function(t,e){var i=this.hostModel&&this.hostModel.seriesIndex;tt(i,this.dataType,t,e),this._graphicEls[t]=e},r.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},r.prototype.eachItemGraphicEl=function(t,e){d(this._graphicEls,function(i,n){i&&t&&t.call(e,i,n)})},r.prototype.cloneShallow=function(t){return t||(t=new r(this._schema?this._schema:c(this.dimensions,this._getDimInfo,this),this.hostModel)),N(t,this),t._store=this._store,t},r.prototype.wrapMethod=function(t,e){var i=this[t];M(i)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var n=i.apply(this,arguments);return e.apply(this,[n].concat(et(arguments)))})},r.internalField=function(){z=function(t){var e=t._invertedIndicesMap;d(e,function(i,n){var s=t._dimInfos[n],o=s.ordinalMeta,a=t._store;if(o){i=e[n]=new ht(o.categories.length);for(var u=0;u<i.length;u++)i[u]=U;for(var u=0;u<a.count();u++)i[a.get(s.storeDimIndex,u)]=u}})},g=function(t,e,i){return R(t._getCategory(e,i),null)},w=function(t,e){var i=t._idList[e];return i==null&&t._idDimIdx!=null&&(i=g(t,t._idDimIdx,e)),i==null&&(i=ft+e),i},I=function(t){return T(t)||(t=t!=null?[t]:[]),t},S=function(t){var e=new r(t._schema?t._schema:c(t.dimensions,t._getDimInfo,t),t.hostModel);return N(e,t),e},N=function(t,e){d(pt.concat(e.__wrappedMethods||[]),function(i){e.hasOwnProperty(i)&&(t[i]=e[i])}),t.__wrappedMethods=e.__wrappedMethods,d(_t,function(i){t[i]=it(e[i])}),t._calculationInfo=v({},e._calculationInfo)},F=function(t,e){var i=t._nameList,n=t._idList,s=t._nameDimIdx,o=t._idDimIdx,a=i[e],u=n[e];if(a==null&&s!=null&&(i[e]=a=g(t,s,e)),u==null&&o!=null&&(n[e]=u=g(t,o,e)),u==null&&a!=null){var p=t._nameRepeatCount,h=p[a]=(p[a]||0)+1;u=a,h>1&&(u+="__ec__"+h),n[e]=u}}}(),r}();export{vt as S,L as a,ct as g};
