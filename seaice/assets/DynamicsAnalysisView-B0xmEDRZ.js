import{F as x,G as A,H as D,o as w,I as U,J as N,K as B,L as C,q as L,D as _}from"./element-plus-vendor-BSOUQG5-.js";import{r as m,x as S,z as F,m as c,s as v,M as l,K as o,o as p,G as b,O as G,a6 as f,P as K}from"./vue-vendor-DB0sj3qF.js";import{_ as T,L as O,a as P,e as q,f as z}from"./index-CpiUH-Zi.js";import"./utils-vendor-D8rVyQy1.js";const H={class:"container-layout"},J={class:"main-content"},$={key:0,class:"loading-container"},j={key:1,class:"result-section"},Q={__name:"DynamicsAnalysisView",setup(W){const e=m({dataRange:[],grad_forecast_month:1,grad_month:"",grad_lat_lon:"",grad_type:"sum"}),g=m([]),i=m(!1),s=m(!1),r=m(null);S([()=>e.value.dataRange,()=>e.value.grad_forecast_month],([t,a])=>{if(t&&t[1]&&a){const u=new Date(t[1].substring(0,4),parseInt(t[1].substring(4))-1);u.setMonth(u.getMonth()+a),e.value.grad_month=String(u.getMonth()+1).padStart(2,"0")}else e.value.grad_month=""});const h=async()=>{if(r.value)try{const t=await z(r.value);t.length!==0&&(g.value=t,i.value=!0,_.success("分析完成"),s.value=!1,r.value=null)}catch(t){if(t.response&&t.response.status===400){console.log("Task not completed yet, continuing polling...");return}console.error("轮询分析结果出错:",t),s.value=!1,i.value=!1,_.error("获取分析结果失败")}},y=async()=>{if(!e.value.dataRange||!e.value.dataRange[0]||!e.value.dataRange[1]||!e.value.grad_month||!e.value.grad_forecast_month){_.error("请填写完整的分析参数");return}try{s.value=!0,i.value=!1;const t=await q(e.value.dataRange[0],e.value.dataRange[1],e.value.grad_type,e.value.grad_month);r.value=t.task_id;const a=setInterval(async()=>{await h(),s.value||clearInterval(a)},2e3)}catch(t){i.value=!1,s.value=!1,_.error("提交分析请求失败，请重试"),console.error("Analysis error:",t)}};return F(()=>{r.value&&(r.value=null)}),(t,a)=>{const u=w,d=D,M=U,E=N,V=C,k=B,I=L,R=A,Y=x;return p(),c("div",H,[a[9]||(a[9]=v("div",{class:"sidebar"},null,-1)),v("div",J,[a[8]||(a[8]=v("div",{class:"sidebar"},null,-1)),l(Y,{class:"box-card"},{default:o(()=>[l(R,{model:e.value,onSubmit:G(y,["prevent"])},{default:o(()=>[l(d,{label:"数据范围"},{default:o(()=>[l(u,{modelValue:e.value.dataRange,"onUpdate:modelValue":a[0]||(a[0]=n=>e.value.dataRange=n),type:"monthrange","range-separator":"至","start-placeholder":"开始月份","end-placeholder":"结束月份",format:"YYYY-MM","value-format":"YYYYMM"},null,8,["modelValue"])]),_:1}),l(d,{label:"预报提前期"},{default:o(()=>[l(M,{modelValue:e.value.grad_forecast_month,"onUpdate:modelValue":a[1]||(a[1]=n=>e.value.grad_forecast_month=n),min:1,placeholder:"请输入提前期（月）"},null,8,["modelValue"])]),_:1}),l(d,{label:"目标月份"},{default:o(()=>[l(u,{modelValue:e.value.grad_month,"onUpdate:modelValue":a[2]||(a[2]=n=>e.value.grad_month=n),type:"month",placeholder:"目标月份由数据范围和预报提前期决定",format:"MM","value-format":"MM",disabled:""},null,8,["modelValue"])]),_:1}),l(d,{label:"分析范围"},{default:o(()=>[l(E,{modelValue:e.value.grad_lat_lon,"onUpdate:modelValue":a[3]||(a[3]=n=>e.value.grad_lat_lon=n),disabled:"",placeholder:"请输入经纬度范围（目前只支持全范围）"},null,8,["modelValue"])]),_:1}),l(d,{label:"分析目标"},{default:o(()=>[l(k,{modelValue:e.value.grad_type,"onUpdate:modelValue":a[4]||(a[4]=n=>e.value.grad_type=n)},{default:o(()=>[l(V,{value:"sum"},{default:o(()=>a[5]||(a[5]=[f("海冰面积")])),_:1}),l(V,{value:"variation"},{default:o(()=>a[6]||(a[6]=[f("海冰变化")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:o(()=>[l(I,{type:"primary",loading:s.value,onClick:y},{default:o(()=>[f(K(s.value?"分析中...":"提交分析"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),s.value?(p(),c("div",$,[l(O)])):b("",!0),!s.value&&i.value?(p(),c("div",j,[a[7]||(a[7]=v("h3",{class:"result-title"},"分析结果热图",-1)),l(P,{images:g.value,alt:"分析结果热图",class:"full-width"},null,8,["images"])])):b("",!0)]),_:1})])])}}},la=T(Q,[["__scopeId","data-v-18d4737a"]]);export{la as default};
