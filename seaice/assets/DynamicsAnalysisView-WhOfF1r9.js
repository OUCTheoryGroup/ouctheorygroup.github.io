import{aP as D,aQ as L,au as _e,aR as Ve,aS as Ne,aw as xe,ax as de,aN as Ie,ay as Me,v as S,aT as q,az as R,aU as j,U as z,w as ce,aV as Ee,y as I,B as _,aW as oe,Q as $,A as y,F as i,aX as H,aH as te,aI as Q,E as x,D as T,aY as we,aZ as Se,aK as re,a_ as ke,a$ as $e,b0 as Ae,R as O,b1 as ue,b2 as Ce,aG as De,aL as Pe,_ as ne,z as f,b3 as Fe,b4 as Re,X as w,T as J,V as Ye,W as ae,L as Ue,Y as F,b5 as Le,b6 as Oe}from"./index-DG9jATsB.js";import{E as ze,a as Ke,b as We,c as Ge,d as Xe}from"./el-radio-tJcyp3fA.js";import{U as Y,I as Z,C as me,u as Be,c as je,d as He,v as ie,a as Qe,i as Te,E as qe,b as Ze}from"./el-button-BGILTIxt.js";import{g as le,E as Je}from"./util-C1DbpjV7.js";const et=_e({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:Ne,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:p=>p===null||D(p)||["min","max"].includes(p),default:null},name:String,placeholder:String,precision:{type:Number,validator:p=>p>=0&&p===Number.parseInt(`${p}`,10)},validateEvent:{type:Boolean,default:!0},...Ve(["ariaLabel"])}),tt={[me]:(p,n)=>n!==p,blur:p=>p instanceof FocusEvent,focus:p=>p instanceof FocusEvent,[Z]:p=>D(p)||L(p),[Y]:p=>D(p)||L(p)},at=de({name:"ElInputNumber"}),lt=de({...at,props:et,emits:tt,setup(p,{expose:n,emit:g}){const o=p,{t:h}=Ie(),v=Me("input-number"),b=S(),a=q({currentValue:o.modelValue,userInput:null}),{formItem:t}=Be(),A=R(()=>D(o.modelValue)&&o.modelValue<=o.min),d=R(()=>D(o.modelValue)&&o.modelValue>=o.max),l=R(()=>{const e=K(o.step);return j(o.precision)?Math.max(K(o.modelValue),e):(e>o.precision,o.precision)}),m=R(()=>o.controls&&o.controlsPosition==="right"),r=je(),u=He(),k=R(()=>{if(a.userInput!==null)return a.userInput;let e=a.currentValue;if(L(e))return"";if(D(e)){if(Number.isNaN(e))return"";j(o.precision)||(e=e.toFixed(o.precision))}return e}),P=(e,s)=>{if(j(s)&&(s=l.value),s===0)return Math.round(e);let c=String(e);const V=c.indexOf(".");if(V===-1||!c.replace(".","").split("")[V+s])return e;const X=c.length;return c.charAt(X-1)==="5"&&(c=`${c.slice(0,Math.max(0,X-1))}6`),Number.parseFloat(Number(c).toFixed(s))},K=e=>{if(L(e))return 0;const s=e.toString(),c=s.indexOf(".");let V=0;return c!==-1&&(V=s.length-c-1),V},W=(e,s=1)=>D(e)?P(e+o.step*s):a.currentValue,U=()=>{if(o.readonly||u.value||d.value)return;const e=Number(k.value)||0,s=W(e);G(s),g(Z,a.currentValue),ee()},M=()=>{if(o.readonly||u.value||A.value)return;const e=Number(k.value)||0,s=W(e,-1);G(s),g(Z,a.currentValue),ee()},se=(e,s)=>{const{max:c,min:V,step:N,precision:C,stepStrictly:X,valueOnClear:B}=o;c<V&&Ce("InputNumber","min should not be greater than max.");let E=Number(e);if(L(e)||Number.isNaN(E))return null;if(e===""){if(B===null)return null;E=De(B)?{min:V,max:c}[B]:B}return X&&(E=P(Math.round(E/N)*N,C),E!==e&&s&&g(Y,E)),j(C)||(E=P(E,C)),(E>c||E<V)&&(E=E>c?c:V,s&&g(Y,E)),E},G=(e,s=!0)=>{var c;const V=a.currentValue,N=se(e);if(!s){g(Y,N);return}V===N&&e||(a.userInput=null,g(Y,N),V!==N&&g(me,N,V),o.validateEvent&&((c=t==null?void 0:t.validate)==null||c.call(t,"change").catch(C=>ue())),a.currentValue=N)},pe=e=>{a.userInput=e;const s=e===""?null:Number(e);g(Z,s),G(s,!1)},ve=e=>{const s=e!==""?Number(e):"";(D(s)&&!Number.isNaN(s)||e==="")&&G(s),ee(),a.userInput=null},fe=()=>{var e,s;(s=(e=b.value)==null?void 0:e.focus)==null||s.call(e)},ge=()=>{var e,s;(s=(e=b.value)==null?void 0:e.blur)==null||s.call(e)},he=e=>{g("focus",e)},be=e=>{var s,c;a.userInput=null,Te()&&a.currentValue===null&&((s=b.value)!=null&&s.input)&&(b.value.input.value=""),g("blur",e),o.validateEvent&&((c=t==null?void 0:t.validate)==null||c.call(t,"blur").catch(V=>ue()))},ee=()=>{a.currentValue!==o.modelValue&&(a.currentValue=o.modelValue)},ye=e=>{document.activeElement===e.target&&e.preventDefault()};return z(()=>o.modelValue,(e,s)=>{const c=se(e,!0);a.userInput===null&&c!==s&&(a.currentValue=c)},{immediate:!0}),ce(()=>{var e;const{min:s,max:c,modelValue:V}=o,N=(e=b.value)==null?void 0:e.input;if(N.setAttribute("role","spinbutton"),Number.isFinite(c)?N.setAttribute("aria-valuemax",String(c)):N.removeAttribute("aria-valuemax"),Number.isFinite(s)?N.setAttribute("aria-valuemin",String(s)):N.removeAttribute("aria-valuemin"),N.setAttribute("aria-valuenow",a.currentValue||a.currentValue===0?String(a.currentValue):""),N.setAttribute("aria-disabled",String(u.value)),!D(V)&&V!=null){let C=Number(V);Number.isNaN(C)&&(C=null),g(Y,C)}N.addEventListener("wheel",ye,{passive:!1})}),Ee(()=>{var e,s;const c=(e=b.value)==null?void 0:e.input;c==null||c.setAttribute("aria-valuenow",`${(s=a.currentValue)!=null?s:""}`)}),n({focus:fe,blur:ge}),(e,s)=>(_(),I("div",{class:te([i(v).b(),i(v).m(i(r)),i(v).is("disabled",i(u)),i(v).is("without-controls",!e.controls),i(v).is("controls-right",i(m))]),onDragstart:O(()=>{},["prevent"])},[e.controls?oe((_(),I("span",{key:0,role:"button","aria-label":i(h)("el.inputNumber.decrease"),class:te([i(v).e("decrease"),i(v).is("disabled",i(A))]),onKeydown:H(M,["enter"])},[Q(e.$slots,"decrease-icon",{},()=>[y(i(re),null,{default:x(()=>[i(m)?(_(),T(i(we),{key:0})):(_(),T(i(Se),{key:1}))]),_:1})])],42,["aria-label","onKeydown"])),[[i(ie),M]]):$("v-if",!0),e.controls?oe((_(),I("span",{key:1,role:"button","aria-label":i(h)("el.inputNumber.increase"),class:te([i(v).e("increase"),i(v).is("disabled",i(d))]),onKeydown:H(U,["enter"])},[Q(e.$slots,"increase-icon",{},()=>[y(i(re),null,{default:x(()=>[i(m)?(_(),T(i(ke),{key:0})):(_(),T(i($e),{key:1}))]),_:1})])],42,["aria-label","onKeydown"])),[[i(ie),U]]):$("v-if",!0),y(i(Qe),{id:e.id,ref_key:"input",ref:b,type:"number",step:e.step,"model-value":i(k),placeholder:e.placeholder,readonly:e.readonly,disabled:i(u),size:i(r),max:e.max,min:e.min,name:e.name,"aria-label":e.ariaLabel,"validate-event":!1,onKeydown:[H(O(U,["prevent"]),["up"]),H(O(M,["prevent"]),["down"])],onBlur:be,onFocus:he,onInput:pe,onChange:ve},Ae({_:2},[e.$slots.prefix?{name:"prefix",fn:x(()=>[Q(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:x(()=>[Q(e.$slots,"suffix")])}:void 0]),1032,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","onKeydown"])],42,["onDragstart"]))}});var nt=xe(lt,[["__file","input-number.vue"]]);const st=Pe(nt),ot={class:"dynamics-viewer"},rt={class:"image-container"},ut={key:0,class:"loading-overlay"},it=["src","alt","onClick","onLoad"],dt={class:"image-date-label"},ct={key:0,class:"empty-state"},mt=["src"],pt={class:"image-date"},vt={__name:"DynamicsAnalysisViewer",props:{images:{type:Array,required:!0}},setup(p){const n=p,g=S(null),o=S(1),h=S([]),v=R(()=>!n.images||n.images.length===0?1:Math.ceil(n.images.length/2)),b=l=>new Promise((m,r)=>{const u=new Image;u.onload=()=>m(),u.onerror=r,u.src=l}),a=()=>{!n.images||n.images.length===0||n.images.forEach((l,m)=>{b(le(l.path)).then(()=>{h.value[m]=!1}).catch(r=>{console.error(`Failed to load image: ${l.path}`,r),h.value[m]=!1})})};z(()=>n.images,l=>{l&&l.length>0&&(h.value=new Array(l.length).fill(!0),a())},{immediate:!0});const t=l=>{h.value[l]=!1},A=l=>{l&&(g.value=l,o.value=1)},d=l=>{const m=Math.sign(l.deltaY),r=Math.max(1,Math.min(3,o.value-m*.2));o.value=r,l.preventDefault()};return ce(()=>{a()}),(l,m)=>(_(),I("div",ot,[m[4]||(m[4]=f("h2",{class:"section-title"},"动力学分析结果热图",-1)),f("div",{class:"image-grid",style:J({"--images-per-row":v.value})},[(_(!0),I(Fe,null,Re(p.images,(r,u)=>(_(),I("div",{key:u,class:"image-card"},[f("div",rt,[h.value[u]?(_(),I("div",ut,m[2]||(m[2]=[f("div",{class:"loading-spinner"},null,-1)]))):$("",!0),f("img",{src:i(le)(r.path),alt:`${r.date} - 动力学分析结果`,class:"analysis-image",onClick:k=>A(r),onLoad:k=>t(u)},null,40,it)]),f("div",dt,w(r.date),1)]))),128))],4),!p.images||p.images.length===0?(_(),I("div",ct,[y(i(Je),{description:"暂无分析结果"})])):$("",!0),g.value?(_(),I("div",{key:1,class:"modal-overlay",onWheel:d,onClick:m[1]||(m[1]=O(r=>g.value=null,["self"]))},[f("div",{class:"modal-content",style:J({transform:`scale(${o.value})`})},[f("img",{src:i(le)(g.value.path),alt:"放大查看",class:"modal-image"},null,8,mt),f("p",pt,w(g.value.date),1)],4),f("button",{onClick:m[0]||(m[0]=r=>g.value=null),class:"close-button"},m[3]||(m[3]=[f("svg",{class:"close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))],32)):$("",!0)]))}},ft=ne(vt,[["__scopeId","data-v-3dd3c4e2"]]),gt="/seaice/picture/land_image.png",ht={class:"image-selector"},bt={key:0,class:"selection-info-container"},yt={class:"selection-info"},_t={__name:"ImageSelector",props:{topLeft:{type:Object,default:()=>({x:null,y:null})},bottomRight:{type:Object,default:()=>({x:null,y:null})}},emits:["update:topLeft","update:bottomRight"],setup(p,{emit:n}){const g=p,o=n,h=S(null),v=S(!1),b=q({x:0,y:0}),a=q({left:0,top:0,width:0,height:0}),t=q({left:0,top:0,width:0,height:0,isVisible:!1}),A=r=>{r.preventDefault(),v.value=!0;const u=h.value.getBoundingClientRect();b.x=r.clientX-u.left,b.y=r.clientY-u.top,a.left=b.x,a.top=b.y,a.width=0,a.height=0},d=r=>{if(!v.value)return;const u=h.value.getBoundingClientRect(),k=Math.min(Math.max(r.clientX-u.left,0),u.width),P=Math.min(Math.max(r.clientY-u.top,0),u.height);a.left=Math.min(k,b.x),a.top=Math.min(P,b.y),a.width=Math.abs(k-b.x),a.height=Math.abs(P-b.y)},l=()=>{v.value=!1,a.width>0&&a.height>0&&(t.left=a.left,t.top=a.top,t.width=a.width,t.height=a.height,t.isVisible=!0,o("update:topLeft",{x:Math.round(t.left),y:Math.round(t.top)}),o("update:bottomRight",{x:Math.round(t.left+t.width),y:Math.round(t.top+t.height)}))};z(()=>[g.topLeft,g.bottomRight],([r,u])=>{(r==null?void 0:r.x)!==null&&(r==null?void 0:r.y)!==null&&(u==null?void 0:u.x)!==null&&(u==null?void 0:u.y)!==null?(t.left=r.x,t.top=r.y,t.width=u.x-r.x,t.height=u.y-r.y,t.isVisible=!0):t.isVisible=!1},{immediate:!0});const m=()=>{t.left=0,t.top=0,t.width=0,t.height=0,t.isVisible=!1,a.left=0,a.top=0,a.width=0,a.height=0,o("update:topLeft",{x:null,y:null}),o("update:bottomRight",{x:null,y:null})};return(r,u)=>(_(),I("div",ht,[f("div",{class:"image-container",ref_key:"imageContainer",ref:h,onMousedown:A,onMousemove:d,onMouseup:l,onMouseleave:l},[u[0]||(u[0]=f("img",{src:gt,alt:"Selectable Image",draggable:"false"},null,-1)),v.value?(_(),I("div",{key:0,class:"selection",style:J({left:`${a.left}px`,top:`${a.top}px`,width:`${a.width}px`,height:`${a.height}px`})},null,4)):$("",!0),t.isVisible?(_(),I("div",{key:1,class:"last-selection",style:J({left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`,height:`${t.height}px`})},null,4)):$("",!0)],544),t.isVisible?(_(),I("div",bt,[f("div",yt,[u[1]||(u[1]=f("p",null,"最后选择区域尺寸:",-1)),f("p",null,"宽度: "+w(Math.round(t.width))+"px",1),f("p",null,"高度: "+w(Math.round(t.height))+"px",1),u[2]||(u[2]=f("p",null,"角坐标:",-1)),f("p",null,"左上: ("+w(Math.round(t.left))+", "+w(Math.round(t.top))+")",1),f("p",null," 右上: ("+w(Math.round(t.left+t.width))+", "+w(Math.round(t.top))+") ",1),f("p",null," 左下: ("+w(Math.round(t.left))+", "+w(Math.round(t.top+t.height))+") ",1),f("p",null," 右下: ("+w(Math.round(t.left+t.width))+", "+w(Math.round(t.top+t.height))+") ",1)]),f("button",{class:"clear-button",onClick:m},"清除选择")])):$("",!0)]))}},Vt=ne(_t,[["__scopeId","data-v-dd0002e0"]]),Nt={class:"container-layout"},xt={class:"main-content"},It={key:0,class:"loading-container"},Mt={key:1,class:"result-section"},Et={__name:"DynamicsAnalysisView",setup(p){const n=S({dataRange:[],grad_forecast_month:1,grad_month:"",grad_lat_lon:"",grad_type:"sum",x1:null,y1:null,x2:null,y2:null}),g=S([]),o=S(!1),h=S(!1),v=S(null),b=S({x:null,y:null}),a=S({x:null,y:null});z([b,a],([d,l])=>{n.value.x1=d.y,n.value.y1=d.x,n.value.x2=l.y,n.value.y2=l.x},{immediate:!0,deep:!0}),z([()=>n.value.dataRange,()=>n.value.grad_forecast_month],([d,l])=>{if(d&&d[1]&&l){const m=new Date(d[1].substring(0,4),parseInt(d[1].substring(4))-1);m.setMonth(m.getMonth()+l),n.value.grad_month=String(m.getMonth()+1).padStart(2,"0")}else n.value.grad_month=""});const t=async()=>{if(v.value)try{const d=await Oe(v.value);d.success&&d.status==="COMPLETED"?(g.value=d.data.images,o.value=!0,F.success(d.message||"分析完成"),h.value=!1,v.value=null):d.status==="IN_PROGRESS"?console.log("Task not completed yet, continuing polling..."):d.status==="FAILED"&&(console.error("分析任务失败:",d.message),h.value=!1,o.value=!1,F.error(d.message||"分析任务失败"),v.value=null)}catch(d){console.error("轮询分析结果出错:",d),h.value=!1,o.value=!1,F.error("获取分析结果失败"),v.value=null}},A=async()=>{if(!n.value.dataRange||!n.value.dataRange[0]||!n.value.dataRange[1]||!n.value.grad_month||!n.value.grad_forecast_month){F.error("请填写完整的分析参数");return}try{h.value=!0,o.value=!1;const d=await Le(n.value.dataRange[0],n.value.dataRange[1],n.value.grad_type,n.value.grad_month,n.value.x1,n.value.y1,n.value.x2,n.value.y2);if(d.success)v.value=d.data.task_id;else{h.value=!1,F.error(d.message||"提交分析请求失败");return}const l=setInterval(async()=>{await t(),h.value||clearInterval(l)},2e3)}catch(d){o.value=!1,h.value=!1,F.error("提交分析请求失败，请重试"),console.error("Analysis error:",d)}};return Ye(()=>{v.value&&(v.value=null)}),(d,l)=>{const m=qe,r=We,u=st,k=Xe,P=Ge,K=Ze,W=Ke,U=ze;return _(),I("div",Nt,[f("div",xt,[y(U,{class:"box-card"},{default:x(()=>[y(W,{model:n.value,onSubmit:O(A,["prevent"]),class:"analysis-form"},{default:x(()=>[y(r,{label:"数据范围"},{default:x(()=>[y(m,{modelValue:n.value.dataRange,"onUpdate:modelValue":l[0]||(l[0]=M=>n.value.dataRange=M),type:"monthrange","range-separator":"至","start-placeholder":"开始月份","end-placeholder":"结束月份",format:"YYYY-MM","value-format":"YYYYMM"},null,8,["modelValue"])]),_:1}),y(r,{label:"预报提前期"},{default:x(()=>[y(u,{modelValue:n.value.grad_forecast_month,"onUpdate:modelValue":l[1]||(l[1]=M=>n.value.grad_forecast_month=M),min:1,placeholder:"请输入提前期（月）"},null,8,["modelValue"])]),_:1}),y(r,{label:"目标月份"},{default:x(()=>[y(m,{modelValue:n.value.grad_month,"onUpdate:modelValue":l[2]||(l[2]=M=>n.value.grad_month=M),type:"month",placeholder:"目标月份由数据范围和预报提前期决定",format:"MM","value-format":"MM",disabled:""},null,8,["modelValue"])]),_:1}),y(r,{label:"分析范围"},{default:x(()=>[y(Vt,{topLeft:b.value,"onUpdate:topLeft":l[3]||(l[3]=M=>b.value=M),bottomRight:a.value,"onUpdate:bottomRight":l[4]||(l[4]=M=>a.value=M)},null,8,["topLeft","bottomRight"])]),_:1}),y(r,{label:"分析目标"},{default:x(()=>[y(P,{modelValue:n.value.grad_type,"onUpdate:modelValue":l[5]||(l[5]=M=>n.value.grad_type=M)},{default:x(()=>[y(k,{value:"sum"},{default:x(()=>l[6]||(l[6]=[ae("海冰面积")])),_:1}),y(k,{value:"variation"},{default:x(()=>l[7]||(l[7]=[ae("海冰变化")])),_:1})]),_:1},8,["modelValue"])]),_:1}),y(r,null,{default:x(()=>[y(K,{type:"primary",loading:h.value,onClick:A},{default:x(()=>[ae(w(h.value?"分析中...":"提交分析"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),h.value?(_(),I("div",It,[y(Ue)])):$("",!0),!h.value&&o.value?(_(),I("div",Mt,[y(ft,{images:g.value,class:"full-width"},null,8,["images"])])):$("",!0)]),_:1})])])}}},At=ne(Et,[["__scopeId","data-v-eb1dbe68"]]);export{At as default};
