import{_ as H,b as z,r as I,w as q,e as G,f as J,g as U,c as $,o as V,a as D,h as N,v as E,i as C,j as A,k as Y,u as P,F as K,l as Q,m as X,n as ee,t as te,p as ae,q as ne,s as le,x as re}from"./index-X2tWaOn-.js";import{g as oe,a as se}from"./index-B7C8AgHp.js";const ie="/seaice/assets/basemap_8k-DIYoJH_7.webp",ce={class:"cesiumComponentContainer"},ue={class:"controllerContainer"},de={class:"playAndPause"},me={style:{flex:"1",margin:"0 10px"}},ye={__name:"index",props:{initialCoords:{type:Array,default:()=>[-180,-90,180,90]},autoStart:{type:Boolean,default:!0},isPlaying:{type:Boolean,default:!0},switchInterval:{type:Number,default:1500},fetchedUrls:{type:Array,default:()=>[]},dateType:{type:String,default:"daily"},defaultImageUrl:{type:String,default:ie}},emits:["handlePlay","handlePause"],setup(_,{expose:L}){let o=window.Cesium;const h=z(),r=_,i=I(null),a={id:null};let s=null;const u=I(0),p=I(null),g=I(null),c=I(null),v=()=>{a.id||(a.id=setInterval(e,r.switchInterval))},m=()=>{a.id&&(clearInterval(a.id),a.id=null)},x=()=>{m(),u.value=0,e(0),v()},e=t=>{let n;t!==void 0?n=t:n=(u.value+1)%r.fetchedUrls.length;const l=F(n%r.fetchedUrls.length),b=l&&l.imageryProvider;try{l.alpha=0,l.show=!1}catch{}f(b,5e3).then(async T=>{try{u.value=n,l.show=!0,c.value.raiseToTop(l),await d(l,0,1,600);try{c.value.remove(g.value,!0)}catch{}g.value=l}catch{try{c.value.remove(g.value,!0)}catch{}g.value=l,u.value=n}}).catch(T=>{setTimeout(()=>{try{c.value.remove(g.value,!0)}catch{}g.value=l,u.value=n},100)})},y=()=>{u.value=0,g.value=F(u.value)},d=(t,n,l,b=600)=>new Promise(T=>{const S=performance.now(),w=R=>{const M=Math.min(1,(R-S)/b),Z=n+(l-n)*M;try{t.alpha=Z}catch{}M<1?requestAnimationFrame(w):T()};requestAnimationFrame(w)}),f=(t,n=5e3)=>{if(!t||!t.readyPromise)return Promise.resolve();let l=null;return Promise.race([t.readyPromise,new Promise((b,T)=>{l=setTimeout(()=>T(new Error("provider ready timeout")),n)})]).finally(()=>{l&&clearTimeout(l)})},k=()=>r.dateType==="monthly"?new o.SingleTileImageryProvider({url:r.defaultImageUrl,rectangle:o.Rectangle.fromDegrees(...r.initialCoords)}):new o.UrlTemplateImageryProvider({url:"https://webst02.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",minimumLevel:0,maximumLevel:7}),B=async()=>{const t=k();s||(s=document.createElement("div"),s.style.position="absolute",s.style.width="0px",s.style.height="0px",s.style.overflow="hidden",s.style.left="-9999px",s.style.top="-9999px",document.body.appendChild(s)),i.value=new o.Viewer("cesiumContainer",{timeline:!1,animation:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,fullscreenButton:!1,baseLayer:new o.ImageryLayer(t),creditContainer:s}),c.value=i.value.imageryLayers;const n=i.value.scene.globe.tileLoadProgressEvent.addEventListener(function(l){l===0&&(requestAnimationFrame(function(){h.isLoading=!1,v()}),n())});try{p.value=i.value.imageryLayers.get(0)}catch{p.value=null}try{i.value.scene.screenSpaceCameraController.minimumZoomDistance=25e4,i.value.scene.screenSpaceCameraController.maximumZoomDistance=2e7,i.value.camera.flyTo({destination:o.Cartesian3.fromDegrees(0,90,8e6),orientation:{heading:0,pitch:-o.Math.PI_OVER_TWO,roll:0},duration:2})}catch{}try{const l=p.value&&p.value.imageryProvider;f(l,5e3).then(()=>{y()})}catch{y()}},F=t=>{if(t<0||t>=r.fetchedUrls.length)return;const n=r.fetchedUrls[t],l=n.path||n.url||n;let b;try{b=c.value.addImageryProvider(O(l))}catch{}return b},O=t=>r.dateType==="monthly"?new o.SingleTileImageryProvider({url:t,rectangle:o.Rectangle.fromDegrees(-180,-90,180,90)}):new o.UrlTemplateImageryProvider({url:t,tilingScheme:new o.GeographicTilingScheme,minimumLevel:0,maximumLevel:6,hasAlphaChannel:!0,rectangle:o.Rectangle.fromDegrees(-180,30,180,90)}),j=t=>{if(!(typeof t!="number"||t<0||t>r.fetchedUrls.length)){if(!r.isPlaying){e(t);return}m(),e(t),v()}};q(()=>r.isPlaying,t=>{t?v():m()});const W=G(()=>{if(r.fetchedUrls&&r.fetchedUrls.length>0){const t=r.fetchedUrls[0];if(t&&typeof t=="object"&&t.date)return r.fetchedUrls.map(n=>n.date)}});return J(()=>{if(i.value&&!i.value.isDestroyed())try{i.value.destroy()}catch{}a.id&&(clearInterval(a.id),a.id=null);try{s&&s.parentNode&&s.parentNode.removeChild(s)}catch{}s=null}),L({initCesium:B,restart:x}),(t,n)=>{const l=U("vue-fontawesome"),b=U("b-slider-tick"),T=U("b-slider"),S=U("b-field");return V(),$("div",ce,[n[3]||(n[3]=D("div",{id:"cesiumContainer"},null,-1)),D("div",ue,[D("div",de,[N(C(l,{onClick:n[0]||(n[0]=w=>t.$emit("handlePlay")),icon:"circle-play",class:"has-text-white",size:"lg"},null,512),[[E,!_.isPlaying]]),N(C(l,{onClick:n[1]||(n[1]=w=>t.$emit("handlePause")),icon:"circle-pause",class:"has-text-white",size:"lg"},null,512),[[E,_.isPlaying]])]),D("section",me,[C(S,null,{default:A(()=>[C(T,{onChange:j,modelValue:P(u),"onUpdate:modelValue":n[2]||(n[2]=w=>Y(u)?u.value=w:null),min:0,max:r.fetchedUrls.length||14,ticks:""},{default:A(()=>[(V(!0),$(K,null,Q(r.fetchedUrls.length,(w,R)=>(V(),X(b,{key:w,value:w,class:"desktop-only"},{default:A(()=>[ee(te(P(W)[R]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","max"])]),_:1})])])])}}},fe=H(ye,[["__scopeId","data-v-40c9026e"]]);function he(_=[],L={}){const{concurrency:o=2,initialBatch:h=3,onProgress:r=null,name:i=""}=L,a=new Array(_.length).fill("pending");let s=!1;const u=(...e)=>{if(typeof r=="function")try{r(...e)}catch{}},p=new Set;function g(e,{timeoutMs:y=15e3}={}){return e<0||e>=_.length||a[e]==="loaded"||a[e]==="loading"?Promise.resolve():(a[e]="loading",u(e,a[e],i),new Promise(d=>{const f=new Image;p.add(f);let k=null;const B=F=>{k&&(clearTimeout(k),k=null),f.onload=null,f.onerror=null,p.delete(f),d(F)};f.onload=()=>{a[e]="loaded",u(e,a[e],i),B({index:e,status:"loaded"})},f.onerror=()=>{a[e]="error",u(e,a[e],i),B({index:e,status:"error"})},y>0&&(k=setTimeout(()=>{a[e]="error",u(e,a[e],i),f.onload=null,f.onerror=null;try{f.src=""}catch{}p.delete(f),d({index:e,status:"error",reason:"timeout"})},y)),f.src=_[e]}))}async function c(){if(s)return;const e=Math.min(h,_.length),y=[];for(let d=0;d<e;d++)y.push(g(d));await Promise.all(y),s=!0}async function v(){let e=0;const y=new Array(Math.max(1,o)).fill(0).map(async()=>{for(;;){const d=e++;if(d>=_.length)return;a[d]==="loaded"||a[d]==="error"||await g(d)}});await Promise.all(y)}function m(){for(const e of p)try{e.onload=null,e.onerror=null,e.src=""}catch{}p.clear();for(let e=0;e<a.length;e++)(a[e]==="loading"||a[e]==="pending")&&(a[e]="error",u(e,a[e],i))}function x(){m()}return{urls:_,status:a,get initialLoaded(){return s},loadInitial:c,loadAll:v,cancelAll:m,dispose:x}}const pe={class:"realTimeForecastContainer"},ge={__name:"index",setup(_){const{t:L}=ae(),o=z(),h=I(null),r=I([]),i=I([]),a=I([]);let s=null;function u(c,v,m){}const p=async()=>{try{const c=await oe();i.value=c||[],o.dateType==="daily"&&(r.value=i.value)}catch{}},g=async()=>{try{const c=await se();a.value=c||[];const v=(c||[]).map(m=>m.path||m.url||m);s=he(v,{concurrency:2,initialBatch:0,onProgress:u,name:"monthly"}),s.loadAll().then(()=>{})}catch{}};return q(()=>o.dateType,async c=>{c==="daily"?r.value=i.value:r.value=a.value,re().then(()=>{h.value&&h.value.restart()})}),ne(async()=>{if(o.isLoading=!0,await Promise.allSettled([p(),g()]),h.value&&typeof h.value.initCesium=="function")try{h.value.initCesium()}catch{}}),le(()=>{h.value&&(h.value=null)}),(c,v)=>{const m=U("b-tab-item"),x=U("b-tabs"),e=U("b-section"),y=fe;return V(),$("div",pe,[C(e,{class:"switcherSection"},{default:A(()=>[C(x,{type:"is-toggle",size:"is-small",modelValue:P(o).dateType,"onUpdate:modelValue":v[0]||(v[0]=d=>P(o).dateType=d)},{default:A(()=>[C(m,{label:P(L)("realTimeForecast.future14Days"),value:"daily"},null,8,["label"]),C(m,{label:P(L)("realTimeForecast.future12Months"),value:"monthly"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),C(y,{"date-type":P(o).dateType,"fetched-urls":r.value,onHandlePlay:P(o).play,onHandlePause:P(o).pause,"is-playing":P(o).isPlaying,ref_key:"sphereRef",ref:h},null,8,["date-type","fetched-urls","onHandlePlay","onHandlePause","is-playing"])])}}},Pe=H(ge,[["__scopeId","data-v-3ac51217"]]);export{Pe as default};
