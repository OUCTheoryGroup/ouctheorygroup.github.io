import{_ as q,b as z,r as I,w as O,e as j,f as Q,g as U,c as H,o as M,a as B,h as V,v as E,i as T,j as S,k as W,u as D,F as G,l as J,m as K,n as X,t as ee,p as te,q as ae,s as ne}from"./index-BlCOvXY8.js";import{g as oe,a as re}from"./index-CqhnPGQh.js";const le="/seaice/assets/default-earth-image-CM3n2ZyH.png",se=()=>{const y=[],u=new Date;let a=u.getFullYear(),c=u.getMonth()+1;c++,c>12&&(c=1,a++);for(let r=0;r<12;r++){const n=c<10?`0${c}`:`${c}`;y.push(`${a}-${n}`),c++,c>12&&(c=1,a++)}return y},ie=()=>{const y=[],u=new Date;for(let a=0;a<14;a++){const c=new Date(u);c.setDate(u.getDate()+a),c.getFullYear();const r=c.getMonth()+1,n=c.getDate(),t=r<10?`0${r}`:`${r}`,l=n<10?`0${n}`:`${n}`;y.push(`${t}-${l}`)}return y},ce={class:"cesiumComponentContainer"},ue={class:"controllerContainer"},de={class:"playAndPause"},me={style:{flex:"1",margin:"0 10px"}},ye={__name:"index",props:{initialCoords:{type:Array,default:()=>[-180,-90,180,90]},autoStart:{type:Boolean,default:!0},isPlaying:{type:Boolean,default:!0},switchInterval:{type:Number,default:1500},fetchedUrls:{type:Array,default:()=>[]},dateType:{type:String,default:"daily"}},emits:["handlePlay","handlePause"],setup(y,{expose:u}){let a=window.Cesium;const c=z(),r=y,n=I(null),t={id:null};let l=null;const d=I(0),w=I(null),P=I(null),f=I(null),h=()=>{t.id||(t.id=setInterval(e,r.switchInterval))},m=()=>{t.id&&(clearInterval(t.id),t.id=null)},A=()=>{m(),d.value=0,e(0),h()},e=o=>{let s;o!==void 0?s=o:s=(d.value+1)%r.fetchedUrls.length;const i=$(s%r.fetchedUrls.length),b=i&&i.imageryProvider;try{i.alpha=0,i.show=!1}catch{}_(b,5e3).then(async g=>{try{d.value=s,i.show=!0,f.value.raiseToTop(i),await p(i,0,1,600);try{f.value.remove(P.value,!0)}catch{}P.value=i}catch{try{f.value.remove(P.value,!0)}catch{}P.value=i,d.value=s}}).catch(g=>{setTimeout(()=>{try{f.value.remove(P.value,!0)}catch{}P.value=i,d.value=s},100)})},v=()=>{d.value=0,P.value=$(d.value)},p=(o,s,i,b=600)=>new Promise(g=>{const L=performance.now(),C=F=>{const N=Math.min(1,(F-L)/b),Y=s+(i-s)*N;try{o.alpha=Y}catch{}N<1?requestAnimationFrame(C):g()};requestAnimationFrame(C)}),_=(o,s=5e3)=>{if(!o||!o.readyPromise)return Promise.resolve();let i=null;return Promise.race([o.readyPromise,new Promise((b,g)=>{i=setTimeout(()=>g(new Error("provider ready timeout")),s)})]).finally(()=>{i&&clearTimeout(i)})},k=async()=>{a.Ion.defaultAccessToken=void 0;const o=new a.SingleTileImageryProvider({url:le,rectangle:a.Rectangle.fromDegrees(...r.initialCoords)});l||(l=document.createElement("div"),l.style.position="absolute",l.style.width="0px",l.style.height="0px",l.style.overflow="hidden",l.style.left="-9999px",l.style.top="-9999px",document.body.appendChild(l)),n.value=new a.Viewer("cesiumContainer",{timeline:!1,animation:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,baseLayerPicker:!1,navigationHelpButton:!1,fullscreenButton:!1,baseLayer:new a.ImageryLayer(o),creditContainer:l}),f.value=n.value.imageryLayers;const s=n.value.scene.globe.tileLoadProgressEvent.addEventListener(function(g){g===0&&(requestAnimationFrame(function(){c.isLoading=!1,h()}),s())}),i=n.value.entities.add({position:a.Cartesian3.fromDegrees(0,90,0),description:"North Pole Anchor"});n.value.trackedEntity=i;const b=n.value.scene.screenSpaceCameraController;b.enableTilt=!0,b.enableZoom=!0,b.enableRotate=!0,b.constrainedAxis=a.Cartesian3.UNIT_Z;try{w.value=n.value.imageryLayers.get(0)}catch{w.value=null}try{const C=a.Cartesian3.fromDegrees(0,89.5,3e7),F=a.Cartesian3.fromDegrees(0,90,15e6);n.value.camera.setView({destination:C}),await n.value.camera.flyTo({destination:F,orientation:{heading:0,pitch:-Math.PI/2,roll:0},duration:2,easingFunction:a.EasingFunction.QUADRATIC_IN_OUT})}catch{}try{const g=w.value&&w.value.imageryProvider;_(g,5e3).then(()=>{v()})}catch{v()}},$=o=>{if(o<0||o>=r.fetchedUrls.length)return;const s=r.fetchedUrls[o];let i;try{i=f.value.addImageryProvider(new a.SingleTileImageryProvider({url:s,rectangle:a.Rectangle.fromDegrees(-180,-90,180,90)}))}catch{}return i},x=o=>{if(!(typeof o!="number"||o<0||o>r.fetchedUrls.length)){if(!r.isPlaying){e(o);return}m(),e(o),h()}};O(()=>r.isPlaying,o=>{o?h():m()});const Z=j(()=>r.dateType==="daily"?ie():se());return Q(()=>{if(n.value&&!n.value.isDestroyed())try{n.value.destroy()}catch{}t.id&&(clearInterval(t.id),t.id=null);try{l&&l.parentNode&&l.parentNode.removeChild(l)}catch{}l=null}),u({initCesium:k,restart:A}),(o,s)=>{const i=U("vue-fontawesome"),b=U("b-slider-tick"),g=U("b-slider"),L=U("b-field");return M(),H("div",ce,[s[3]||(s[3]=B("div",{id:"cesiumContainer"},null,-1)),B("div",ue,[B("div",de,[V(T(i,{onClick:s[0]||(s[0]=C=>o.$emit("handlePlay")),icon:"circle-play",class:"has-text-white",size:"lg"},null,512),[[E,!y.isPlaying]]),V(T(i,{onClick:s[1]||(s[1]=C=>o.$emit("handlePause")),icon:"circle-pause",class:"has-text-white",size:"lg"},null,512),[[E,y.isPlaying]])]),B("section",me,[T(L,null,{default:S(()=>[T(g,{onChange:x,modelValue:D(d),"onUpdate:modelValue":s[2]||(s[2]=C=>W(d)?d.value=C:null),min:0,max:r.fetchedUrls.length||14,ticks:""},{default:S(()=>[(M(!0),H(G,null,J(r.fetchedUrls.length,(C,F)=>(M(),K(b,{key:C,value:C},{default:S(()=>[X(ee(D(Z)[F]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","max"])]),_:1})])])])}}},fe=q(ye,[["__scopeId","data-v-d403aed4"]]);function R(y=[],u={}){const{concurrency:a=2,initialBatch:c=3,onProgress:r=null,name:n=""}=u,t=new Array(y.length).fill("pending");let l=!1;const d=(...e)=>{if(typeof r=="function")try{r(...e)}catch{}},w=new Set;function P(e,{timeoutMs:v=15e3}={}){return e<0||e>=y.length||t[e]==="loaded"||t[e]==="loading"?Promise.resolve():(t[e]="loading",d(e,t[e],n),new Promise(p=>{const _=new Image;w.add(_);let k=null;const $=x=>{k&&(clearTimeout(k),k=null),_.onload=null,_.onerror=null,w.delete(_),p(x)};_.onload=()=>{t[e]="loaded",d(e,t[e],n),$({index:e,status:"loaded"})},_.onerror=()=>{t[e]="error",d(e,t[e],n),$({index:e,status:"error"})},v>0&&(k=setTimeout(()=>{t[e]="error",d(e,t[e],n),_.onload=null,_.onerror=null;try{_.src=""}catch{}w.delete(_),p({index:e,status:"error",reason:"timeout"})},v)),_.src=y[e]}))}async function f(){if(l)return;const e=Math.min(c,y.length),v=[];for(let p=0;p<e;p++)v.push(P(p));await Promise.all(v),l=!0}async function h(){let e=0;const v=new Array(Math.max(1,a)).fill(0).map(async()=>{for(;;){const p=e++;if(p>=y.length)return;t[p]==="loaded"||t[p]==="error"||await P(p)}});await Promise.all(v)}function m(){for(const e of w)try{e.onload=null,e.onerror=null,e.src=""}catch{}w.clear();for(let e=0;e<t.length;e++)(t[e]==="loading"||t[e]==="pending")&&(t[e]="error",d(e,t[e],n))}function A(){m()}return{urls:y,status:t,get initialLoaded(){return l},loadInitial:f,loadAll:h,cancelAll:m,dispose:A}}const he={class:"realTimeForecastContainer"},ge={__name:"index",setup(y){const u=z(),a=I(null),c=I([]),r=I([]),n=I([]);let t=null,l=null;function d(f,h,m){}const w=async()=>{try{const h=(await oe()||[]).map(m=>m.path||m.url||m);r.value=h,t=R(h,{concurrency:3,initialBatch:3,onProgress:d,name:"daily"}),await t.loadInitial(),u.dateType==="daily"&&(c.value=r.value)}catch{}},P=async()=>{try{const h=(await re()||[]).map(m=>m.path||m.url||m);n.value=h,l=R(h,{concurrency:2,initialBatch:0,onProgress:d,name:"monthly"}),l.loadAll().then(()=>{})}catch{}};return O(()=>u.dateType,async f=>{f==="daily"?c.value=r.value:c.value=n.value,te().then(()=>{a.value&&a.value.restart()})}),ae(async()=>{if(u.isLoading=!0,await Promise.allSettled([w(),P()]),t&&t.loadAll().then(()=>{}),a.value&&typeof a.value.initCesium=="function")try{a.value.initCesium()}catch{}}),ne(()=>{a.value&&(a.value=null),t&&(t.cancelAll(),t=null)}),(f,h)=>{const m=U("b-tab-item"),A=U("b-tabs"),e=U("b-section"),v=fe;return M(),H("div",he,[T(e,{class:"switcherSection"},{default:S(()=>[T(A,{type:"is-toggle",size:"is-small",modelValue:D(u).dateType,"onUpdate:modelValue":h[0]||(h[0]=p=>D(u).dateType=p)},{default:S(()=>[T(m,{label:"未来14日",value:"daily"}),T(m,{label:"未来12月",value:"monthly"})]),_:1},8,["modelValue"])]),_:1}),T(v,{"date-type":D(u).dateType,"fetched-urls":c.value,onHandlePlay:D(u).play,onHandlePause:D(u).pause,"is-playing":D(u).isPlaying,ref_key:"sphereRef",ref:a},null,8,["date-type","fetched-urls","onHandlePlay","onHandlePause","is-playing"])])}}},we=q(ge,[["__scopeId","data-v-082a62b8"]]);export{we as default};
