import{aP as D,aQ as O,au as _e,aR as Ve,aS as Me,aw as Ne,ax as de,aN as xe,ay as Ie,v as S,aT as q,az as F,aU as j,U as z,w as ce,aV as Ee,y as I,B as _,aW as oe,Q as $,A as b,F as i,aX as H,aH as te,aI as Q,E as x,D as T,aY as we,aZ as Se,aK as re,a_ as ke,a$ as $e,b0 as Ae,R,b1 as ue,b2 as Ce,aG as De,aL as Ye,_ as ne,z as f,b3 as Pe,b4 as Fe,X as w,T as J,V as Ue,W as ae,L as Le,Y as P,b5 as Oe,b6 as Re}from"./index-Bfp48sXw.js";import{E as ze,a as Ke,b as We,c as Ge,d as Xe}from"./el-radio-DsJcnkuo.js";import{U,I as Z,C as me,u as Be,c as je,d as He,v as ie,a as Qe,i as Te,E as qe,b as Ze}from"./el-button-Bryjhw7F.js";import{g as le,E as Je}from"./util-Dsq4VoQv.js";const et=_e({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:Me,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:p=>p===null||D(p)||["min","max"].includes(p),default:null},name:String,placeholder:String,precision:{type:Number,validator:p=>p>=0&&p===Number.parseInt(`${p}`,10)},validateEvent:{type:Boolean,default:!0},...Ve(["ariaLabel"])}),tt={[me]:(p,n)=>n!==p,blur:p=>p instanceof FocusEvent,focus:p=>p instanceof FocusEvent,[Z]:p=>D(p)||O(p),[U]:p=>D(p)||O(p)},at=de({name:"ElInputNumber"}),lt=de({...at,props:et,emits:tt,setup(p,{expose:n,emit:h}){const o=p,{t:g}=xe(),v=Ie("input-number"),y=S(),a=q({currentValue:o.modelValue,userInput:null}),{formItem:t}=Be(),A=F(()=>D(o.modelValue)&&o.modelValue<=o.min),d=F(()=>D(o.modelValue)&&o.modelValue>=o.max),l=F(()=>{const e=K(o.step);return j(o.precision)?Math.max(K(o.modelValue),e):(e>o.precision,o.precision)}),c=F(()=>o.controls&&o.controlsPosition==="right"),r=je(),u=He(),k=F(()=>{if(a.userInput!==null)return a.userInput;let e=a.currentValue;if(O(e))return"";if(D(e)){if(Number.isNaN(e))return"";j(o.precision)||(e=e.toFixed(o.precision))}return e}),Y=(e,s)=>{if(j(s)&&(s=l.value),s===0)return Math.round(e);let m=String(e);const V=m.indexOf(".");if(V===-1||!m.replace(".","").split("")[V+s])return e;const X=m.length;return m.charAt(X-1)==="5"&&(m=`${m.slice(0,Math.max(0,X-1))}6`),Number.parseFloat(Number(m).toFixed(s))},K=e=>{if(O(e))return 0;const s=e.toString(),m=s.indexOf(".");let V=0;return m!==-1&&(V=s.length-m-1),V},W=(e,s=1)=>D(e)?Y(e+o.step*s):a.currentValue,L=()=>{if(o.readonly||u.value||d.value)return;const e=Number(k.value)||0,s=W(e);G(s),h(Z,a.currentValue),ee()},N=()=>{if(o.readonly||u.value||A.value)return;const e=Number(k.value)||0,s=W(e,-1);G(s),h(Z,a.currentValue),ee()},se=(e,s)=>{const{max:m,min:V,step:M,precision:C,stepStrictly:X,valueOnClear:B}=o;m<V&&Ce("InputNumber","min should not be greater than max.");let E=Number(e);if(O(e)||Number.isNaN(E))return null;if(e===""){if(B===null)return null;E=De(B)?{min:V,max:m}[B]:B}return X&&(E=Y(Math.round(E/M)*M,C),E!==e&&s&&h(U,E)),j(C)||(E=Y(E,C)),(E>m||E<V)&&(E=E>m?m:V,s&&h(U,E)),E},G=(e,s=!0)=>{var m;const V=a.currentValue,M=se(e);if(!s){h(U,M);return}V===M&&e||(a.userInput=null,h(U,M),V!==M&&h(me,M,V),o.validateEvent&&((m=t==null?void 0:t.validate)==null||m.call(t,"change").catch(C=>ue())),a.currentValue=M)},pe=e=>{a.userInput=e;const s=e===""?null:Number(e);h(Z,s),G(s,!1)},ve=e=>{const s=e!==""?Number(e):"";(D(s)&&!Number.isNaN(s)||e==="")&&G(s),ee(),a.userInput=null},fe=()=>{var e,s;(s=(e=y.value)==null?void 0:e.focus)==null||s.call(e)},he=()=>{var e,s;(s=(e=y.value)==null?void 0:e.blur)==null||s.call(e)},ge=e=>{h("focus",e)},be=e=>{var s,m;a.userInput=null,Te()&&a.currentValue===null&&((s=y.value)!=null&&s.input)&&(y.value.input.value=""),h("blur",e),o.validateEvent&&((m=t==null?void 0:t.validate)==null||m.call(t,"blur").catch(V=>ue()))},ee=()=>{a.currentValue!==o.modelValue&&(a.currentValue=o.modelValue)},ye=e=>{document.activeElement===e.target&&e.preventDefault()};return z(()=>o.modelValue,(e,s)=>{const m=se(e,!0);a.userInput===null&&m!==s&&(a.currentValue=m)},{immediate:!0}),ce(()=>{var e;const{min:s,max:m,modelValue:V}=o,M=(e=y.value)==null?void 0:e.input;if(M.setAttribute("role","spinbutton"),Number.isFinite(m)?M.setAttribute("aria-valuemax",String(m)):M.removeAttribute("aria-valuemax"),Number.isFinite(s)?M.setAttribute("aria-valuemin",String(s)):M.removeAttribute("aria-valuemin"),M.setAttribute("aria-valuenow",a.currentValue||a.currentValue===0?String(a.currentValue):""),M.setAttribute("aria-disabled",String(u.value)),!D(V)&&V!=null){let C=Number(V);Number.isNaN(C)&&(C=null),h(U,C)}M.addEventListener("wheel",ye,{passive:!1})}),Ee(()=>{var e,s;const m=(e=y.value)==null?void 0:e.input;m==null||m.setAttribute("aria-valuenow",`${(s=a.currentValue)!=null?s:""}`)}),n({focus:fe,blur:he}),(e,s)=>(_(),I("div",{class:te([i(v).b(),i(v).m(i(r)),i(v).is("disabled",i(u)),i(v).is("without-controls",!e.controls),i(v).is("controls-right",i(c))]),onDragstart:R(()=>{},["prevent"])},[e.controls?oe((_(),I("span",{key:0,role:"button","aria-label":i(g)("el.inputNumber.decrease"),class:te([i(v).e("decrease"),i(v).is("disabled",i(A))]),onKeydown:H(N,["enter"])},[Q(e.$slots,"decrease-icon",{},()=>[b(i(re),null,{default:x(()=>[i(c)?(_(),T(i(we),{key:0})):(_(),T(i(Se),{key:1}))]),_:1})])],42,["aria-label","onKeydown"])),[[i(ie),N]]):$("v-if",!0),e.controls?oe((_(),I("span",{key:1,role:"button","aria-label":i(g)("el.inputNumber.increase"),class:te([i(v).e("increase"),i(v).is("disabled",i(d))]),onKeydown:H(L,["enter"])},[Q(e.$slots,"increase-icon",{},()=>[b(i(re),null,{default:x(()=>[i(c)?(_(),T(i(ke),{key:0})):(_(),T(i($e),{key:1}))]),_:1})])],42,["aria-label","onKeydown"])),[[i(ie),L]]):$("v-if",!0),b(i(Qe),{id:e.id,ref_key:"input",ref:y,type:"number",step:e.step,"model-value":i(k),placeholder:e.placeholder,readonly:e.readonly,disabled:i(u),size:i(r),max:e.max,min:e.min,name:e.name,"aria-label":e.ariaLabel,"validate-event":!1,onKeydown:[H(R(L,["prevent"]),["up"]),H(R(N,["prevent"]),["down"])],onBlur:be,onFocus:ge,onInput:pe,onChange:ve},Ae({_:2},[e.$slots.prefix?{name:"prefix",fn:x(()=>[Q(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:x(()=>[Q(e.$slots,"suffix")])}:void 0]),1032,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","onKeydown"])],42,["onDragstart"]))}});var nt=Ne(lt,[["__file","input-number.vue"]]);const st=Ye(nt),ot={class:"dynamics-viewer"},rt={class:"image-container"},ut={key:0,class:"loading-overlay"},it=["src","alt","onClick","onLoad"],dt={class:"image-date-label"},ct={key:0,class:"empty-state"},mt=["src"],pt={class:"image-date"},vt={__name:"DynamicsAnalysisViewer",props:{images:{type:Array,required:!0}},setup(p){const n=p,h=S(null),o=S(1),g=S([]),v=F(()=>!n.images||n.images.length===0?1:Math.ceil(n.images.length/2)),y=l=>new Promise((c,r)=>{const u=new Image;u.onload=()=>c(),u.onerror=r,u.src=l}),a=()=>{!n.images||n.images.length===0||n.images.forEach((l,c)=>{y(le(l.path)).then(()=>{g.value[c]=!1}).catch(r=>{console.error(`Failed to load image: ${l.path}`,r),g.value[c]=!1})})};z(()=>n.images,l=>{l&&l.length>0&&(g.value=new Array(l.length).fill(!0),a())},{immediate:!0});const t=l=>{g.value[l]=!1},A=l=>{l&&(h.value=l,o.value=1)},d=l=>{const c=Math.sign(l.deltaY),r=Math.max(1,Math.min(3,o.value-c*.2));o.value=r,l.preventDefault()};return ce(()=>{a()}),(l,c)=>(_(),I("div",ot,[c[4]||(c[4]=f("h2",{class:"section-title"},"动力学分析结果热图",-1)),f("div",{class:"image-grid",style:J({"--images-per-row":v.value})},[(_(!0),I(Pe,null,Fe(p.images,(r,u)=>(_(),I("div",{key:u,class:"image-card"},[f("div",rt,[g.value[u]?(_(),I("div",ut,c[2]||(c[2]=[f("div",{class:"loading-spinner"},null,-1)]))):$("",!0),f("img",{src:i(le)(r.path),alt:`${r.date} - 动力学分析结果`,class:"analysis-image",onClick:k=>A(r),onLoad:k=>t(u)},null,40,it)]),f("div",dt,w(r.date),1)]))),128))],4),!p.images||p.images.length===0?(_(),I("div",ct,[b(i(Je),{description:"暂无分析结果"})])):$("",!0),h.value?(_(),I("div",{key:1,class:"modal-overlay",onWheel:d,onClick:c[1]||(c[1]=R(r=>h.value=null,["self"]))},[f("div",{class:"modal-content",style:J({transform:`scale(${o.value})`})},[f("img",{src:i(le)(h.value.path),alt:"放大查看",class:"modal-image"},null,8,mt),f("p",pt,w(h.value.date),1)],4),f("button",{onClick:c[0]||(c[0]=r=>h.value=null),class:"close-button"},c[3]||(c[3]=[f("svg",{class:"close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))],32)):$("",!0)]))}},ft=ne(vt,[["__scopeId","data-v-3dd3c4e2"]]),ht="/seaice/picture/land_image.png",gt={class:"image-selector"},bt={key:0,class:"selection-info-container"},yt={class:"selection-info"},_t={__name:"ImageSelector",props:{topLeft:{type:Object,default:()=>({x:null,y:null})},bottomRight:{type:Object,default:()=>({x:null,y:null})}},emits:["update:topLeft","update:bottomRight"],setup(p,{emit:n}){const h=p,o=n,g=S(null),v=S(!1),y=q({x:0,y:0}),a=q({left:0,top:0,width:0,height:0}),t=q({left:0,top:0,width:0,height:0,isVisible:!1}),A=r=>{r.preventDefault(),v.value=!0;const u=g.value.getBoundingClientRect();y.x=r.clientX-u.left,y.y=r.clientY-u.top,a.left=y.x,a.top=y.y,a.width=0,a.height=0},d=r=>{if(!v.value)return;const u=g.value.getBoundingClientRect(),k=Math.min(Math.max(r.clientX-u.left,0),u.width),Y=Math.min(Math.max(r.clientY-u.top,0),u.height);a.left=Math.min(k,y.x),a.top=Math.min(Y,y.y),a.width=Math.abs(k-y.x),a.height=Math.abs(Y-y.y)},l=()=>{v.value=!1,a.width>0&&a.height>0&&(t.left=a.left,t.top=a.top,t.width=a.width,t.height=a.height,t.isVisible=!0,o("update:topLeft",{x:Math.round(t.left),y:Math.round(t.top)}),o("update:bottomRight",{x:Math.round(t.left+t.width),y:Math.round(t.top+t.height)}))};z(()=>[h.topLeft,h.bottomRight],([r,u])=>{(r==null?void 0:r.x)!==null&&(r==null?void 0:r.y)!==null&&(u==null?void 0:u.x)!==null&&(u==null?void 0:u.y)!==null?(t.left=r.x,t.top=r.y,t.width=u.x-r.x,t.height=u.y-r.y,t.isVisible=!0):t.isVisible=!1},{immediate:!0});const c=()=>{t.left=0,t.top=0,t.width=0,t.height=0,t.isVisible=!1,a.left=0,a.top=0,a.width=0,a.height=0,o("update:topLeft",{x:null,y:null}),o("update:bottomRight",{x:null,y:null})};return(r,u)=>(_(),I("div",gt,[f("div",{class:"image-container",ref_key:"imageContainer",ref:g,onMousedown:A,onMousemove:d,onMouseup:l,onMouseleave:l},[u[0]||(u[0]=f("img",{src:ht,alt:"Selectable Image",draggable:"false"},null,-1)),v.value?(_(),I("div",{key:0,class:"selection",style:J({left:`${a.left}px`,top:`${a.top}px`,width:`${a.width}px`,height:`${a.height}px`})},null,4)):$("",!0),t.isVisible?(_(),I("div",{key:1,class:"last-selection",style:J({left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`,height:`${t.height}px`})},null,4)):$("",!0)],544),t.isVisible?(_(),I("div",bt,[f("div",yt,[u[1]||(u[1]=f("p",null,"最后选择区域尺寸:",-1)),f("p",null,"宽度: "+w(Math.round(t.width))+"px",1),f("p",null,"高度: "+w(Math.round(t.height))+"px",1),u[2]||(u[2]=f("p",null,"角坐标:",-1)),f("p",null,"左上: ("+w(Math.round(t.left))+", "+w(Math.round(t.top))+")",1),f("p",null," 右上: ("+w(Math.round(t.left+t.width))+", "+w(Math.round(t.top))+") ",1),f("p",null," 左下: ("+w(Math.round(t.left))+", "+w(Math.round(t.top+t.height))+") ",1),f("p",null," 右下: ("+w(Math.round(t.left+t.width))+", "+w(Math.round(t.top+t.height))+") ",1)]),f("button",{class:"clear-button",onClick:c},"清除选择")])):$("",!0)]))}},Vt=ne(_t,[["__scopeId","data-v-dd0002e0"]]),Mt={class:"container-layout"},Nt={class:"main-content"},xt={key:0,class:"loading-container"},It={key:1,class:"result-section"},Et={__name:"DynamicsAnalysisView",setup(p){const n=S({startMonth:"",endMonth:"",grad_forecast_month:1,grad_month:"",grad_lat_lon:"",grad_type:"sum",x1:null,y1:null,x2:null,y2:null}),h=S([]),o=S(!1),g=S(!1),v=S(null),y=S({x:null,y:null}),a=S({x:null,y:null});z([y,a],([d,l])=>{n.value.x1=d.y,n.value.y1=d.x,n.value.x2=l.y,n.value.y2=l.x},{immediate:!0,deep:!0}),z([()=>n.value.endMonth,()=>n.value.grad_forecast_month],([d,l])=>{if(d&&l){const c=new Date(d.substring(0,4),parseInt(d.substring(4))-1);c.setMonth(c.getMonth()+l),n.value.grad_month=String(c.getMonth()+1).padStart(2,"0")}else n.value.grad_month=""});const t=async()=>{if(v.value)try{const d=await Re(v.value);d.success&&d.status==="COMPLETED"?(h.value=d.data.images,o.value=!0,P.success(d.message||"分析完成"),g.value=!1,v.value=null):d.status==="IN_PROGRESS"?console.log("Task not completed yet, continuing polling..."):d.status==="FAILED"&&(console.error("分析任务失败:",d.message),g.value=!1,o.value=!1,P.error(d.message||"分析任务失败"),v.value=null)}catch(d){console.error("轮询分析结果出错:",d),g.value=!1,o.value=!1,P.error("获取分析结果失败"),v.value=null}},A=async()=>{if(!n.value.startMonth||!n.value.endMonth||!n.value.grad_month||!n.value.grad_forecast_month){P.error("请填写完整的分析参数");return}try{g.value=!0,o.value=!1;const d=await Oe(n.value.startMonth,n.value.endMonth,n.value.grad_type,n.value.grad_month,n.value.x1,n.value.y1,n.value.x2,n.value.y2);if(d.success)v.value=d.data.task_id;else{g.value=!1,P.error(d.message||"提交分析请求失败");return}const l=setInterval(async()=>{await t(),g.value||clearInterval(l)},2e3)}catch(d){o.value=!1,g.value=!1,P.error("提交分析请求失败，请重试"),console.error("Analysis error:",d)}};return Ue(()=>{v.value&&(v.value=null)}),(d,l)=>{const c=qe,r=We,u=st,k=Xe,Y=Ge,K=Ze,W=Ke,L=ze;return _(),I("div",Mt,[f("div",Nt,[b(L,{class:"box-card"},{default:x(()=>[b(W,{model:n.value,onSubmit:R(A,["prevent"]),class:"analysis-form"},{default:x(()=>[b(r,{label:"开始月份"},{default:x(()=>[b(c,{modelValue:n.value.startMonth,"onUpdate:modelValue":l[0]||(l[0]=N=>n.value.startMonth=N),type:"month",placeholder:"选择开始月份",format:"YYYY-MM","value-format":"YYYYMM"},null,8,["modelValue"])]),_:1}),b(r,{label:"结束月份"},{default:x(()=>[b(c,{modelValue:n.value.endMonth,"onUpdate:modelValue":l[1]||(l[1]=N=>n.value.endMonth=N),type:"month",placeholder:"选择结束月份",format:"YYYY-MM","value-format":"YYYYMM"},null,8,["modelValue"])]),_:1}),b(r,{label:"预报提前期"},{default:x(()=>[b(u,{modelValue:n.value.grad_forecast_month,"onUpdate:modelValue":l[2]||(l[2]=N=>n.value.grad_forecast_month=N),min:1,placeholder:"请输入提前期（月）"},null,8,["modelValue"])]),_:1}),b(r,{label:"目标月份"},{default:x(()=>[b(c,{modelValue:n.value.grad_month,"onUpdate:modelValue":l[3]||(l[3]=N=>n.value.grad_month=N),type:"month",placeholder:"目标月份由数据范围和预报提前期决定",format:"MM","value-format":"MM",disabled:""},null,8,["modelValue"])]),_:1}),b(r,{label:"分析范围"},{default:x(()=>[b(Vt,{topLeft:y.value,"onUpdate:topLeft":l[4]||(l[4]=N=>y.value=N),bottomRight:a.value,"onUpdate:bottomRight":l[5]||(l[5]=N=>a.value=N)},null,8,["topLeft","bottomRight"])]),_:1}),b(r,{label:"分析目标"},{default:x(()=>[b(Y,{modelValue:n.value.grad_type,"onUpdate:modelValue":l[6]||(l[6]=N=>n.value.grad_type=N)},{default:x(()=>[b(k,{value:"sum"},{default:x(()=>l[7]||(l[7]=[ae("海冰面积")])),_:1}),b(k,{value:"variation"},{default:x(()=>l[8]||(l[8]=[ae("海冰变化")])),_:1})]),_:1},8,["modelValue"])]),_:1}),b(r,null,{default:x(()=>[b(K,{type:"primary",loading:g.value,onClick:A},{default:x(()=>[ae(w(g.value?"分析中...":"提交分析"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),g.value?(_(),I("div",xt,[b(Le)])):$("",!0),!g.value&&o.value?(_(),I("div",It,[b(ft,{images:h.value,class:"full-width"},null,8,["images"])])):$("",!0)]),_:1})])])}}},At=ne(Et,[["__scopeId","data-v-c2285b4d"]]);export{At as default};
