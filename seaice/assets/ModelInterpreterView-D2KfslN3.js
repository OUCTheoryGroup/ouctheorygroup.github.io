import{_ as Y,v as p,y as _,B as f,z as d,Q as E,F as w,A as t,R,T as $,U as C,V as U,E as n,W as V,X as F,L,Y as y,Z as A,$ as B}from"./index-Bfp48sXw.js";import{E as N,a as T,b as O,c as P,d as W}from"./el-radio-DsJcnkuo.js";import{E as z,a as G,b as j}from"./el-button-Bryjhw7F.js";import{g as M,E as q}from"./util-Dsq4VoQv.js";const K={class:"dynamics-viewer"},Q={key:0,class:"single-image-container"},X={class:"image-container"},Z=["src"],H={key:1,class:"empty-state"},J=["src"],ee={__name:"ModelInterpreterViewer",props:{images:{type:Array,required:!0}},setup(I){const a=I,i=p(null),r=p(1),o=c=>{c&&(i.value=c,r.value=1)},m=c=>{const s=Math.sign(c.deltaY),e=Math.max(.5,Math.min(5,r.value-s*.2));r.value=e,c.preventDefault()};return(c,s)=>(f(),_("div",K,[s[4]||(s[4]=d("h2",{class:"section-title"},"逐日模型可解释性分析结果热图",-1)),a.images&&a.images.length>0?(f(),_("div",Q,[d("div",X,[d("img",{src:w(M)(a.images[0]),alt:"可解释性分析结果",class:"analysis-image",onClick:s[0]||(s[0]=e=>o(w(M)(a.images[0])))},null,8,Z)])])):(f(),_("div",H,[t(w(q),{description:"暂无分析结果"})])),i.value?(f(),_("div",{key:2,class:"modal-overlay",onWheel:m,onClick:s[2]||(s[2]=R(e=>i.value=null,["self"]))},[d("div",{class:"modal-content",style:$({transform:`scale(${r.value})`})},[d("img",{src:w(M)(i.value),alt:"放大查看",class:"modal-image"},null,8,J)],4),d("button",{onClick:s[1]||(s[1]=e=>i.value=null),class:"close-button"},s[3]||(s[3]=[d("svg",{class:"close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))],32)):E("",!0)]))}},ae=Y(ee,[["__scopeId","data-v-00787e72"]]),le={class:"container-layout"},te={class:"main-content"},se={key:0,class:"loading-container"},oe={key:1,class:"result-section"},ne={__name:"ModelInterpreterView",setup(I){const a=p({dataRange:[],grad_day:"",grad_lat_lon:"",grad_type:"sum"}),i=p([]),r=p(!1),o=p(!1),m=p(null);C(()=>a.value.dataRange[0],e=>{if(e){const l=new Date(e.substring(0,4),parseInt(e.substring(4,6))-1,parseInt(e.substring(6,8))),v=new Date(l);v.setDate(l.getDate()+13);const g=v.getFullYear()+String(v.getMonth()+1).padStart(2,"0")+String(v.getDate()).padStart(2,"0");a.value.dataRange=[e,g]}});const c=async()=>{if(m.value)try{const e=await B(m.value);if(e.success&&e.status==="COMPLETED")if(e.data&&e.data.images)i.value=e.data.images,r.value=!0,y.success(e.message||"分析完成"),o.value=!1,m.value=null;else throw new Error("返回数据格式不正确");else if(e.status==="IN_PROGRESS")console.log("任务处理中，继续轮询...");else if(e.status==="FAILED")throw new Error(e.message||"任务处理失败")}catch(e){console.error("轮询分析结果出错:",e),o.value=!1,r.value=!1,y.error(e.message||"获取分析结果失败")}},s=async()=>{if(!a.value.dataRange||!a.value.dataRange[0]||!a.value.dataRange[1]||!a.value.grad_day){y.error("请填写完整的分析参数");return}try{o.value=!0,r.value=!1;const e=await A(a.value.dataRange[0],a.value.dataRange[1],a.value.grad_type,a.value.grad_day);if(e.success)m.value=e.data.task_id;else{o.value=!1,y.error(e.message||"提交分析请求失败");return}const l=setInterval(async()=>{await c(),o.value||clearInterval(l)},2e3)}catch(e){r.value=!1,o.value=!1,y.error("提交分析请求失败，请重试"),console.error("Analysis error:",e)}};return U(()=>{m.value&&(m.value=null)}),(e,l)=>{const v=z,g=O,b=G,k=W,D=P,x=j,h=T,S=N;return f(),_("div",le,[d("div",te,[t(S,{class:"box-card"},{default:n(()=>[t(h,{model:a.value,onSubmit:R(s,["prevent"]),class:"analysis-form"},{default:n(()=>[t(g,{label:"数据范围"},{default:n(()=>[t(v,{modelValue:a.value.dataRange[0],"onUpdate:modelValue":l[0]||(l[0]=u=>a.value.dataRange[0]=u),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYYMMDD"},null,8,["modelValue"]),l[5]||(l[5]=d("span",{style:{margin:"0 8px"}},"至",-1)),t(v,{modelValue:a.value.dataRange[1],"onUpdate:modelValue":l[1]||(l[1]=u=>a.value.dataRange[1]=u),type:"date",placeholder:"结束日期 (自动设置为开始日期+13天)",format:"YYYY-MM-DD","value-format":"YYYYMMDD",disabled:""},null,8,["modelValue"])]),_:1}),t(g,{label:"目标日期"},{default:n(()=>[t(b,{modelValue:a.value.grad_day,"onUpdate:modelValue":l[2]||(l[2]=u=>a.value.grad_day=u),placeholder:"请输入目标日期"},null,8,["modelValue"])]),_:1}),t(g,{label:"分析范围"},{default:n(()=>[t(b,{modelValue:a.value.grad_lat_lon,"onUpdate:modelValue":l[3]||(l[3]=u=>a.value.grad_lat_lon=u),disabled:"",placeholder:"请输入经纬度范围（目前只支持全范围）"},null,8,["modelValue"])]),_:1}),t(g,{label:"分析目标"},{default:n(()=>[t(D,{modelValue:a.value.grad_type,"onUpdate:modelValue":l[4]||(l[4]=u=>a.value.grad_type=u)},{default:n(()=>[t(k,{value:"sum"},{default:n(()=>l[6]||(l[6]=[V("海冰面积")])),_:1}),t(k,{value:"l2"},{default:n(()=>l[7]||(l[7]=[V("L2范数")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(g,null,{default:n(()=>[t(x,{type:"primary",loading:o.value,onClick:s},{default:n(()=>[V(F(o.value?"分析中...":"提交分析"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),o.value?(f(),_("div",se,[t(L)])):E("",!0),!o.value&&r.value?(f(),_("div",oe,[t(ae,{images:i.value,class:"full-width"},null,8,["images"])])):E("",!0)]),_:1})])])}}},me=Y(ne,[["__scopeId","data-v-ab42cb3c"]]);export{me as default};
