import{_ as I,r as g,c as _,e as f,a as d,F as M,b as t,g as h,as as Y,M as $,U as C,aH as S,w as n,aD as w,H as U,L as F,aT as B,aU as L}from"./index-BO7lXyMJ.js";import{E as A,a as N,b as T,c as H,d as W}from"./el-form-item-DRKRQLA8.js";import{d as j,E as q,h as z,c as G,e as y}from"./el-button-DYtvFSI2.js";import"./file_commonjsHelpers-0AiMCqXO.js";const K={class:"dynamics-viewer"},O={key:0,class:"single-image-container"},P={class:"image-container"},J=["src"],Q={key:1,class:"empty-state"},X=["src"],Z={__name:"ModelInterpreterViewer",props:{images:{type:Array,required:!0}},setup(V){const e=V,i=g(null),r=g(1),o=m=>{m&&(i.value=m,r.value=1)},c=m=>{const s=Math.sign(m.deltaY),a=Math.max(.5,Math.min(5,r.value-s*.2));r.value=a,m.preventDefault()};return(m,s)=>(f(),_("div",K,[s[4]||(s[4]=d("h2",{class:"section-title"},"逐日模型可解释性分析结果热图",-1)),e.images&&e.images.length>0?(f(),_("div",O,[d("div",P,[d("img",{src:e.images[0],alt:"可解释性分析结果",class:"analysis-image",onClick:s[0]||(s[0]=a=>o(e.images[0]))},null,8,J)])])):(f(),_("div",Q,[t(h(j),{description:"暂无分析结果"})])),i.value?(f(),_("div",{key:2,class:"modal-overlay",onWheel:c,onClick:s[2]||(s[2]=Y(a=>i.value=null,["self"]))},[d("div",{class:"modal-content",style:$({transform:`scale(${r.value})`})},[d("img",{src:i.value,alt:"放大查看",class:"modal-image"},null,8,X)],4),d("button",{onClick:s[1]||(s[1]=a=>i.value=null),class:"close-button"},s[3]||(s[3]=[d("svg",{class:"close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))],32)):M("",!0)]))}},ee=I(Z,[["__scopeId","data-v-e04aba88"]]),ae={class:"container-layout"},le={class:"main-content"},te={key:0,class:"loading-container"},se={key:1,class:"result-section"},oe={__name:"ModelInterpreterView",setup(V){const e=g({dataRange:[],grad_day:"",grad_lat_lon:"",grad_type:"sum"}),i=g([]),r=g(!1),o=g(!1),c=g(null);C(()=>e.value.dataRange[0],a=>{if(a){const l=new Date(a.substring(0,4),parseInt(a.substring(4,6))-1,parseInt(a.substring(6,8))),v=new Date(l);v.setDate(l.getDate()+13);const p=v.getFullYear()+String(v.getMonth()+1).padStart(2,"0")+String(v.getDate()).padStart(2,"0");e.value.dataRange=[a,p]}});const m=async()=>{if(c.value)try{const a=await L(c.value);a.length!==0&&(i.value=a,r.value=!0,y.success("分析完成"),o.value=!1,c.value=null)}catch(a){if(a.response&&a.response.status===400){console.log("Task not completed yet, continuing polling...");return}console.error("轮询分析结果出错:",a),o.value=!1,r.value=!1,y.error("获取分析结果失败")}},s=async()=>{if(!e.value.dataRange||!e.value.dataRange[0]||!e.value.dataRange[1]||!e.value.grad_day){y.error("请填写完整的分析参数");return}try{o.value=!0,r.value=!1;const a=await B(e.value.dataRange[0],e.value.dataRange[1],e.value.grad_type,e.value.grad_day);c.value=a.task_id;const l=setInterval(async()=>{await m(),o.value||clearInterval(l)},2e3)}catch(a){r.value=!1,o.value=!1,y.error("提交分析请求失败，请重试"),console.error("Analysis error:",a)}};return S(()=>{c.value&&(c.value=null)}),(a,l)=>{const v=q,p=T,k=z,b=W,R=H,D=G,E=N,x=A;return f(),_("div",ae,[d("div",le,[t(x,{class:"box-card"},{default:n(()=>[t(E,{model:e.value,onSubmit:Y(s,["prevent"]),class:"analysis-form"},{default:n(()=>[t(p,{label:"数据范围"},{default:n(()=>[t(v,{modelValue:e.value.dataRange[0],"onUpdate:modelValue":l[0]||(l[0]=u=>e.value.dataRange[0]=u),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYYMMDD"},null,8,["modelValue"]),l[5]||(l[5]=d("span",{style:{margin:"0 8px"}},"至",-1)),t(v,{modelValue:e.value.dataRange[1],"onUpdate:modelValue":l[1]||(l[1]=u=>e.value.dataRange[1]=u),type:"date",placeholder:"结束日期 (自动设置为开始日期+13天)",format:"YYYY-MM-DD","value-format":"YYYYMMDD",disabled:""},null,8,["modelValue"])]),_:1}),t(p,{label:"目标日期"},{default:n(()=>[t(k,{modelValue:e.value.grad_day,"onUpdate:modelValue":l[2]||(l[2]=u=>e.value.grad_day=u),placeholder:"请输入目标日期"},null,8,["modelValue"])]),_:1}),t(p,{label:"分析范围"},{default:n(()=>[t(k,{modelValue:e.value.grad_lat_lon,"onUpdate:modelValue":l[3]||(l[3]=u=>e.value.grad_lat_lon=u),disabled:"",placeholder:"请输入经纬度范围（目前只支持全范围）"},null,8,["modelValue"])]),_:1}),t(p,{label:"分析目标"},{default:n(()=>[t(R,{modelValue:e.value.grad_type,"onUpdate:modelValue":l[4]||(l[4]=u=>e.value.grad_type=u)},{default:n(()=>[t(b,{value:"sum"},{default:n(()=>l[6]||(l[6]=[w("海冰面积")])),_:1}),t(b,{value:"l2"},{default:n(()=>l[7]||(l[7]=[w("L2范数")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:n(()=>[t(D,{type:"primary",loading:o.value,onClick:s},{default:n(()=>[w(U(o.value?"分析中...":"提交分析"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),o.value?(f(),_("div",te,[t(F)])):M("",!0),!o.value&&r.value?(f(),_("div",se,[t(ee,{images:i.value,class:"full-width"},null,8,["images"])])):M("",!0)]),_:1})])])}}},ie=I(oe,[["__scopeId","data-v-d05f7754"]]);export{ie as default};
