import{c8 as N,ax as Y,au as ee,ay as x,A as L,c9 as et,ca as re,aI as B,av as M,cb as tt,w as ae,cc as st,c1 as ye,aO as ce,aF as Se,aw as se,aN as De,bS as de,az as V,y as R,B as E,z as g,Q as S,aH as D,F as s,X as H,E as P,D as j,aJ as ot,cd as at,aK as Z,T as le,ce as lt,bR as nt,bV as it,b2 as ne,at as Te,cf as he,U as J,cg as rt,ch as ut,ci as ct,cj as dt,ck as ft,cl as vt,aM as be,v as I,cm as pt,cn as mt,co as Ce,cp as gt,bW as yt,c4 as ht,cq as bt,aW as Fe,cr as Ct,cs as fe,b0 as ve,ct as kt,cu as wt,bX as Ie,aL as Me,b_ as Re,aQ as Ue,cv as pe,b3 as Et,b4 as _t,aX as Be,R as Q,cw as $t,aB as Lt,aD as Oe,aE as Pt,cx as Ae,cy as Ne,c7 as St,cz as me,cA as ke,cB as Dt,cC as Tt,b1 as Ft,cD as It,cE as Mt,_ as Rt,W as Ut,cF as Bt,a$ as Ot,cG as At,L as Nt,Y as G}from"./index-DG9jATsB.js";import{g as qt,E as qe}from"./el-progress-wAiSg-zi.js";import{e as zt,U as ze,f as jt,d as ie,h as Yt,b as Ht}from"./el-button-BGILTIxt.js";import{g as ue,E as Vt}from"./util-C1DbpjV7.js";var Kt=1,Xt=4;function we(e){return zt(e,Kt|Xt)}const je=e=>{if(!e)return{onClick:N,onMousedown:N,onMouseup:N};let a=!1,t=!1;return{onClick:i=>{a&&t&&e(i),a=t=!1},onMousedown:i=>{a=i.target===i.currentTarget},onMouseup:i=>{t=i.target===i.currentTarget}}},Wt=ee({mask:{type:Boolean,default:!0},customMaskEvent:Boolean,overlayClass:{type:M([String,Array,Object])},zIndex:{type:M([String,Number])}}),Gt={click:e=>e instanceof MouseEvent},Jt="overlay";var Qt=Y({name:"ElOverlay",props:Wt,emits:Gt,setup(e,{slots:a,emit:t}){const d=x(Jt),n=p=>{t("click",p)},{onClick:c,onMousedown:i,onMouseup:_}=je(e.customMaskEvent?void 0:n);return()=>e.mask?L("div",{class:[d.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:c,onMousedown:i,onMouseup:_},[B(a,"default")],re.STYLE|re.CLASS|re.PROPS,["onClick","onMouseup","onMousedown"]):et("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[B(a,"default")])}});const Zt=Qt,Ye=Symbol("dialogInjectionKey"),He=ee({center:Boolean,alignCenter:Boolean,closeIcon:{type:tt},draggable:Boolean,overflow:Boolean,fullscreen:Boolean,headerClass:String,bodyClass:String,footerClass:String,showClose:{type:Boolean,default:!0},title:{type:String,default:""},ariaLevel:{type:String,default:"2"}}),xt={close:()=>!0},es=(e,a,t,d)=>{let n={offsetX:0,offsetY:0};const c=y=>{const w=y.clientX,h=y.clientY,{offsetX:T,offsetY:l}=n,r=e.value.getBoundingClientRect(),o=r.left,f=r.top,v=r.width,k=r.height,b=document.documentElement.clientWidth,U=document.documentElement.clientHeight,A=-o+T,O=-f+l,q=b-o-v+T,K=U-f-k+l,X=C=>{let z=T+C.clientX-w,u=l+C.clientY-h;d!=null&&d.value||(z=Math.min(Math.max(z,A),q),u=Math.min(Math.max(u,O),K)),n={offsetX:z,offsetY:u},e.value&&(e.value.style.transform=`translate(${ce(z)}, ${ce(u)})`)},W=()=>{document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",W)};document.addEventListener("mousemove",X),document.addEventListener("mouseup",W)},i=()=>{a.value&&e.value&&a.value.addEventListener("mousedown",c)},_=()=>{a.value&&e.value&&a.value.removeEventListener("mousedown",c)},p=()=>{n={offsetX:0,offsetY:0},e.value&&(e.value.style.transform="none")};return ae(()=>{st(()=>{t.value?i():_()})}),ye(()=>{_()}),{resetPosition:p}},ts=(...e)=>a=>{e.forEach(t=>{Se(t)?t(a):t.value=a})},ss=Y({name:"ElDialogContent"}),os=Y({...ss,props:He,emits:xt,setup(e,{expose:a}){const t=e,{t:d}=De(),{Close:n}=at,{dialogRef:c,headerRef:i,bodyId:_,ns:p,style:y}=de(Ye),{focusTrapRef:w}=de(lt),h=V(()=>[p.b(),p.is("fullscreen",t.fullscreen),p.is("draggable",t.draggable),p.is("align-center",t.alignCenter),{[p.m("center")]:t.center}]),T=ts(w,c),l=V(()=>t.draggable),r=V(()=>t.overflow),{resetPosition:o}=es(c,i,l,r);return a({resetPosition:o}),(f,v)=>(E(),R("div",{ref:s(T),class:D(s(h)),style:le(s(y)),tabindex:"-1"},[g("header",{ref_key:"headerRef",ref:i,class:D([s(p).e("header"),f.headerClass,{"show-close":f.showClose}])},[B(f.$slots,"header",{},()=>[g("span",{role:"heading","aria-level":f.ariaLevel,class:D(s(p).e("title"))},H(f.title),11,["aria-level"])]),f.showClose?(E(),R("button",{key:0,"aria-label":s(d)("el.dialog.close"),class:D(s(p).e("headerbtn")),type:"button",onClick:k=>f.$emit("close")},[L(s(Z),{class:D(s(p).e("close"))},{default:P(()=>[(E(),j(ot(f.closeIcon||s(n))))]),_:1},8,["class"])],10,["aria-label","onClick"])):S("v-if",!0)],2),g("div",{id:s(_),class:D([s(p).e("body"),f.bodyClass])},[B(f.$slots,"default")],10,["id"]),f.$slots.footer?(E(),R("footer",{key:0,class:D([s(p).e("footer"),f.footerClass])},[B(f.$slots,"footer")],2)):S("v-if",!0)],6))}});var as=se(os,[["__file","dialog-content.vue"]]);const ls=ee({...He,appendToBody:Boolean,appendTo:{type:M([String,Object]),default:"body"},beforeClose:{type:M(Function)},destroyOnClose:Boolean,closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:Boolean,modalClass:String,headerClass:String,bodyClass:String,footerClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:Boolean,headerAriaLevel:{type:String,default:"2"}}),ns={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[ze]:e=>nt(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},is=(e,a={})=>{it(e)||ne("[useLockscreen]","You need to pass a ref param to this function");const t=a.ns||x("popup"),d=V(()=>t.bm("parent","hidden"));if(!Te||he(document.body,d.value))return;let n=0,c=!1,i="0";const _=()=>{setTimeout(()=>{typeof document>"u"||c&&document&&(document.body.style.width=i,dt(document.body,d.value))},200)};J(e,p=>{if(!p){_();return}c=!he(document.body,d.value),c&&(i=document.body.style.width,rt(document.body,d.value)),n=qt(t.namespace.value);const y=document.documentElement.clientHeight<document.body.scrollHeight,w=ut(document.body,"overflowY");n>0&&(y||w==="scroll")&&c&&(document.body.style.width=`calc(100% - ${n}px)`)}),ct(()=>_())},rs=(e,a)=>{var t;const n=ft().emit,{nextZIndex:c}=vt();let i="";const _=be(),p=be(),y=I(!1),w=I(!1),h=I(!1),T=I((t=e.zIndex)!=null?t:c());let l,r;const o=pt("namespace",mt),f=V(()=>{const $={},F=`--${o.value}-dialog`;return e.fullscreen||(e.top&&($[`${F}-margin-top`]=e.top),e.width&&($[`${F}-width`]=ce(e.width))),$}),v=V(()=>e.alignCenter?{display:"flex"}:{});function k(){n("opened")}function b(){n("closed"),n(ze,!1),e.destroyOnClose&&(h.value=!1)}function U(){n("close")}function A(){r==null||r(),l==null||l(),e.openDelay&&e.openDelay>0?{stop:l}=Ce(()=>X(),e.openDelay):X()}function O(){l==null||l(),r==null||r(),e.closeDelay&&e.closeDelay>0?{stop:r}=Ce(()=>W(),e.closeDelay):W()}function q(){function $(F){F||(w.value=!0,y.value=!1)}e.beforeClose?e.beforeClose($):O()}function K(){e.closeOnClickModal&&q()}function X(){Te&&(y.value=!0)}function W(){y.value=!1}function C(){n("openAutoFocus")}function z(){n("closeAutoFocus")}function u($){var F;((F=$.detail)==null?void 0:F.focusReason)==="pointer"&&$.preventDefault()}e.lockScroll&&is(y);function m(){e.closeOnPressEscape&&q()}return J(()=>e.modelValue,$=>{$?(w.value=!1,A(),h.value=!0,T.value=gt(e.zIndex)?c():T.value++,yt(()=>{n("open"),a.value&&(a.value.parentElement.scrollTop=0,a.value.parentElement.scrollLeft=0,a.value.scrollTop=0)})):y.value&&O()}),J(()=>e.fullscreen,$=>{a.value&&($?(i=a.value.style.transform,a.value.style.transform=""):a.value.style.transform=i)}),ae(()=>{e.modelValue&&(y.value=!0,h.value=!0,A())}),{afterEnter:k,afterLeave:b,beforeLeave:U,handleClose:q,onModalClick:K,close:O,doClose:W,onOpenAutoFocus:C,onCloseAutoFocus:z,onCloseRequested:m,onFocusoutPrevented:u,titleId:_,bodyId:p,closed:w,style:f,overlayDialogStyle:v,rendered:h,visible:y,zIndex:T}},us=Y({name:"ElDialog",inheritAttrs:!1}),cs=Y({...us,props:ls,emits:ns,setup(e,{expose:a}){const t=e,d=ht();jt({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},V(()=>!!d.title));const n=x("dialog"),c=I(),i=I(),_=I(),{visible:p,titleId:y,bodyId:w,style:h,overlayDialogStyle:T,rendered:l,zIndex:r,afterEnter:o,afterLeave:f,beforeLeave:v,handleClose:k,onModalClick:b,onOpenAutoFocus:U,onCloseAutoFocus:A,onCloseRequested:O,onFocusoutPrevented:q}=rs(t,c);Ie(Ye,{dialogRef:c,headerRef:i,bodyId:w,ns:n,rendered:l,style:h});const K=je(b),X=V(()=>t.draggable&&!t.fullscreen);return a({visible:p,dialogContentRef:_,resetPosition:()=>{var C;(C=_.value)==null||C.resetPosition()}}),(C,z)=>(E(),j(s(wt),{to:C.appendTo,disabled:C.appendTo!=="body"?!1:!C.appendToBody},{default:P(()=>[L(bt,{name:"dialog-fade",onAfterEnter:s(o),onAfterLeave:s(f),onBeforeLeave:s(v),persisted:""},{default:P(()=>[Fe(L(s(Zt),{"custom-mask-event":"",mask:C.modal,"overlay-class":C.modalClass,"z-index":s(r)},{default:P(()=>[g("div",{role:"dialog","aria-modal":"true","aria-label":C.title||void 0,"aria-labelledby":C.title?void 0:s(y),"aria-describedby":s(w),class:D(`${s(n).namespace.value}-overlay-dialog`),style:le(s(T)),onClick:s(K).onClick,onMousedown:s(K).onMousedown,onMouseup:s(K).onMouseup},[L(s(Ct),{loop:"",trapped:s(p),"focus-start-el":"container",onFocusAfterTrapped:s(U),onFocusAfterReleased:s(A),onFocusoutPrevented:s(q),onReleaseRequested:s(O)},{default:P(()=>[s(l)?(E(),j(as,fe({key:0,ref_key:"dialogContentRef",ref:_},C.$attrs,{center:C.center,"align-center":C.alignCenter,"close-icon":C.closeIcon,draggable:s(X),overflow:C.overflow,fullscreen:C.fullscreen,"header-class":C.headerClass,"body-class":C.bodyClass,"footer-class":C.footerClass,"show-close":C.showClose,title:C.title,"aria-level":C.headerAriaLevel,onClose:s(k)}),ve({header:P(()=>[C.$slots.title?B(C.$slots,"title",{key:1}):B(C.$slots,"header",{key:0,close:s(k),titleId:s(y),titleClass:s(n).e("title")})]),default:P(()=>[B(C.$slots,"default")]),_:2},[C.$slots.footer?{name:"footer",fn:P(()=>[B(C.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","header-class","body-class","footer-class","show-close","title","aria-level","onClose"])):S("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,["aria-label","aria-labelledby","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["mask","overlay-class","z-index"]),[[kt,s(p)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var ds=se(cs,[["__file","dialog.vue"]]);const fs=Me(ds),Ve=Symbol("uploadContextKey"),vs="ElUpload";class ps extends Error{constructor(a,t,d,n){super(a),this.name="UploadAjaxError",this.status=t,this.method=d,this.url=n}}function Ee(e,a,t){let d;return t.response?d=`${t.response.error||t.response}`:t.responseText?d=`${t.responseText}`:d=`fail to ${a.method} ${e} ${t.status}`,new ps(d,t.status,a.method,e)}function ms(e){const a=e.responseText||e.response;if(!a)return a;try{return JSON.parse(a)}catch{return a}}const gs=e=>{typeof XMLHttpRequest>"u"&&ne(vs,"XMLHttpRequest is undefined");const a=new XMLHttpRequest,t=e.action;a.upload&&a.upload.addEventListener("progress",c=>{const i=c;i.percent=c.total>0?c.loaded/c.total*100:0,e.onProgress(i)});const d=new FormData;if(e.data)for(const[c,i]of Object.entries(e.data))Re(i)&&i.length?d.append(c,...i):d.append(c,i);d.append(e.filename,e.file,e.file.name),a.addEventListener("error",()=>{e.onError(Ee(t,e,a))}),a.addEventListener("load",()=>{if(a.status<200||a.status>=300)return e.onError(Ee(t,e,a));e.onSuccess(ms(a))}),a.open(e.method,t,!0),e.withCredentials&&"withCredentials"in a&&(a.withCredentials=!0);const n=e.headers||{};if(n instanceof Headers)n.forEach((c,i)=>a.setRequestHeader(i,c));else for(const[c,i]of Object.entries(n))Ue(i)||a.setRequestHeader(c,String(i));return a.send(d),a},Ke=["text","picture","picture-card"];let ys=1;const ge=()=>Date.now()+ys++,Xe=ee({action:{type:String,default:"#"},headers:{type:M(Object)},method:{type:String,default:"post"},data:{type:M([Object,Function,Promise]),default:()=>pe({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:M(Array),default:()=>pe([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:Ke,default:"text"},httpRequest:{type:M(Function),default:gs},disabled:Boolean,limit:Number}),hs=ee({...Xe,beforeUpload:{type:M(Function),default:N},beforeRemove:{type:M(Function)},onRemove:{type:M(Function),default:N},onChange:{type:M(Function),default:N},onPreview:{type:M(Function),default:N},onSuccess:{type:M(Function),default:N},onProgress:{type:M(Function),default:N},onError:{type:M(Function),default:N},onExceed:{type:M(Function),default:N},crossorigin:{type:M(String)}}),bs=ee({files:{type:M(Array),default:()=>pe([])},disabled:{type:Boolean,default:!1},handlePreview:{type:M(Function),default:N},listType:{type:String,values:Ke,default:"text"},crossorigin:{type:M(String)}}),Cs={remove:e=>!!e},ks=Y({name:"ElUploadList"}),ws=Y({...ks,props:bs,emits:Cs,setup(e,{emit:a}){const t=e,{t:d}=De(),n=x("upload"),c=x("icon"),i=x("list"),_=ie(),p=I(!1),y=V(()=>[n.b("list"),n.bm("list",t.listType),n.is("disabled",t.disabled)]),w=h=>{a("remove",h)};return(h,T)=>(E(),j(St,{tag:"ul",class:D(s(y)),name:s(i).b()},{default:P(()=>[(E(!0),R(Et,null,_t(h.files,(l,r)=>(E(),R("li",{key:l.uid||l.name,class:D([s(n).be("list","item"),s(n).is(l.status),{focusing:p.value}]),tabindex:"0",onKeydown:Be(o=>!s(_)&&w(l),["delete"]),onFocus:o=>p.value=!0,onBlur:o=>p.value=!1,onClick:o=>p.value=!1},[B(h.$slots,"default",{file:l,index:r},()=>[h.listType==="picture"||l.status!=="uploading"&&h.listType==="picture-card"?(E(),R("img",{key:0,class:D(s(n).be("list","item-thumbnail")),src:l.url,crossorigin:h.crossorigin,alt:""},null,10,["src","crossorigin"])):S("v-if",!0),l.status==="uploading"||h.listType!=="picture-card"?(E(),R("div",{key:1,class:D(s(n).be("list","item-info"))},[g("a",{class:D(s(n).be("list","item-name")),onClick:Q(o=>h.handlePreview(l),["prevent"])},[L(s(Z),{class:D(s(c).m("document"))},{default:P(()=>[L(s($t))]),_:1},8,["class"]),g("span",{class:D(s(n).be("list","item-file-name")),title:l.name},H(l.name),11,["title"])],10,["onClick"]),l.status==="uploading"?(E(),j(s(qe),{key:0,type:h.listType==="picture-card"?"circle":"line","stroke-width":h.listType==="picture-card"?6:2,percentage:Number(l.percentage),style:le(h.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):S("v-if",!0)],2)):S("v-if",!0),g("label",{class:D(s(n).be("list","item-status-label"))},[h.listType==="text"?(E(),j(s(Z),{key:0,class:D([s(c).m("upload-success"),s(c).m("circle-check")])},{default:P(()=>[L(s(Lt))]),_:1},8,["class"])):["picture-card","picture"].includes(h.listType)?(E(),j(s(Z),{key:1,class:D([s(c).m("upload-success"),s(c).m("check")])},{default:P(()=>[L(s(Oe))]),_:1},8,["class"])):S("v-if",!0)],2),s(_)?S("v-if",!0):(E(),j(s(Z),{key:2,class:D(s(c).m("close")),onClick:o=>w(l)},{default:P(()=>[L(s(Pt))]),_:2},1032,["class","onClick"])),S(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),S(" This is a bug which needs to be fixed "),S(" TODO: Fix the incorrect navigation interaction "),s(_)?S("v-if",!0):(E(),R("i",{key:3,class:D(s(c).m("close-tip"))},H(s(d)("el.upload.deleteTip")),3)),h.listType==="picture-card"?(E(),R("span",{key:4,class:D(s(n).be("list","item-actions"))},[g("span",{class:D(s(n).be("list","item-preview")),onClick:o=>h.handlePreview(l)},[L(s(Z),{class:D(s(c).m("zoom-in"))},{default:P(()=>[L(s(Ae))]),_:1},8,["class"])],10,["onClick"]),s(_)?S("v-if",!0):(E(),R("span",{key:0,class:D(s(n).be("list","item-delete")),onClick:o=>w(l)},[L(s(Z),{class:D(s(c).m("delete"))},{default:P(()=>[L(s(Ne))]),_:1},8,["class"])],10,["onClick"]))],2)):S("v-if",!0)])],42,["onKeydown","onFocus","onBlur","onClick"]))),128)),B(h.$slots,"append")]),_:3},8,["class","name"]))}});var _e=se(ws,[["__file","upload-list.vue"]]);const Es=ee({disabled:{type:Boolean,default:!1}}),_s={file:e=>Re(e)},We="ElUploadDrag",$s=Y({name:We}),Ls=Y({...$s,props:Es,emits:_s,setup(e,{emit:a}){de(Ve)||ne(We,"usage: <el-upload><el-upload-dragger /></el-upload>");const d=x("upload"),n=I(!1),c=ie(),i=p=>{if(c.value)return;n.value=!1,p.stopPropagation();const y=Array.from(p.dataTransfer.files),w=p.dataTransfer.items||[];y.forEach((h,T)=>{var l;const r=w[T],o=(l=r==null?void 0:r.webkitGetAsEntry)==null?void 0:l.call(r);o&&(h.isDirectory=o.isDirectory)}),a("file",y)},_=()=>{c.value||(n.value=!0)};return(p,y)=>(E(),R("div",{class:D([s(d).b("dragger"),s(d).is("dragover",n.value)]),onDrop:Q(i,["prevent"]),onDragover:Q(_,["prevent"]),onDragleave:Q(w=>n.value=!1,["prevent"])},[B(p.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}});var Ps=se(Ls,[["__file","upload-dragger.vue"]]);const Ss=ee({...Xe,beforeUpload:{type:M(Function),default:N},onRemove:{type:M(Function),default:N},onStart:{type:M(Function),default:N},onSuccess:{type:M(Function),default:N},onProgress:{type:M(Function),default:N},onError:{type:M(Function),default:N},onExceed:{type:M(Function),default:N}}),Ds=Y({name:"ElUploadContent",inheritAttrs:!1}),Ts=Y({...Ds,props:Ss,setup(e,{expose:a}){const t=e,d=x("upload"),n=ie(),c=me({}),i=me(),_=o=>{if(o.length===0)return;const{autoUpload:f,limit:v,fileList:k,multiple:b,onStart:U,onExceed:A}=t;if(v&&k.length+o.length>v){A(o,k);return}b||(o=o.slice(0,1));for(const O of o){const q=O;q.uid=ge(),U(q),f&&p(q)}},p=async o=>{if(i.value.value="",!t.beforeUpload)return w(o);let f,v={};try{const b=t.data,U=t.beforeUpload(o);v=ke(t.data)?we(t.data):t.data,f=await U,ke(t.data)&&Yt(b,v)&&(v=we(t.data))}catch{f=!1}if(f===!1){t.onRemove(o);return}let k=o;f instanceof Blob&&(f instanceof File?k=f:k=new File([f],o.name,{type:o.type})),w(Object.assign(k,{uid:o.uid}),v)},y=async(o,f)=>Se(o)?o(f):o,w=async(o,f)=>{const{headers:v,data:k,method:b,withCredentials:U,name:A,action:O,onProgress:q,onSuccess:K,onError:X,httpRequest:W}=t;try{f=await y(f??k,o)}catch{t.onRemove(o);return}const{uid:C}=o,z={headers:v||{},withCredentials:U,file:o,data:f,method:b,filename:A,action:O,onProgress:m=>{q(m,o)},onSuccess:m=>{K(m,o),delete c.value[C]},onError:m=>{X(m,o),delete c.value[C]}},u=W(z);c.value[C]=u,u instanceof Promise&&u.then(z.onSuccess,z.onError)},h=o=>{const f=o.target.files;f&&_(Array.from(f))},T=()=>{n.value||(i.value.value="",i.value.click())},l=()=>{T()};return a({abort:o=>{Dt(c.value).filter(o?([v])=>String(o.uid)===v:()=>!0).forEach(([v,k])=>{k instanceof XMLHttpRequest&&k.abort(),delete c.value[v]})},upload:p}),(o,f)=>(E(),R("div",{class:D([s(d).b(),s(d).m(o.listType),s(d).is("drag",o.drag),s(d).is("disabled",s(n))]),tabindex:s(n)?"-1":"0",onClick:T,onKeydown:Be(Q(l,["self"]),["enter","space"])},[o.drag?(E(),j(Ps,{key:0,disabled:s(n),onFile:_},{default:P(()=>[B(o.$slots,"default")]),_:3},8,["disabled"])):B(o.$slots,"default",{key:1}),g("input",{ref_key:"inputRef",ref:i,class:D(s(d).e("input")),name:o.name,disabled:s(n),multiple:o.multiple,accept:o.accept,type:"file",onChange:h,onClick:Q(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}});var $e=se(Ts,[["__file","upload-content.vue"]]);const Le="ElUpload",Pe=e=>{var a;(a=e.url)!=null&&a.startsWith("blob:")&&URL.revokeObjectURL(e.url)},Fs=(e,a)=>{const t=Tt(e,"fileList",void 0,{passive:!0}),d=l=>t.value.find(r=>r.uid===l.uid);function n(l){var r;(r=a.value)==null||r.abort(l)}function c(l=["ready","uploading","success","fail"]){t.value=t.value.filter(r=>!l.includes(r.status))}function i(l){t.value=t.value.filter(r=>r.uid!==l.uid)}const _=(l,r)=>{const o=d(r);o&&(console.error(l),o.status="fail",i(o),e.onError(l,o,t.value),e.onChange(o,t.value))},p=(l,r)=>{const o=d(r);o&&(e.onProgress(l,o,t.value),o.status="uploading",o.percentage=Math.round(l.percent))},y=(l,r)=>{const o=d(r);o&&(o.status="success",o.response=l,e.onSuccess(l,o,t.value),e.onChange(o,t.value))},w=l=>{Ue(l.uid)&&(l.uid=ge());const r={name:l.name,percentage:0,status:"ready",size:l.size,raw:l,uid:l.uid};if(e.listType==="picture-card"||e.listType==="picture")try{r.url=URL.createObjectURL(l)}catch(o){Ft(Le,o.message),e.onError(o,r,t.value)}t.value=[...t.value,r],e.onChange(r,t.value)},h=async l=>{const r=l instanceof File?d(l):l;r||ne(Le,"file to be removed not found");const o=f=>{n(f),i(f),e.onRemove(f,t.value),Pe(f)};e.beforeRemove?await e.beforeRemove(r,t.value)!==!1&&o(r):o(r)};function T(){t.value.filter(({status:l})=>l==="ready").forEach(({raw:l})=>{var r;return l&&((r=a.value)==null?void 0:r.upload(l))})}return J(()=>e.listType,l=>{l!=="picture-card"&&l!=="picture"||(t.value=t.value.map(r=>{const{raw:o,url:f}=r;if(!f&&o)try{r.url=URL.createObjectURL(o)}catch(v){e.onError(v,r,t.value)}return r}))}),J(t,l=>{for(const r of l)r.uid||(r.uid=ge()),r.status||(r.status="success")},{immediate:!0,deep:!0}),{uploadFiles:t,abort:n,clearFiles:c,handleError:_,handleProgress:p,handleStart:w,handleSuccess:y,handleRemove:h,submit:T,revokeFileObjectURL:Pe}},Is=Y({name:"ElUpload"}),Ms=Y({...Is,props:hs,setup(e,{expose:a}){const t=e,d=ie(),n=me(),{abort:c,submit:i,clearFiles:_,uploadFiles:p,handleStart:y,handleError:w,handleRemove:h,handleSuccess:T,handleProgress:l,revokeFileObjectURL:r}=Fs(t,n),o=V(()=>t.listType==="picture-card"),f=V(()=>({...t,fileList:p.value,onStart:y,onProgress:l,onSuccess:T,onError:w,onRemove:h}));return ye(()=>{p.value.forEach(r)}),Ie(Ve,{accept:It(t,"accept")}),a({abort:c,submit:i,clearFiles:_,handleStart:y,handleRemove:h}),(v,k)=>(E(),R("div",null,[s(o)&&v.showFileList?(E(),j(_e,{key:0,disabled:s(d),"list-type":v.listType,files:s(p),crossorigin:v.crossorigin,"handle-preview":v.onPreview,onRemove:s(h)},ve({append:P(()=>[L($e,fe({ref_key:"uploadRef",ref:n},s(f)),{default:P(()=>[v.$slots.trigger?B(v.$slots,"trigger",{key:0}):S("v-if",!0),!v.$slots.trigger&&v.$slots.default?B(v.$slots,"default",{key:1}):S("v-if",!0)]),_:3},16)]),_:2},[v.$slots.file?{name:"default",fn:P(({file:b,index:U})=>[B(v.$slots,"file",{file:b,index:U})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):S("v-if",!0),!s(o)||s(o)&&!v.showFileList?(E(),j($e,fe({key:1,ref_key:"uploadRef",ref:n},s(f)),{default:P(()=>[v.$slots.trigger?B(v.$slots,"trigger",{key:0}):S("v-if",!0),!v.$slots.trigger&&v.$slots.default?B(v.$slots,"default",{key:1}):S("v-if",!0)]),_:3},16)):S("v-if",!0),v.$slots.trigger?B(v.$slots,"default",{key:2}):S("v-if",!0),B(v.$slots,"tip"),!s(o)&&v.showFileList?(E(),j(_e,{key:3,disabled:s(d),"list-type":v.listType,files:s(p),crossorigin:v.crossorigin,"handle-preview":v.onPreview,onRemove:s(h)},ve({_:2},[v.$slots.file?{name:"default",fn:P(({file:b,index:U})=>[B(v.$slots,"file",{file:b,index:U})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):S("v-if",!0)]))}});var Rs=se(Ms,[["__file","upload.vue"]]);const Us=Me(Rs),Bs={class:"container-flex"},Os={key:0,class:"title"},As={key:1,class:"image-container"},Ns={key:0,class:"loading-overlay"},qs=["src"],zs={key:1,class:"tooltip"},js={class:"button-grid"},Ys=["disabled"],Hs=["disabled"],Vs={class:"slider-container"},Ks={for:"intervalRange",class:"slider-label"},Xs=["src"],Ws={class:"image-date"},Gs={__name:"ArcticSeaIceViewer",props:{images:{type:Array,required:!0}},setup(e){const a=e,t=I(null),d=I(0),n=I(null),c=I(1),i=I(2),_=I(!1),p=I(!1),y=I(!1),w=k=>new Promise((b,U)=>{const A=new Image;A.onload=()=>b(),A.onerror=U,A.src=ue(k)}),h=k=>{k&&(t.value=k,c.value=1)},T=k=>{const b=Math.sign(k.deltaY),U=Math.max(1,Math.min(3,c.value-b*.2));c.value=U,k.preventDefault()},l=async()=>{if(a.images&&a.images.length>0){y.value=!0;const k=(d.value+1)%a.images.length;try{await w(a.images[k].path),d.value=k,n.value=a.images[d.value]}catch(b){console.error("Failed to load next image:",b)}finally{y.value=!1}}},r=async()=>{if(a.images&&a.images.length>0){y.value=!0;const k=(d.value-1+a.images.length)%a.images.length;try{await w(a.images[k].path),d.value=k,n.value=a.images[d.value]}catch(b){console.error("Failed to load previous image:",b)}finally{y.value=!1}}};let o;const f=()=>{clearInterval(o),_.value||(o=setInterval(async()=>{y.value||await l()},i.value*1e3))},v=()=>{_.value=!_.value,f()};return ae(()=>{f()}),ye(()=>{o&&(clearInterval(o),o=null)}),J(()=>a.images,k=>{(k==null?void 0:k.length)>0?(d.value=0,n.value=k[0]):n.value=null},{immediate:!0}),J(i,()=>{f()}),(k,b)=>{var U,A;return E(),R("div",Bs,[n.value?(E(),R("h2",Os,H(n.value.date),1)):S("",!0),n.value?(E(),R("div",As,[y.value?(E(),R("div",Ns,b[6]||(b[6]=[g("div",{class:"loading-spinner"},null,-1)]))):S("",!0),g("img",{src:s(ue)(n.value.path),alt:"Arctic Sea Ice Prediction",class:"image",onClick:b[0]||(b[0]=O=>h(n.value)),onMouseover:b[1]||(b[1]=O=>p.value=!0),onMouseleave:b[2]||(b[2]=O=>p.value=!1)},null,40,qs),p.value?(E(),R("div",zs,"点击图片可以放大查看")):S("",!0)])):S("",!0),g("div",js,[g("button",{onClick:r,class:D(["button",{"button-disabled":d.value===0}]),disabled:d.value===0}," 上一张 ",10,Ys),g("button",{onClick:v,class:"button"},H(_.value?"点击继续":"点击暂停"),1),g("button",{onClick:l,class:D(["button",{"button-disabled":!((U=e.images)!=null&&U.length)||d.value===e.images.length-1}]),disabled:!((A=e.images)!=null&&A.length)||d.value===e.images.length-1}," 下一张 ",10,Hs)]),g("div",Vs,[Fe(g("input",{id:"intervalRange",type:"range",min:"1",max:"3",step:"0.1","onUpdate:modelValue":b[3]||(b[3]=O=>i.value=O),class:"slider"},null,512),[[Mt,i.value]]),g("label",Ks,"图片播放速度: "+H(i.value)+"s",1)]),t.value?(E(),R("div",{key:2,class:"modal-overlay",onWheel:T,onClick:b[5]||(b[5]=Q(O=>t.value=null,["self"]))},[g("div",{class:"modal-content",style:le({transform:`scale(${c.value})`})},[g("img",{src:s(ue)(t.value.path),alt:"Large view",class:"modal-image"},null,8,Xs),g("p",Ws,H(t.value.date),1)],4),g("button",{onClick:b[4]||(b[4]=O=>t.value=null),class:"close-button"},b[7]||(b[7]=[g("svg",{class:"close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[g("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))],32)):S("",!0)])}}},Js={class:"upload-container"},Qs={key:1,class:"form-content"},Zs={class:"upload-header"},xs={class:"upload-progress"},eo={class:"progress-text"},to={class:"hint-text"},so={class:"date-picker-section"},oo={class:"upload-area"},ao={key:0,class:"upload-trigger"},lo={key:1,class:"upload-complete"},no={class:"custom-upload-item"},io=["src"],ro={class:"upload-item-overlay"},uo={class:"upload-item-actions"},co={class:"image-date-label"},fo={class:"submit-section"},vo={key:2,class:"loading-container"},po={key:3,class:"results-container"},mo={key:0},go={key:1,class:"empty-results"},yo={class:"preview-container"},ho=["src"],bo={__name:"ImageUploadPredictor",props:{timeMode:{type:String,required:!0},imageLimit:{type:Number,required:!0},selectedDate:{type:[Date,String],required:!0},getPredictionResult:{type:Function,required:!0},submitPredictionRequest:{type:Function,required:!0}},emits:["update:selectedDate"],setup(e,{emit:a}){const t=e,d=a,n=I([]),c=I(!1),i=I([]),_=I(""),p=I(!1),y=I([]),w=I(!1),h=I(null),T=I(null),l=I(null),r=I([]);J(()=>t.selectedDate,u=>{l.value=u,o()}),J(i,()=>{o()});const o=()=>{if(!l.value)return;const u=[],m=new Date(l.value);for(let $=0;$<t.imageLimit;$++){const F=new Date(m);t.timeMode==="daily"?F.setDate(F.getDate()+$):t.timeMode==="monthly"?F.setMonth(F.getMonth()+$):console.log("Unhandled timeMode:",t.timeMode),u.push(f(F))}r.value=u},f=u=>{const m=u.getFullYear(),$=String(u.getMonth()+1).padStart(2,"0"),F=String(u.getDate()).padStart(2,"0");return`${m}-${$}-${F}`},v=u=>!r.value.length||u>=r.value.length?"未设置日期":r.value[u];J(i,u=>{u.length===t.imageLimit&&G.success(`已成功选择${t.imageLimit}张图片`)});const k=u=>new Promise((m,$)=>{const F=new FileReader;F.readAsDataURL(u),F.onload=()=>m(F.result),F.onerror=oe=>$(oe)}),b=u=>u.type==="image/png"?i.value.length>=t.imageLimit?(G.error(`已达到${t.imageLimit}张图片上限`),!1):!0:(G.error("仅支持PNG文件"),!1),U=(u,m)=>{const $=u.image_url;if($){const F=i.value.findIndex(oe=>oe.uid===m.uid);if(F!==-1){for(;y.value.length<t.imageLimit;)y.value.push(null);y.value[F]=$}}G.success(`${m.name} 上传成功`)},A=(u,m)=>{G.error(`${m.name} 上传失败`),console.error("Upload error:",u)},O=async u=>{!u.url&&!u.preview&&(u.preview=await k(u.raw)),_.value=u.url||u.preview,p.value=!0},q=u=>{const m=i.value.findIndex($=>$.uid===u.uid);if(m!==-1)for(i.value=i.value.filter(($,F)=>F!==m),y.value.splice(m,1);y.value.length<t.imageLimit;)y.value.push(null);G.warning(`还需上传${t.imageLimit-i.value.length}张图片`)},K=async()=>{if(h.value)try{const u=await t.getPredictionResult(h.value);u.success&&u.data&&u.data.images?(n.value=u.data.images,c.value=!0,clearInterval(T.value),w.value=!1,G.success(u.message||"获取预测结果成功")):u.success===!1&&console.log("Task not completed yet:",u.message)}catch(u){if(u.response&&u.response.status===400){console.log("Task not completed yet, continuing polling...");return}clearInterval(T.value),w.value=!1,G.error("获取预测结果失败"),console.error("Error:",u)}},X=async()=>{try{w.value=!0;const u=await t.submitPredictionRequest(t.selectedDate,y.value);if(u.success&&u.data&&u.data.task_id){h.value=u.data.task_id;let m=0;const $=30;T.value=setInterval(()=>{if(m++,m>$){clearInterval(T.value),w.value=!1,G.warning("请求超时，请稍后查看结果");return}K()},2e3)}else w.value=!1,G.error(u.message||"提交预测请求失败")}catch(u){w.value=!1,G.error("提交预测请求失败"),console.error("Error:",u)}},W=()=>{c.value=!1,n.value=[],z(),h.value=null,T.value&&clearInterval(T.value),d("update:selectedDate",null)},C=V(()=>y.value.filter(u=>u!=null).length),z=()=>{y.value=new Array(t.imageLimit).fill(null),i.value=[]};return ae(()=>{z()}),(u,m)=>{const $=Z,F=Ht,oe=qe,Ge=Us,Je=Vt,Qe=fs;return E(),R("div",Js,[c.value?(E(),j(F,{key:0,class:"back-button",onClick:W},{default:P(()=>[L($,null,{default:P(()=>[L(s(Bt))]),_:1}),m[2]||(m[2]=Ut(" 返回 "))]),_:1})):S("",!0),c.value?S("",!0):(E(),R("div",Qs,[g("div",Zs,[m[4]||(m[4]=g("h3",null,"图片上传",-1)),g("div",xs,[g("div",eo,[m[3]||(m[3]=g("span",null,"已上传: ",-1)),g("span",{class:D({complete:C.value===t.imageLimit})},H(C.value)+"/"+H(t.imageLimit),3)]),L(oe,{percentage:C.value/t.imageLimit*100,"stroke-width":8,"show-text":!1,status:C.value===t.imageLimit?"success":""},null,8,["percentage","status"])]),g("p",to,"请上传"+H(t.imageLimit)+"张PNG格式图片",1)]),g("div",so,[B(u.$slots,"date-picker",{},void 0,!0),m[5]||(m[5]=g("p",{class:"date-hint"},"选择的日期将作为第一张图片的日期",-1))]),g("div",oo,[L(Ge,{"file-list":i.value,"onUpdate:fileList":m[0]||(m[0]=te=>i.value=te),class:"image-uploader",action:"https://seaice.52lxy.one:20443/seaice/png-upload",accept:".png","list-type":"picture-card",multiple:!0,limit:e.imageLimit,"before-upload":b,"on-preview":O,"on-success":U,"on-error":A,"on-remove":q,"auto-upload":!0},{default:P(()=>[i.value.length<t.imageLimit?(E(),R("div",ao,[L($,{class:"upload-icon"},{default:P(()=>[L(s(Ot))]),_:1}),m[6]||(m[6]=g("div",{class:"upload-text"},"点击上传",-1)),m[7]||(m[7]=g("div",{class:"upload-hint"},"仅支持PNG格式",-1))])):(E(),R("div",lo,[L($,{class:"complete-icon"},{default:P(()=>[L(s(Oe))]),_:1}),m[8]||(m[8]=g("div",{class:"complete-text"},"上传完成",-1))]))]),file:P(({file:te,index:Ze})=>[g("div",no,[g("img",{class:"upload-thumbnail",src:te.url,alt:""},null,8,io),g("div",ro,[g("div",uo,[L(F,{circle:"",type:"primary",onClick:Q(xe=>O(te),["stop"])},{default:P(()=>[L($,null,{default:P(()=>[L(s(Ae))]),_:1})]),_:2},1032,["onClick"]),L(F,{circle:"",type:"danger",onClick:Q(xe=>q(te),["stop"])},{default:P(()=>[L($,null,{default:P(()=>[L(s(Ne))]),_:1})]),_:2},1032,["onClick"])])]),g("div",co,[g("span",null,H(v(Ze)),1)])])]),_:1},8,["file-list","limit"])]),g("div",fo,[L(F,{type:"primary",size:"large",onClick:X,loading:w.value,disabled:C.value!==t.imageLimit||!e.selectedDate,class:"submit-button"},{default:P(()=>[w.value?S("",!0):(E(),j($,{key:0},{default:P(()=>[L(s(At))]),_:1})),g("span",null,H(w.value?"分析中...":"提交分析"),1)]),_:1},8,["loading","disabled"])])])),w.value?(E(),R("div",vo,[L(Nt),m[9]||(m[9]=g("p",{class:"loading-text"},"正在分析您的图片，请稍候...",-1))])):S("",!0),!w.value&&c.value?(E(),R("div",po,[n.value.length?(E(),R("div",mo,[L(Gs,{images:n.value},null,8,["images"])])):(E(),R("div",go,[L(Je,{description:"暂无预测结果"}),m[10]||(m[10]=g("p",null,"请上传图片并选择日期以查看预测结果",-1))]))])):S("",!0),L(Qe,{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=te=>p.value=te),title:"图片预览",width:"50%",center:"","destroy-on-close":""},{default:P(()=>[g("div",yo,[g("img",{class:"preview-image",src:_.value,alt:"Preview Image"},null,8,ho)])]),_:1},8,["modelValue"])])}}},_o=Rt(bo,[["__scopeId","data-v-189efd23"]]);export{_o as I};
